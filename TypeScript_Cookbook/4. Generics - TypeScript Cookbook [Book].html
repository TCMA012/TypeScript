<!DOCTYPE html>
<!--[if lt IE 10]><html class="no-js ie8 oldie" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

  
    itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-offline-url="/"
data-url="/library/view/typescript-cookbook/9781098136642/ch04.html"

data-archive="9781098136642"
data-publishers="O&#x27;Reilly Media, Inc."


  data-htmlfile-name="ch04.html"
  data-epub-title="TypeScript Cookbook"
  


data-federated-auth-enabled="true"

data-env="production"
data-debug="0" ><![endif]-->
<!--[if gt IE 9]><!--><html class="no-js" lang="en" prefix="og: http://ogp.me/ns/# og:book: http://ogp.me/ns/book# og:video: http://ogp.me/ns/video#"

  
    itemscope itemtype="http://schema.org/Book http://schema.org/ItemPage" data-offline-url="/"
data-url="/library/view/typescript-cookbook/9781098136642/ch04.html"

data-archive="9781098136642"
data-publishers="O&#x27;Reilly Media, Inc."


  data-htmlfile-name="ch04.html"
  data-epub-title="TypeScript Cookbook"
  


data-federated-auth-enabled="true"

data-env="production"
data-debug="0" ><!--<![endif]-->
<head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <title>4. Generics - TypeScript Cookbook [Book]</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <link rel="stylesheet" href="/library/view/static/CACHE/css/output.de4f44bb0810.css" type="text/css">
    <link href='//fonts.googleapis.com/css?family=Source+Sans+Pro' rel='stylesheet' type='text/css' />
    <link rel="stylesheet" type="text/css" href="https://cdn.oreillystatic.com/assets/css/2018_font_face.css" />
    

    <meta property="og:title" content="TypeScript Cookbook" />
    <meta itemprop="isPartOf" content="/library/view/typescript-cookbook/9781098136642/" />
    <meta itemprop="name" content="4. Generics" />
    
    <meta property="og:url" itemprop="url" content="https://www.oreilly.com/library/view/typescript-cookbook/9781098136642/ch04.html" />
    <meta property="og:site_name" content="O’Reilly Online Learning" />
    <meta property="og:image" itemprop="thumbnailUrl" content="https://www.oreilly.com/library/cover/9781098136642/" />
    
    <meta property="og:image:secure_url" itemprop="thumbnailUrl" content="https://learning.oreilly.com/library/cover/9781098136642/360h/">
    <meta property="og:description" itemprop="description" name="description" content=" Chapter 4. Generics Until now, our main goal was to take the inherent flexibility of JavaScript and find a way to formalize it through the type system. We added static …  - Selection from TypeScript Cookbook [Book]">
    
    <meta itemprop="inLanguage" content="en" />
    
    <meta itemprop="publisher" content="O&#x27;Reilly Media, Inc." />
    
    <meta property="og:type" content="article" />
    <meta property="og:book:isbn" itemprop="isbn" content="9781098136659" />
    
    <meta property="og:book:author" itemprop="author" content="Stefan Baumgartner" />
    
    
    
    
    <meta property="og:image:width" content="400">
    <meta property="og:image:height" content="400">
    <meta name="twitter:card" content="summary">
    <meta name="twitter:site" content="@OReillyMedia">

<!-- Start Visual Website Optimizer Asynchronous Code -->
<script type='text/javascript'>
var _vwo_code=(function(){
var account_id=291788,
settings_tolerance=2000,
library_tolerance=2500,
use_existing_jquery=false,
/* DO NOT EDIT BELOW THIS LINE */
f=false,d=document;return{use_existing_jquery:function(){return use_existing_jquery;},library_tolerance:function(){return library_tolerance;},finish:function(){if(!f){f=true;var a=d.getElementById('_vis_opt_path_hides');if(a)a.parentNode.removeChild(a);}},finished:function(){return f;},load:function(a){var b=d.createElement('script');b.src=a;b.type='text/javascript';b.innerText;b.onerror=function(){_vwo_code.finish();};d.getElementsByTagName('head')[0].appendChild(b);},init:function(){settings_timer=setTimeout('_vwo_code.finish()',settings_tolerance);var a=d.createElement('style'),b='body{opacity:0 !important;filter:alpha(opacity=0) !important;background:none !important;}',h=d.getElementsByTagName('head')[0];a.setAttribute('id','_vis_opt_path_hides');a.setAttribute('type','text/css');if(a.styleSheet)a.styleSheet.cssText=b;else a.appendChild(d.createTextNode(b));h.appendChild(a);this.load('//dev.visualwebsiteoptimizer.com/j.php?a='+account_id+'&u='+encodeURIComponent(d.URL)+'&r='+Math.random());return settings_timer;}};}());_vwo_settings_timer=_vwo_code.init();
</script>
<!-- End Visual Website Optimizer Asynchronous Code -->

    <link class="t-canonical-link" rel="canonical" href="https://www.oreilly.com/library/view/typescript-cookbook/9781098136642/ch04.html" />

    <link rel="shortcut icon" href="//www.oreilly.com/favicon.ico" type="image/vnd.microsoft.icon" />
    <link rel="apple-touch-icon" href="/library/view/static/images/apple-touch-icon.png" />
    

  
    <style type="text/css" title="ibis-book">
    @charset "utf-8";test-content-id html,test-content-id div,test-content-id div,test-content-id span,test-content-id applet,test-content-id object,test-content-id iframe,test-content-id h1,test-content-id h2,test-content-id h3,test-content-id h4,test-content-id h5,test-content-id h6,test-content-id p,test-content-id blockquote,test-content-id pre,test-content-id a,test-content-id abbr,test-content-id acronym,test-content-id address,test-content-id big,test-content-id cite,test-content-id code,test-content-id del,test-content-id dfn,test-content-id em,test-content-id img,test-content-id ins,test-content-id kbd,test-content-id q,test-content-id s,test-content-id samp,test-content-id small,test-content-id strike,test-content-id strong,test-content-id sub,test-content-id sup,test-content-id tt,test-content-id var,test-content-id b,test-content-id u,test-content-id i,test-content-id center,test-content-id dl,test-content-id dt,test-content-id dd,test-content-id ol,test-content-id ul,test-content-id li,test-content-id fieldset,test-content-id form,test-content-id label,test-content-id legend,test-content-id table,test-content-id caption,test-content-id tdiv,test-content-id tfoot,test-content-id thead,test-content-id tr,test-content-id th,test-content-id td,test-content-id article,test-content-id aside,test-content-id canvas,test-content-id details,test-content-id embed,test-content-id figure,test-content-id figcaption,test-content-id footer,test-content-id header,test-content-id hgroup,test-content-id menu,test-content-id nav,test-content-id output,test-content-id ruby,test-content-id section,test-content-id summary,test-content-id time,test-content-id mark,test-content-id audio,test-content-id video{margin:0;padding:0;border:0;font-size:100%;font:inherit;vertical-align:baseline}test-content-id article,test-content-id aside,test-content-id details,test-content-id figcaption,test-content-id figure,test-content-id footer,test-content-id header,test-content-id hgroup,test-content-id menu,test-content-id nav,test-content-id section{display:block}test-content-id div{line-height:1}test-content-id ol,test-content-id ul{list-style:none}test-content-id blockquote,test-content-id q{quotes:none}test-content-id blockquote:before,test-content-id blockquote:after,test-content-id q:before,test-content-id q:after{content:none}test-content-id table{border-collapse:collapse;border-spacing:0}@page{margin:5px !important}test-content-id p{margin:10px 0 0;line-height:125%;text-align:left}test-content-id p.byline{text-align:left;margin:-33px auto 35px;font-style:italic;font-weight:bold}test-content-id div.preface p+p.byline,test-content-id div.preface p.byline.cont+p.byline:not(.cont){margin:1em 0 0 !important}test-content-id div.preface p.byline+p.byline{margin:0 !important}test-content-id div.sect1>p.byline{margin:-.25em 0 1em}test-content-id div.sect1>p.byline+p.byline{margin-top:-1em}test-content-id em{font-style:italic;font-family:inherit}test-content-id em strong,test-content-id strong em{font-weight:bold;font-style:italic;font-family:inherit}test-content-id strong,test-content-id span.bold{font-weight:bold}test-content-id em.replaceable{font-style:italic}test-content-id strong.userinput{font-weight:bold;font-style:normal}test-content-id span.bolditalic{font-weight:bold;font-style:italic}test-content-id a.ulink,test-content-id a.xref,test-content-id a.email,test-content-id a.link,test-content-id a{text-decoration:none;color:#8e0012}test-content-id span.lineannotation{font-style:italic;color:#a62a2a;font-family:serif}test-content-id span.underline{text-decoration:underline}test-content-id span.strikethrough{text-decoration:line-through}test-content-id span.smallcaps{font-variant:small-caps}test-content-id span.cursor{background:#000;color:#fff}test-content-id span.smaller{font-size:75%}test-content-id .boxedtext,test-content-id .keycap{border-style:solid;border-width:1px;border-color:#000;padding:1px}test-content-id span.gray50{color:#7F7F7F;}test-content-id h1,test-content-id div.toc-title,test-content-id h2,test-content-id h3,test-content-id h4,test-content-id h5{-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;font-weight:bold;text-align:left;page-break-after:avoid !important;font-family:sans-serif,"DejaVuSans"}test-content-id div.toc-title{font-size:1.5em;margin-top:20px !important;margin-bottom:30px !important}test-content-id section[data-type="sect1"] h1{font-size:1.3em;color:#8e0012;margin:40px 0 8px 0}test-content-id section[data-type="sect2"] h2{font-size:1.1em;margin:30px 0 8px 0 !important}test-content-id section[data-type="sect3"] h3{font-size:1em;color:#555;margin:20px 0 8px 0 !important}test-content-id section[data-type="sect4"] h4{font-size:1em;font-weight:normal;font-style:italic;margin:15px 0 6px 0 !important}test-content-id section[data-type="chapter"]>div>h1,test-content-id section[data-type="preface"]>div>h1,test-content-id section[data-type="appendix"]>div>h1,test-content-id section[data-type="glossary"]>div>h1,test-content-id section[data-type="bibliography"]>div>h1,test-content-id section[data-type="afterword"]>div>h1,test-content-id section[data-type="index"]>div>h1{font-size:2em;line-height:1;margin-bottom:50px;color:#000;padding-bottom:10px;border-bottom:1px solid #000}test-content-id span.label,test-content-id span.keep-together{font-size:inherit;font-weight:inherit}test-content-id div[data-type="part"]>h1{font-size:2em;text-align:center;margin-top:0 !important;margin-bottom:50px;padding:50px 0 10px 0;border-bottom:1px solid #000}test-content-id img.width-ninety{width:90%}test-content-id img{max-width:95%;margin:0 auto;padding:0}test-content-id div.figure{background-color:transparent;text-align:center !important;margin:15px auto !important;page-break-inside:avoid}test-content-id figure{margin:15px auto !important;page-break-inside:avoid}test-content-id div.figure h6,test-content-id figure h6,test-content-id figure figcaption{font-size:.9rem !important;text-align:center;font-weight:normal !important;font-style:italic !important;font-family:serif !important;text-transform:none !important;letter-spacing:normal !important;color:#000;padding-top:.25em !important;margin-top:0 !important;page-break-before:avoid}test-content-id div.informalfigure{text-align:center !important;padding:5px 0 !important}test-content-id div.sidebar{margin:15px 0 10px 0 !important;border:1px solid #DCDCDC;background-color:#F7F7F7;padding:15px !important;page-break-inside:avoid}test-content-id aside[data-type="sidebar"]{margin:15px 0 10px 0 !important;page-break-inside:avoid}test-content-id div.sidebar-title,test-content-id div.sidebar h1,test-content-id div.sidebar h5,test-content-id aside[data-type="sidebar"] h1,test-content-id aside[data-type="sidebar"] h5{font-weight:bold;font-size:1em;font-family:sans-serif;text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px 0 !important;page-break-inside:avoid}test-content-id div.sidebar ol,test-content-id div.sidebar ul,test-content-id aside[data-type="sidebar"] ol,test-content-id aside[data-type="sidebar"] ul{margin-left:1.25em !important}test-content-id div.sidebar div.figure p.title,test-content-id aside[data-type="sidebar"] figcaption,test-content-id div.sidebar div.informalfigure div.caption{font-size:90%;text-align:center;font-weight:normal;font-style:italic;font-family:serif !important;color:#000;padding:5px !important;page-break-before:avoid;page-break-after:avoid}test-content-id div.sidebar div.tip,test-content-id div.sidebar div[data-type="tip"],test-content-id div.sidebar div.note,test-content-id div.sidebar div[data-type="note"],test-content-id div.sidebar div.warning,test-content-id div.sidebar div[data-type="warning"],test-content-id div.sidebar div[data-type="caution"],test-content-id div.sidebar div[data-type="important"]{margin:20px auto 20px auto !important;font-size:90%;width:85%}test-content-id aside[data-type="sidebar"] p.byline{font-size:90%;font-weight:bold;font-style:italic;text-align:center;text-indent:0;margin:5px auto 6px;page-break-after:avoid}test-content-id pre{white-space:pre-wrap;font-family:"Ubuntu Mono",monospace;margin:25px 0 25px 20px;font-size:85%;display:block;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;overflow-wrap:break-word}test-content-id pre code{font-size:inherit !important}test-content-id pre+pre{margin-top:-25px !important}test-content-id div.note pre.programlisting,test-content-id div.tip pre.programlisting,test-content-id div.warning pre.programlisting,test-content-id div.caution pre.programlisting,test-content-id div.important pre.programlisting{margin-bottom:0}test-content-id code{font-family:"Ubuntu Mono",monospace;-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none;overflow-wrap:break-word}test-content-id code strong em,test-content-id code em strong,test-content-id pre em strong,test-content-id pre strong em,test-content-id strong code em code,test-content-id em code strong code,test-content-id span.bolditalic code{font-weight:bold;font-style:italic;font-family:"Ubuntu Mono BoldItal",monospace}test-content-id code em,test-content-id em code,test-content-id pre em,test-content-id em.replaceable{font-family:"Ubuntu Mono Ital",monospace;font-style:italic}test-content-id code strong,test-content-id strong code,test-content-id pre strong,test-content-id strong.userinput{font-family:"Ubuntu Mono Bold",monospace;font-weight:bold}test-content-id div[data-type="example"]{margin:10px 0 15px 0 !important}test-content-id div[data-type="example"] h1,test-content-id div[data-type="example"] h2,test-content-id div[data-type="example"] h3,test-content-id div[data-type="example"] h4,test-content-id div[data-type="example"] h5,test-content-id div[data-type="example"] h6{font-style:italic;font-weight:normal;text-align:left !important;text-transform:none !important;font-family:serif !important;margin:10px 0 5px 0 !important;border-bottom:1px solid #000}test-content-id li pre.example{padding:10px 0 !important}test-content-id div[data-type="example"] pre[data-type="programlisting"],test-content-id div[data-type="example"] pre[data-type="screen"]{margin:0}test-content-id section[data-type="titlepage"]>div>h1{font-size:2em;margin:50px 0 10px 0 !important;line-height:1;text-align:center}test-content-id section[data-type="titlepage"] h2,test-content-id section[data-type="titlepage"] p.subtitle,test-content-id section[data-type="titlepage"] p[data-type="subtitle"]{font-size:1.3em;font-weight:normal;text-align:center;margin-top:.5em;color:#555}test-content-id section[data-type="titlepage"]>div>h2[data-type="author"],test-content-id section[data-type="titlepage"] p.author{font-size:1.3em;font-family:serif !important;font-weight:bold;margin:50px 0 !important;text-align:center}test-content-id section[data-type="titlepage"] p.edition{text-align:center;text-transform:uppercase;margin-top:2em}test-content-id section[data-type="titlepage"]{text-align:center}test-content-id section[data-type="titlepage"]:after{content:url(css_assets/titlepage_footer_ebook.png);margin:0 auto;max-width:80%}test-content-id div.book div.titlepage div.publishername{margin-top:60%;margin-bottom:20px;text-align:center;font-size:1.25em}test-content-id div.book div.titlepage div.locations p{margin:0;text-align:center}test-content-id div.book div.titlepage div.locations p.cities{font-size:80%;text-align:center;margin-top:5px}test-content-id section.preface[title="Dedication"]>div.titlepage h2.title{text-align:center;text-transform:uppercase;font-size:1.5em;margin-top:50px;margin-bottom:50px}test-content-id ul.stafflist{margin:15px 0 15px 20px !important}test-content-id ul.stafflist li{list-style-type:none;padding:5px 0}test-content-id ul.printings li{list-style-type:none}test-content-id section.preface[title="Dedication"] p{font-style:italic;text-align:center}test-content-id div.colophon h1.title{font-size:1.3em;margin:0 !important;font-family:serif !important;font-weight:normal}test-content-id div.colophon h2.subtitle{margin:0 !important;color:#000;font-family:serif !important;font-size:1em;font-weight:normal}test-content-id div.colophon div.author h3.author{font-size:1.1em;font-family:serif !important;margin:10px 0 0 !important;font-weight:normal}test-content-id div.colophon div.editor h4,test-content-id div.colophon div.editor h3.editor{color:#000;font-size:.8em;margin:15px 0 0 !important;font-family:serif !important;font-weight:normal}test-content-id div.colophon div.editor h3.editor{font-size:.8em;margin:0 !important;font-family:serif !important;font-weight:normal}test-content-id div.colophon div.publisher{margin-top:10px}test-content-id div.colophon div.publisher p,test-content-id div.colophon div.publisher span.publishername{margin:0;font-size:.8em}test-content-id div.legalnotice p,test-content-id div.timestamp p{font-size:.8em}test-content-id div.timestamp p{margin-top:10px}test-content-id div.colophon[title="About the Author"] h1.title,test-content-id div.colophon[title="Colophon"] h1.title{font-size:1.5em;margin:0 !important;font-family:sans-serif !important}test-content-id section.chapter div.titlepage div.author{margin:10px 0 10px 0}test-content-id section.chapter div.titlepage div.author div.affiliation{font-style:italic}test-content-id div.attribution{margin:5px 0 0 50px !important}test-content-id h3.author span.orgname{display:none}test-content-id div.epigraph{margin:10px 0 10px 20px !important;page-break-inside:avoid;font-size:90%}test-content-id div.epigraph p{font-style:italic}test-content-id blockquote,test-content-id div.blockquote{margin:10px !important;page-break-inside:avoid;font-size:95%}test-content-id blockquote p,test-content-id div.blockquote p{font-style:italic;margin:.75em 0 0 !important}test-content-id blockquote div.attribution,test-content-id blockquote p[data-type="attribution"]{margin:5px 0 10px 30px !important;text-align:right;width:80%}test-content-id blockquote div.attribution p,test-content-id blockquote p[data-type="attribution"]{font-style:normal;margin-top:5px}test-content-id blockquote div.attribution p:before,test-content-id blockquote p[data-type="attribution"]:before{font-style:normal;content:"—";-webkit-hyphens:none;hyphens:none;adobe-hyphenate:none}test-content-id p.right{text-align:right;margin:0}test-content-id div[data-type="footnotes"]{border-top:1px solid black;margin-top:2em}test-content-id sub,test-content-id sup{font-size:75%;line-height:0}test-content-id sup{vertical-align:super}test-content-id sub{vertical-align:sub}test-content-id p[data-type="footnote"]{font-size:90% !important;line-height:1.2em !important;margin-left:2.5em !important;text-indent:-2.3em !important}test-content-id p[data-type="footnote"] sup:first-child{display:inline-block !important;position:static !important;width:2em !important;text-align:right !important;font-size:100% !important;padding-right:.5em !important;top:-2px !important}test-content-id p[data-type="footnote"] a[href$="-marker"]{font-family:sans-serif !important;font-size:90% !important;color:#8e0012 !important}test-content-id p[data-type="footnote"] a[data-type="xref"]{margin:0 !important;padding:0 !important;text-indent:0 !important}test-content-id a[data-type="noteref"]{font-family:sans-serif !important;color:#8e0012;margin-left:0;padding-left:0}test-content-id div.refentry p.refname{font-size:1em;font-family:sans-serif,"DejaVuSans";font-weight:bold;margin-bottom:5px;overflow:auto;width:100%}test-content-id div.refentry{width:100%;display:block;margin-top:2em}test-content-id div.refsynopsisdiv{display:block;clear:both}test-content-id div.refentry header{page-break-inside:avoid !important;display:block;break-inside:avoid !important;padding-top:0;border-bottom:1px solid #000}test-content-id div.refsect1 h6{font-size:.9em;font-family:sans-serif,"DejaVuSans";font-weight:bold}test-content-id div.refsect1{margin-top:3em}test-content-id ul.references li{list-style-type:none !important;text-indent:-24px !important}test-content-id dl{margin-bottom:1.5em !important}test-content-id dt{padding-top:10px !important;padding-bottom:0 !important;line-height:1.25rem;font-style:italic}test-content-id dl.calloutlist dt{padding-top:0 !important;line-height:0 !important;margin-bottom:-2.35em !important}test-content-id dt code{font-style:normal !important}test-content-id dd{margin:10px 0 .25em 1.5em !important;line-height:1.65em !important;font-family:"Noto serif",serif}test-content-id dd p{padding:0 !important;margin:0 0 10px !important}test-content-id dd ol,test-content-id dd ul{padding-left:.25em !important}test-content-id dd li{margin-top:0 !important;margin-bottom:0 !important;padding-top:0;padding-bottom:0;line-height:1 !important}test-content-id dl.calloutlist dd li{padding-top:1em !important}test-content-id dl.calloutlist dd li:last-child{padding-bottom:0 !important}test-content-id dl.calloutlist dd>ul:last-child,test-content-id dl.calloutlist dd>ol:last-child{padding-bottom:1.5em !important}test-content-id dd,test-content-id li{text-align:left}test-content-id ul,test-content-id ul>li,test-content-id ol ul,test-content-id ol ul>li,test-content-id ul ol ul,test-content-id ul ol ul>li{list-style-type:disc !important}test-content-id ul ul,test-content-id ul ul>li{list-style-type:square}test-content-id ul ul ul,test-content-id ul ul ul>li{list-style-type:circle}test-content-id ol,test-content-id ol>li,test-content-id ol ul ol,test-content-id ol ul ol>li,test-content-id ul ol,test-content-id ul ol>li{list-style-type:decimal}test-content-id ol ol,test-content-id ol ol>li{list-style-type:lower-alpha !important}test-content-id ol ol ol,test-content-id ol ol ol>li{list-style-type:lower-roman}test-content-id ul ol li,test-content-id ol ol li{list-style:lower-alpha !important}test-content-id ol,test-content-id ul{list-style-position:outside !important;margin:15px 0 15px 1.25em;padding-left:.75rem !important}test-content-id ol li,test-content-id ul li{margin:.5em 0 .65em;line-height:125%}test-content-id div.orderedlistalpha{list-style-type:upper-alpha}test-content-id table.simplelist,test-content-id ul.simplelist{margin:15px 0 15px 20px !important}test-content-id ul.simplelist li{list-style-type:none !important;padding:5px 0 !important}test-content-id table.simplelist td{border:none}test-content-id table.simplelist tr{border-bottom:none}test-content-id table.simplelist tr:nth-of-type(even){background-color:transparent}test-content-id dl.calloutlist p:first-child{margin-top:-25px !important}test-content-id dl.calloutlist dd{padding-left:0;margin-top:-25px}test-content-id dl.calloutlist img,test-content-id a.co img{padding:0}test-content-id div.toc ol{margin-top:8px !important;margin-bottom:8px !important;margin-left:0 !important;padding-left:0 !important}test-content-id div.toc ol ol{margin-left:30px !important;padding-left:0 !important}test-content-id div.toc ol li{list-style-type:none}test-content-id div.toc a{color:#8e0012}test-content-id div.toc ol a{font-size:1em;font-weight:bold}test-content-id div.toc ol>li>ol a{font-weight:bold;font-size:1em}test-content-id div.toc ol>li>ol>li>ol a{text-decoration:none;font-weight:normal;font-size:1em}test-content-id div.tip,test-content-id div[data-type="tip"],test-content-id div.note,test-content-id div[data-type="note"],test-content-id div.warning,test-content-id div[data-type="warning"],test-content-id div[data-type="caution"],test-content-id div[data-type="important"]{margin:30px !important;font-size:90%;padding:10px 8px 20px 8px !important;page-break-inside:avoid}test-content-id div.tip ol,test-content-id div.tip ul,test-content-id div[data-type="tip"] ol,test-content-id div[data-type="tip"] ul,test-content-id div.note ol,test-content-id div.note ul,test-content-id div[data-type="note"] ol,test-content-id div[data-type="note"] ul,test-content-id div.warning ol,test-content-id div.warning ul,test-content-id div[data-type="warning"] ol,test-content-id div[data-type="warning"] ul,test-content-id div[data-type="caution"] ol,test-content-id div[data-type="caution"] ul,test-content-id div[data-type="important"] ol,test-content-id div[data-type="important"] ul{margin-left:1.5em !important}test-content-id div.tip,test-content-id div[data-type="tip"],test-content-id div.note,test-content-id div[data-type="note"]{border:1px solid #BEBEBE;background-color:transparent}test-content-id div.warning,test-content-id div[data-type="warning"],test-content-id div[data-type="caution"],test-content-id div[data-type="important"]{border:1px solid #BC8F8F}test-content-id div.tip h3,test-content-id div[data-type="tip"] h6,test-content-id div[data-type="tip"] h1,test-content-id div.note h3,test-content-id div[data-type="note"] h6,test-content-id div[data-type="note"] h1,test-content-id div.warning h3,test-content-id div[data-type="warning"] h6,test-content-id div[data-type="warning"] h1,test-content-id div[data-type="caution"] h6,test-content-id div[data-type="caution"] h1,test-content-id div[data-type="important"] h1,test-content-id div[data-type="important"] h6{font-weight:bold;font-size:110%;font-family:sans-serif !important;text-transform:uppercase;letter-spacing:1px;text-align:center;margin:4px 0 6px !important}test-content-id div[data-type="tip"] figure h6,test-content-id div[data-type="note"] figure h6,test-content-id div[data-type="warning"] figure h6,test-content-id div[data-type="caution"] figure h6,test-content-id div[data-type="important"] figure h6{font-family:serif !important}test-content-id div.tip h3,test-content-id div[data-type="tip"] h6,test-content-id div.note h3,test-content-id div[data-type="note"] h6,test-content-id div[data-type="tip"] h1,test-content-id div[data-type="note"] h1{color:#737373}test-content-id div.warning h3,test-content-id div[data-type="warning"] h6,test-content-id div[data-type="caution"] h6,test-content-id div[data-type="important"] h6,test-content-id div[data-type="warning"] h1,test-content-id div[data-type="caution"] h1,test-content-id div[data-type="important"] h1{color:#C67171}test-content-id div.sect1[title="Safari® Books Online"] div.note,test-content-id div.safarienabled{background-color:transparent;margin:8px 0 0 !important;border:0 solid #BEBEBE;font-size:100%;padding:0 !important;page-break-inside:avoid}test-content-id div.sect1[title="Safari® Books Online"] div.note h3,test-content-id div.safarienabled h6{display:none}test-content-id .author-date-bib li{list-style-type:none;margin-left:0;padding-left:18pt;text-indent:-18pt}test-content-id div.table,test-content-id table{margin:15px 0 30px 0 !important;max-width:100%;border:none !important;background:none;display:block;overflow-x:auto}test-content-id div.table,test-content-id div.informaltable,test-content-id table{page-break-inside:avoid}test-content-id table li{margin:10px 0 0 .25em !important}test-content-id tr,test-content-id tr td{border-bottom:1px solid #c3c3c3}test-content-id thead td,test-content-id thead th{border-bottom:#9d9d9d 1px solid !important;border-top:#9d9d9d 1px solid !important;vertical-align:bottom}test-content-id tr:nth-of-type(even){background-color:#f1f6fc}test-content-id thead,test-content-id tbody th{font-family:sans-serif;font-weight:bold}test-content-id td,test-content-id th{display:table-cell;padding:.5em !important;text-align:left !important;vertical-align:top;font-size:95% !important;min-width:6rem}test-content-id div.informaltable table{margin:10px auto !important}test-content-id div.informaltable table tr{border-bottom:none}test-content-id div.informaltable table tr:nth-of-type(even){background-color:transparent}test-content-id div.informaltable td,test-content-id div.informaltable th{border:#9d9d9d 1px solid}test-content-id div.table-title,test-content-id table caption{font-weight:normal;font-style:italic;font-family:serif;font-size:1em;margin:10px 0 10px 0 !important;padding:0;page-break-after:avoid;text-align:left !important}test-content-id table pre{font-size:95%;margin:0 !important;padding:0 !important}test-content-id table code{font-size:95%;word-break:break-all}test-content-id table.border td{border-bottom:.25pt solid #000}test-content-id table.border tbody>tr:last-child>td{border-bottom:transparent}test-content-id table.stafflist_table{text-align:left;border:none;margin:0}test-content-id table.stafflist_table tr,test-content-id table.stafflist_table td,test-content-id table.stafflist_table th{border-bottom:none !important;border-top:none !important;font-size:1em;margin:0}test-content-id table.stafflist_table td{margin:0;padding:0 1rem 0 0}test-content-id table.stafflist_table tr:nth-of-type(even){background-color:transparent}test-content-id div.equation,test-content-id div[data-type="equation"]{margin:10px 0 15px 0 !important}test-content-id div.equation-title,test-content-id div[data-type="equation"] h5{font-style:italic;font-weight:normal;font-family:serif !important;font-size:90%;margin:20px 0 10px 0 !important;page-break-after:avoid}test-content-id div.equation-contents{margin-left:20px}test-content-id div[data-type="equation"] math{font-size:calc(.35em + 1vw)}test-content-id span.inlinemediaobject{height:.85em;display:inline-block;margin-bottom:.2em}test-content-id span.inlinemediaobject img{margin:0;height:.85em}test-content-id div.informalequation{margin:20px 0 20px 20px;width:75%}test-content-id div.informalequation img{width:75%}test-content-id div.index{text-indent:0}test-content-id div.index h3{padding:.25em;margin-top:1em !important;background-color:#F0F0F0}test-content-id div.index li{line-height:130%;list-style-type:none}test-content-id div.index a.indexterm{color:#8e0012 !important}test-content-id div.index ul{margin-left:0 !important;padding-left:0 !important}test-content-id div.index ul ul{margin-left:2em !important;margin-top:0 !important}test-content-id code.boolean,test-content-id .navy{color:rgb(0,0,128);}test-content-id code.character,test-content-id .olive{color:rgb(128,128,0);}test-content-id code.comment,test-content-id .blue{color:rgb(0,0,255);}test-content-id code.conditional,test-content-id .limegreen{color:rgb(50,205,50);}test-content-id code.constant,test-content-id .darkorange{color:rgb(255,140,0);}test-content-id code.debug,test-content-id .darkred{color:rgb(139,0,0);}test-content-id code.define,test-content-id .darkgoldenrod,test-content-id .gold{color:rgb(184,134,11);}test-content-id code.delimiter,test-content-id .dimgray{color:rgb(105,105,105);}test-content-id code.error,test-content-id .red{color:rgb(255,0,0);}test-content-id code.exception,test-content-id .salmon{color:rgb(250,128,11);}test-content-id code.float,test-content-id .steelblue{color:rgb(70,130,180);}test-content-id pre code.function,test-content-id .green{color:rgb(0,128,0);}test-content-id code.identifier,test-content-id .royalblue{color:rgb(65,105,225);}test-content-id code.ignore,test-content-id .gray{color:rgb(128,128,128);}test-content-id code.include,test-content-id .purple{color:rgb(128,0,128);}test-content-id code.keyword,test-content-id .sienna{color:rgb(160,82,45);}test-content-id code.label,test-content-id .deeppink{color:rgb(255,20,147);}test-content-id code.macro,test-content-id .orangered{color:rgb(255,69,0);}test-content-id code.number,test-content-id .brown{color:rgb(165,42,42);}test-content-id code.operator,test-content-id .black{color:#000;}test-content-id code.preCondit,test-content-id .teal{color:rgb(0,128,128);}test-content-id code.preProc,test-content-id .fuschia{color:rgb(255,0,255);}test-content-id code.repeat,test-content-id .indigo{color:rgb(75,0,130);}test-content-id code.special,test-content-id .saddlebrown{color:rgb(139,69,19);}test-content-id code.specialchar,test-content-id .magenta{color:rgb(255,0,255);}test-content-id code.specialcomment,test-content-id .seagreen{color:rgb(46,139,87);}test-content-id code.statement,test-content-id .forestgreen{color:rgb(34,139,34);}test-content-id code.storageclass,test-content-id .plum{color:rgb(221,160,221);}test-content-id code.string,test-content-id .darkred{color:rgb(139,0,0);}test-content-id code.structure,test-content-id .chocolate{color:rgb(210,106,30);}test-content-id code.tag,test-content-id .darkcyan{color:rgb(0,139,139);}test-content-id code.todo,test-content-id .black{color:#000;}test-content-id code.type,test-content-id .mediumslateblue{color:rgb(123,104,238);}test-content-id code.typedef,test-content-id .darkgreen{color:rgb(0,100,0);}test-content-id code.underlined{text-decoration:underline;}test-content-id pre code.hll{background-color:#ffc}test-content-id pre code.c{color:#09F;font-style:italic}test-content-id pre code.err{color:#A00}test-content-id pre code.k{color:#069;font-weight:bold}test-content-id pre code.o{color:#555}test-content-id pre code.cm{color:#35586C;font-style:italic}test-content-id pre code.cp{color:#099}test-content-id pre code.c1{color:#35586C;font-style:italic}test-content-id pre code.cs{color:#35586C;font-weight:bold;font-style:italic}test-content-id pre code.gd{background-color:#FCC}test-content-id pre code.ge{font-style:italic}test-content-id pre code.gr{color:#F00}test-content-id pre code.gh{color:#030;font-weight:bold}test-content-id pre code.gi{background-color:#CFC}test-content-id pre code.go{color:#000}test-content-id pre code.gp{color:#009;font-weight:bold}test-content-id pre code.gs{font-weight:bold}test-content-id pre code.gu{color:#030;font-weight:bold}test-content-id pre code.gt{color:#9C6}test-content-id pre code.kc{color:#069;font-weight:bold}test-content-id pre code.kd{color:#069;font-weight:bold}test-content-id pre code.kn{color:#069;font-weight:bold}test-content-id pre code.kp{color:#069}test-content-id pre code.kr{color:#069;font-weight:bold}test-content-id pre code.kt{color:#078;font-weight:bold}test-content-id pre code.m{color:#F60}test-content-id pre code.s{color:#C30}test-content-id pre code.na{color:#309}test-content-id pre code.nb{color:#366}test-content-id pre code.nc{color:#0A8;font-weight:bold}test-content-id pre code.no{color:#360}test-content-id pre code.nd{color:#99F}test-content-id pre code.ni{color:#999;font-weight:bold}test-content-id pre code.ne{color:#C00;font-weight:bold}test-content-id pre code.nf{color:#C0F}test-content-id pre code.nl{color:#99F}test-content-id pre code.nn{color:#0CF;font-weight:bold}test-content-id pre code.nt{color:#309;font-weight:bold}test-content-id pre code.nv{color:#033}test-content-id pre code.ow{color:#000;font-weight:bold}test-content-id pre code.w{color:#bbb}test-content-id pre code.mf{color:#F60}test-content-id pre code.mh{color:#F60}test-content-id pre code.mi{color:#F60}test-content-id pre code.mo{color:#F60}test-content-id pre code.sb{color:#C30}test-content-id pre code.sc{color:#C30}test-content-id pre code.sd{color:#C30;font-style:italic}test-content-id pre code.s2{color:#C30}test-content-id pre code.se{color:#C30;font-weight:bold}test-content-id pre code.sh{color:#C30}test-content-id pre code.si{color:#A00}test-content-id pre code.sx{color:#C30}test-content-id pre code.sr{color:#3AA}test-content-id pre code.s1{color:#C30}test-content-id pre code.ss{color:#A60}test-content-id pre code.bp{color:#366}test-content-id pre code.vc{color:#033}test-content-id pre code.vg{color:#033}test-content-id pre code.vi{color:#033}test-content-id pre code.il{color:#F60}test-content-id pre code.g{color:#050}test-content-id pre code.l{color:#C60}test-content-id pre code.l{color:#F90}test-content-id pre code.n{color:#008}test-content-id pre code.nx{color:#008}test-content-id pre code.py{color:#96F}test-content-id pre code.p{color:#000}test-content-id pre code.x{color:#F06}test-content-id div.blockquote_sampler_toc{width:95%;margin:5px 5px 5px 10px !important}test-content-id div{font-family:serif;text-align:left}test-content-id .gray-background,test-content-id .reverse-video{background:#2E2E2E;color:#FFF}test-content-id .light-gray-background{background:#A0A0A0}test-content-id .preserve-whitespace{white-space:pre-wrap}test-content-id pre.break-code,test-content-id code.break-code,test-content-id .break-code pre,test-content-id .break-code code{word-break:break-all}test-content-id span.gray{color:#4C4C4C}test-content-id .width-10,test-content-id figure.width-10 img{width:10% !important}test-content-id .width-20,test-content-id figure.width-20 img{width:20% !important}test-content-id .width-30,test-content-id figure.width-30 img{width:30% !important}test-content-id .width-40,test-content-id figure.width-40 img{width:40% !important}test-content-id .width-50,test-content-id figure.width-50 img{width:50% !important}test-content-id .width-60,test-content-id figure.width-60 img{width:60% !important}test-content-id .width-70,test-content-id figure.width-70 img{width:70% !important}test-content-id .width-80,test-content-id figure.width-80 img{width:80% !important}test-content-id .width-90,test-content-id figure.width-90 img{width:90% !important}test-content-id .width-full,test-content-id .width-100{width:100% !important}test-content-id .sc{text-transform:none !important}test-content-id .right{float:none !important}test-content-id a.totri-footnote{padding:0 !important;display:inline}test-content-id table p[data-type="footnote"]{padding-left:1em !important}test-content-id figure.width-10,test-content-id figure.width-20,test-content-id figure.width-30,test-content-id figure.width-40,test-content-id figure.width-50,test-content-id figure.width-60,test-content-id figure.width-70,test-content-id figure.width-80,test-content-id figure.width-90{width:auto !important}
    </style>
  




</head>
<body class="js-preview-content  ">


<div class="skipToMain" id="skipToMain"><a href="#maincontent"><span class="skipToMain-text">Skip to main content</span></a></div>
<header role="banner" class="global">
  <div class="global-nav">
    <div class="content">
      <nav role="navigation" aria-label="site sections">
        <a href="https://www.oreilly.com" class="logo" title="home page" aria-current="page"><img src="https://cdn.oreillystatic.com/images/sitewide-headers/oreilly_logo_mark_red.svg" onerror="this.src='https://cdn.oreillystatic.com/images/sitewide-headers/oreilly_logo_mark_red_@2x.png'; this.onerror=null;" alt="O'Reilly home"></a>

        <button id="mobileNavButton" class="mobileNavButton mobileNavButton--collapse mobileNavButton--3dx" type="button" aria-expanded="false" aria-controls="menuList">
          <span class="mobileNavButton-box">
            <span class="mobileNavButton-inner"></span>
          </span>
        </button>


        <ul id="menuList" class="menuList mobileHidden ">
          <li class="menuList-itemsP1">
            <ul>
              
  <li class="menuList-item menuList-signIn"><a id="chapter-sign-in" class="t-sign-in" href="/member/login/?next=/library/view/typescript-cookbook/9781098136642/ch04.html">Sign In</a></li>


              <li class="menuList-item menuList-tryNow"><a class="menuList-cta" href="https://learning.oreilly.com/p/register/">Try Now</a></li>
            </ul>
          </li>
          <li class="menuList-itemsP2">
            <ul>
              <li class="menuList-item menuList-itemWithSub"><a href="https://www.oreilly.com/online-learning/teams.html">Teams</a>
                <ul class="menuList-subList menuList-itemWithSub">
                  <li class="menuList-subItem menuList-extra"><a href="https://www.oreilly.com/online-learning/business.html">For business</a></li>
                  <li class="menuList-subItem"><a href="https://www.oreilly.com/online-learning/government.html">For government</a></li>
                  <li class="menuList-subItem"><a href="https://www.oreilly.com/online-learning/academic.html">For higher ed</a></li>
                </ul>
              </li>
              <li class="menuList-item"><a href="https://www.oreilly.com/online-learning/individuals.html">Individuals</a></li>
              <li class="menuList-item menuList-itemWithSub"><a href="https://www.oreilly.com/online-learning/features.html">Features</a>
                <ul class="menuList-subList">
                  <li class="menuList-subItem menuList-extra"><a href="https://www.oreilly.com/online-learning/features.html">All features</a></li>
                  <li class="menuList-subItem"><a href="https://www.oreilly.com/online-learning/courses.html">Courses</a></li>
                  <li class="menuList-subItem"><a href="https://www.oreilly.com/online-learning/feature-certification.html">Certifications</a></li>
                  <li class="menuList-subItem"><a href="https://www.oreilly.com/online-learning/intro-interactive-learning.html">Interactive learning</a></li>
                  <li class="menuList-subItem"><a href="https://www.oreilly.com/online-learning/live-events.html">Live events</a></li>
                  <li class="menuList-subItem"><a href="https://www.oreilly.com/online-learning/feature-answers.html">Answers</a></li>
                  <li class="menuList-subItem"><a href="https://www.oreilly.com/online-learning/insights-dashboard.html">Insights reporting</a></li>
                </ul>
              </li>
              <li class="menuList-item"><a href="https://www.oreilly.com/radar/">Blog</a></li>
              <li class="menuList-item" id="nav-forMarketers"><a href="https://www.oreilly.com/content-marketing-solutions.html">Content sponsorship</a></li>
            </ul>
          </li>
        </ul>
      </nav>
    </div>
  </div>


  <div class="global-search">
    <div id="globalSearchContent" class="content">
      <form id="js-search-form" class="t-navigation-form" action="https://learning.oreilly.com/search/">
        
        <script type="application/ld+json">
        {
          "@context": "http://schema.org",
          "@type": "WebSite",
          "url": "https://learning.oreilly.com",
          "potentialAction": {
            "@type": "SearchAction",
            "target": "https://learning.oreilly.com/search/?q={search_term_string}",
            "query-input": "required name=search_term_string"
          }
        }
        </script>
        <input data-search-text-focus= "See everything available through the O’Reilly learning platform and start a free trial. Explore now." data-search-text-idle = "See everything available through the O’Reilly learning platform and start a free trial. Explore now." id="search" type="search" name="query" placeholder="See everything available through the O’Reilly learning platform and start a free trial. Explore now." autocomplete="off" required />
        <input type="submit" value="Search" class="search-submit" />
      </form>
    </div>
  </div>
</header>

    
    
        <div class="sbo-menu-top">
           
            <section class="sbo-toc-container">
                <a href="https://learning.oreilly.com/library/view/typescript-cookbook/9781098136642/" class="sbo-toc-thumb">
                    <span class="sbo-title ss-list">
                        
                            <h1 class="t-title">TypeScript Cookbook by Stefan Baumgartner</h1>
                        
                    </span>
                </a>
            </section>
             
        </div>
    


</header>


<section id="trial-overlay">
  <div class="trial-overlay-content">
    <p>Get full access to <em>TypeScript Cookbook</em> and 60K+ other titles, with a free 10-day trial of O'Reilly.</p>

    <p>There are also live events, courses curated by job role, <span class="nowrap">and more.</span></p>

    <div class="controls">
      <a href="https://learning.oreilly.com/p/register/" class="button-primary" data-ga-label="Bottom CTA">Start your free trial</a>
    </div>
    <a class="modal-dismiss" aria-label="modal dismiss"></a>
  </div>
</section>

<main role="main" id="maincontent">
  <div role="document" class="document">
  	
<section id="sbo-reader">
    
    

<div class="sbo-reader-content sbo-sample-reader ">
    
    <div id="sbo-rt-content" class="sbo-rt-content">
    <div id="test-content-id"><section data-type="chapter" epub:type="chapter" data-pdf-bookmark="Chapter 4. Generics"><div class="chapter" id="ch04">
<h1><span class="label">Chapter 4. </span>Generics</h1>


<p><a data-type="indexterm" data-primary="generics" id="id611"></a>Until now, our main goal was to take the inherent flexibility of JavaScript and find a way to formalize it through the type system. We added static types for a dynamically typed language, to communicate intent, get tooling, and catch bugs before they 
<span class="keep-together">happen.</span></p>

<p>Some parts in JavaScript don’t really care about static types, though. For example, an <code>isKeyAvailableInObject</code> function should only check if a key is available in an object; it doesn’t need to know about the concrete types. To properly formalize a function like this we can use TypeScript’s structural type system and describe either a very wide type for the price of information or a very strict type for the price of 
<span class="keep-together">flexibility.</span></p>

<p>But we don’t want to pay any price. We want both flexibility and information. Generics in TypeScript are just the silver bullet we need. We can describe complex relationships and formalize structure for data that has not been defined yet.</p>

<p>Generics, along with its gang of mapped types, type maps, type modifiers, and helper types, open the door to metatyping, where we can create new types based on old ones and keep relationships between types intact while the newly generated types challenge our original code for possible bugs.</p>

<p>This is the entrance to advanced TypeScript concepts. But fear not, <em>there shan’t be dragons</em>, unless we define them.</p>






<section data-type="sect1" data-pdf-bookmark="4.1 Generalizing Function Signatures"><div class="sect1" id="ch04_generalizing">
<h1>4.1 Generalizing Function Signatures</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="id213">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="function signatures" data-secondary="generalizing" id="ix_04-01-asciidoc0"></a><a data-type="indexterm" data-primary="generics" data-secondary="generalizing function signatures" id="ix_04-01-asciidoc1"></a>You have two functions that work the same, but on different and largely incompatible types.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="id71">
<h2>Solution</h2>

<p>Generalize their behavior using generics.<a data-type="indexterm" data-primary="test index tag" id="test-id-98989"></a></p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="id72">
<h2>Discussion</h2>

<p>You are writing an application that stores several language files (for example, subtitles) in an object. The keys are the language codes, and the values are URLs. You load language files by selecting them via a language code, which comes from some API or user interface as <code>string</code>. To make sure the language code is correct and valid, you add an <code>isLanguageAvailable</code> function that does an <code>in</code> check and sets the correct type using a type predicate:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">type</code> <code class="nx">Languages</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">de</code><code class="o">:</code> <code class="nx">URL</code><code class="p">;</code>
  <code class="nx">en</code><code class="o">:</code> <code class="nx">URL</code><code class="p">;</code>
  <code class="nx">pt</code><code class="o">:</code> <code class="nx">URL</code><code class="p">;</code>
  <code class="nx">es</code><code class="o">:</code> <code class="nx">URL</code><code class="p">;</code>
  <code class="nx">fr</code><code class="o">:</code> <code class="nx">URL</code><code class="p">;</code>
  <code class="nx">ja</code><code class="o">:</code> <code class="nx">URL</code><code class="p">;</code>
<code class="p">};</code>

<code class="kd">function</code> <code class="nx">isLanguageAvailable</code><code class="p">(</code>
  <code class="nx">collection</code><code class="o">:</code> <code class="nx">Languages</code><code class="p">,</code>
  <code class="nx">lang</code><code class="o">:</code> <code class="kt">string</code>
<code class="p">)</code><code class="o">:</code> <code class="nx">lang</code> <code class="nx">is</code> <code class="kr">keyof</code> <code class="nx">Languages</code> <code class="p">{</code>
  <code class="k">return</code> <code class="nx">lang</code> <code class="k">in</code> <code class="nx">collection</code><code class="p">;</code>
<code class="p">}</code>

<code class="kd">function</code> <code class="nx">loadLanguage</code><code class="p">(</code><code class="nx">collection</code><code class="o">:</code> <code class="nx">Languages</code><code class="p">,</code> <code class="nx">lang</code><code class="o">:</code> <code class="kt">string</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">if</code> <code class="p">(</code><code class="nx">isLanguageAvailable</code><code class="p">(</code><code class="nx">collection</code><code class="p">,</code> <code class="nx">lang</code><code class="p">))</code> <code class="p">{</code>
    <code class="c1">// lang is keyof Languages</code>
    <code class="nx">collection</code><code class="p">[</code><code class="nx">lang</code><code class="p">];</code> <code class="c1">// access ok!</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p>Same application, different scenario, entirely different file. You load media data into an HTML element: either audio, video, or a combination with certain animations in a <code>canvas</code> element. All elements exist in the application already, but you need to select the right one based on input from an API. Again, the selection comes as <code>string</code>, and you write an <code>isElementAllowed</code> function to ensure that the input is actually a valid key of your <code>AllowedElements</code> collection:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">type</code> <code class="nx">AllowedElements</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">video</code><code class="o">:</code> <code class="nx">HTMLVideoElement</code><code class="p">;</code>
  <code class="nx">audio</code><code class="o">:</code> <code class="nx">HTMLAudioElement</code><code class="p">;</code>
  <code class="nx">canvas</code><code class="o">:</code> <code class="nx">HTMLCanvasElement</code><code class="p">;</code>
<code class="p">};</code>

<code class="kd">function</code> <code class="nx">isElementAllowed</code><code class="p">(</code>
  <code class="nx">collection</code><code class="o">:</code> <code class="nx">AllowedElements</code><code class="p">,</code>
  <code class="nx">elem</code><code class="o">:</code> <code class="kt">string</code>
<code class="p">)</code><code class="o">:</code> <code class="nx">elem</code> <code class="nx">is</code> <code class="kr">keyof</code> <code class="nx">AllowedElements</code> <code class="p">{</code>
  <code class="k">return</code> <code class="nx">elem</code> <code class="k">in</code> <code class="nx">collection</code><code class="p">;</code>
<code class="p">}</code>

<code class="kd">function</code> <code class="nx">selectElement</code><code class="p">(</code><code class="nx">collection</code><code class="o">:</code> <code class="nx">AllowedElements</code><code class="p">,</code> <code class="nx">elem</code><code class="o">:</code> <code class="kt">string</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">if</code> <code class="p">(</code><code class="nx">isElementAllowed</code><code class="p">(</code><code class="nx">collection</code><code class="p">,</code> <code class="nx">elem</code><code class="p">))</code> <code class="p">{</code>
    <code class="c1">// elem is keyof AllowedElements</code>
    <code class="nx">collection</code><code class="p">[</code><code class="nx">elem</code><code class="p">];</code> <code class="c1">// access ok</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p>You don’t need to look too closely to see that both scenarios are very similar. The type guard functions especially catch our eye. If we strip away all the type information and align the names, they are identical:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">isAvailable</code><code class="p">(</code><code class="nx">obj</code><code class="p">,</code> <code class="nx">key</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">return</code> <code class="nx">key</code> <code class="k">in</code> <code class="nx">obj</code><code class="p">;</code>
<code class="p">}</code></pre>

<p>The two of them exist because of the type information we get. Not because of the input parameters, but because of the type predicates. In both scenarios we can tell more about the input parameters by asserting a specific <code>keyof</code> type.</p>

<p>The problem is that both input types for the collection are entirely different and have no overlap. Except for the empty object, for which we don’t get that much valuable information if we create a <code>keyof</code> type. <code>keyof {}</code> is actually <code>never</code>.</p>

<p>But there is some type information here that we can generalize. We know the first input parameter is an object. And the second one is a property key. If this check evaluates to <code>true</code>, we know that the first parameter is a key of the second parameter.</p>

<p><a data-type="indexterm" data-primary="generic type parameters" id="id612"></a>To generalize this function, we can add a <em>generic type parameter</em> to <code>isAvailable</code> called <code>Obj</code>, put in angle brackets. This is a placeholder for an actual type that will be substituted once <code>isAvailable</code> is used. We can use this <em>generic type parameter</em> like we would use <code>AllowedElements</code> or <code>Languages</code> and can add a type predicate. Since <code>Obj</code> can be substituted for <em>every</em> type, <code>key</code> needs to include all possible property keys—<code>string</code>, <code>symbol</code>, and <code>number</code>:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">isAvailable</code><code class="o">&lt;</code><code class="nx">Obj</code><code class="o">&gt;</code><code class="p">(</code>
  <code class="nx">obj</code><code class="o">:</code> <code class="nx">Obj</code><code class="p">,</code>
  <code class="nx">key</code><code class="o">:</code> <code class="kt">string</code> <code class="o">|</code> <code class="kt">number</code> <code class="o">|</code> <code class="nx">symbol</code>
<code class="p">)</code><code class="o">:</code> <code class="nx">key</code> <code class="nx">is</code> <code class="kr">keyof</code> <code class="nx">Obj</code> <code class="p">{</code>
  <code class="k">return</code> <code class="nx">key</code> <code class="k">in</code> <code class="nx">obj</code><code class="p">;</code>
<code class="p">}</code>

<code class="kd">function</code> <code class="nx">loadLanguage</code><code class="p">(</code><code class="nx">collection</code><code class="o">:</code> <code class="nx">Languages</code><code class="p">,</code> <code class="nx">lang</code><code class="o">:</code> <code class="kt">string</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">if</code> <code class="p">(</code><code class="nx">isAvailable</code><code class="p">(</code><code class="nx">collection</code><code class="p">,</code> <code class="nx">lang</code><code class="p">))</code> <code class="p">{</code>
    <code class="c1">// lang is keyof Languages</code>
    <code class="nx">collection</code><code class="p">[</code><code class="nx">lang</code><code class="p">];</code> <code class="c1">// access ok!</code>
  <code class="p">}</code>
<code class="p">}</code>

<code class="kd">function</code> <code class="nx">selectElement</code><code class="p">(</code><code class="nx">collection</code><code class="o">:</code> <code class="nx">AllowedElements</code><code class="p">,</code> <code class="nx">elem</code><code class="o">:</code> <code class="kt">string</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">if</code> <code class="p">(</code><code class="nx">isAvailable</code><code class="p">(</code><code class="nx">collection</code><code class="p">,</code> <code class="nx">elem</code><code class="p">))</code> <code class="p">{</code>
    <code class="c1">// elem is keyof AllowedElements</code>
    <code class="nx">collection</code><code class="p">[</code><code class="nx">elem</code><code class="p">];</code> <code class="c1">// access ok</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p>And there you have it: one function that works in both scenarios, no matter which types we substitute <code>Obj</code> for. Just like JavaScript works! We still get the same functionality, and we get the right type information. Index access becomes safe, without sacrificing flexibility.</p>

<p>The best part? We can use <code>isAvailable</code> just like we would use an untyped JavaScript equivalent. This is because TypeScript infers types for generic type parameters through usage. And this comes with some neat side effects. You can read more about that in <a data-type="xref" href="#ch04_no_any">Recipe 4.3</a>.<a data-type="indexterm" data-startref="ix_04-01-asciidoc1" id="id613"></a><a data-type="indexterm" data-startref="ix_04-01-asciidoc0" id="id614"></a></p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="4.2 Creating Related Function Arguments"><div class="sect1" id="ch04_related_function_arguments">
<h1>4.2 Creating Related Function Arguments</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="id214">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="function arguments" data-secondary="creating related" id="ix_04-02-asciidoc0"></a><a data-type="indexterm" data-primary="generics" data-secondary="creating related function arguments" id="ix_04-02-asciidoc1"></a>You write functions where the second parameter is dependent on the first one.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="id615">
<h2>Solution</h2>

<p>Annotate each parameter with a generic type and create a relationship between them through generic constraints.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="id73">
<h2>Discussion</h2>

<p>Similar to <a data-type="xref" href="#ch04_generalizing">Recipe 4.1</a>, our application stores a list of subtitles in an object of type 
<span class="keep-together"><code>Languages</code>.</span> <code>Languages</code> has a set of keys describing the language code and a URL 
<span class="keep-together">as the value:</span></p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">type</code> <code class="nx">Languages</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">de</code><code class="o">:</code> <code class="nx">URL</code><code class="p">;</code>
  <code class="nx">en</code><code class="o">:</code> <code class="nx">URL</code><code class="p">;</code>
  <code class="nx">pt</code><code class="o">:</code> <code class="nx">URL</code><code class="p">;</code>
  <code class="nx">es</code><code class="o">:</code> <code class="nx">URL</code><code class="p">;</code>
  <code class="nx">fr</code><code class="o">:</code> <code class="nx">URL</code><code class="p">;</code>
  <code class="nx">ja</code><code class="o">:</code> <code class="nx">URL</code><code class="p">;</code>
<code class="p">};</code>

<code class="kr">const</code> <code class="nx">languages</code><code class="o">:</code> <code class="nx">Languages</code> <code class="o">=</code> <code class="p">{</code> <code class="cm">/* ... */</code> <code class="p">};</code></pre>

<p>There are several lists like this in our application, and we can abstract them in a type called <code>URLList</code>, whose index signatures allow for any <code>string</code> key:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">type</code> <code class="nx">URLList</code> <code class="o">=</code> <code class="p">{</code>
  <code class="p">[</code><code class="nx">x</code><code class="o">:</code> <code class="kt">string</code><code class="p">]</code><code class="o">:</code> <code class="nx">URL</code><code class="p">;</code>
<code class="p">};</code></pre>

<p><code>URLList</code> is a supertype of <code>Languages</code>: every value of type <code>Languages</code> is a <code>URLList</code>, but not every <code>URLList</code> is <code>Languages</code>. Still, we can use <code>URLList</code> to write a function called <code>fetchFile</code>, where we load a specific entry from this list:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">fetchFile</code><code class="p">(</code><code class="nx">urls</code><code class="o">:</code> <code class="nx">URLList</code><code class="p">,</code> <code class="nx">key</code><code class="o">:</code> <code class="kt">string</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">return</code> <code class="nx">fetch</code><code class="p">(</code><code class="nx">urls</code><code class="p">[</code><code class="nx">key</code><code class="p">]).</code><code class="nx">then</code><code class="p">((</code><code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">res</code><code class="p">.</code><code class="nx">json</code><code class="p">());</code>
<code class="p">}</code>

<code class="kr">const</code> <code class="nx">de</code> <code class="o">=</code> <code class="nx">fetchFile</code><code class="p">(</code><code class="nx">languages</code><code class="p">,</code> <code class="s2">"de"</code><code class="p">);</code>
<code class="kr">const</code> <code class="nx">it</code> <code class="o">=</code> <code class="nx">fetchFile</code><code class="p">(</code><code class="nx">languages</code><code class="p">,</code> <code class="s2">"it"</code><code class="p">);</code></pre>

<p>The problem is that type <code>string</code> for <code>key</code> allows for way too many entries. For example, no Italian subtitles are defined, but <code>fetchFile</code> doesn’t keep us from loading <code>"it"</code> as a language code anyway. When we load items from a specific <code>URLList</code>, it would be great to also know which keys we can access.</p>

<p><a data-type="indexterm" data-primary="generic constant" id="id616"></a>We can solve this by substituting the broader type for a generic and setting a <em>generic constraint</em> to make sure we pass a subtype of <code>URLList</code>. This way, the function signature behaves very similarly to before, but we can work with the subtituted types much better. <a data-type="indexterm" data-primary="generic type parameters" id="ix_04-03-asciidoc1"></a>We define a <em>generic type parameter</em> <code>List</code> which is a subtype of <code>URLList</code> and set <code>key</code> to <code>keyof List</code>:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">fetchFile</code><code class="o">&lt;</code><code class="nx">List</code> <code class="kr">extends</code> <code class="nx">URLList</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">urls</code><code class="o">:</code> <code class="nx">List</code><code class="p">,</code> <code class="nx">key</code><code class="o">:</code> <code class="kr">keyof</code> <code class="nx">List</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">return</code> <code class="nx">fetch</code><code class="p">(</code><code class="nx">urls</code><code class="p">[</code><code class="nx">key</code><code class="p">]).</code><code class="nx">then</code><code class="p">((</code><code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">res</code><code class="p">.</code><code class="nx">json</code><code class="p">());</code>
<code class="p">}</code>

<code class="kr">const</code> <code class="nx">de</code> <code class="o">=</code> <code class="nx">fetchFile</code><code class="p">(</code><code class="nx">languages</code><code class="p">,</code> <code class="s2">"de"</code><code class="p">);</code>
<code class="kr">const</code> <code class="nx">it</code> <code class="o">=</code> <code class="nx">fetchFile</code><code class="p">(</code><code class="nx">languages</code><code class="p">,</code> <code class="s2">"it"</code><code class="p">);</code>
<code class="c1">//                               ^</code>
<code class="c1">// Argument of type '"it"' is not assignable to</code>
<code class="c1">// parameter of type 'keyof Languages'.(2345)</code></pre>

<p>The moment we call <code>fetchFile</code>, <code>List</code> will be substituted for an actual type, and we know that <code>"it"</code> is not part of the keys of <code>Languages</code>. TypeScript will show us when we made a typo or selected elements that aren’t part of our data types.</p>

<p>This also works if we are loading many keys. The same constraints, the same effect:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">fetchFiles</code><code class="o">&lt;</code><code class="nx">List</code> <code class="kr">extends</code> <code class="nx">URLList</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">urls</code><code class="o">:</code> <code class="nx">List</code><code class="p">,</code> <code class="nx">keys</code><code class="o">:</code> <code class="p">(</code><code class="kr">keyof</code> <code class="nx">List</code><code class="p">)[])</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="nx">els</code> <code class="o">=</code> <code class="nx">keys</code><code class="p">.</code><code class="nx">map</code><code class="p">((</code><code class="nx">el</code><code class="p">)</code> <code class="o">=&gt;</code>
    <code class="nx">fetch</code><code class="p">(</code><code class="nx">urls</code><code class="p">[</code><code class="nx">el</code><code class="p">])</code>
      <code class="p">.</code><code class="nx">then</code><code class="p">((</code><code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">res</code><code class="p">.</code><code class="nx">json</code><code class="p">())</code>
      <code class="p">.</code><code class="nx">then</code><code class="p">((</code><code class="nx">data</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">[</code><code class="nx">el</code><code class="p">,</code> <code class="nx">data</code><code class="p">])</code>
  <code class="p">);</code>
  <code class="k">return</code> <code class="nx">els</code><code class="p">;</code>
<code class="p">}</code>

<code class="kr">const</code> <code class="nx">de_and_fr</code> <code class="o">=</code> <code class="nx">fetchFiles</code><code class="p">(</code><code class="nx">languages</code><code class="p">,</code> <code class="p">[</code><code class="s2">"de"</code><code class="p">,</code> <code class="s2">"fr"</code><code class="p">]);</code> <code class="c1">// Promise&lt;any[]≥[]</code>
<code class="kr">const</code> <code class="nx">de_and_it</code> <code class="o">=</code> <code class="nx">fetchFiles</code><code class="p">(</code><code class="nx">languages</code><code class="p">,</code> <code class="p">[</code><code class="s2">"de"</code><code class="p">,</code> <code class="s2">"it"</code><code class="p">]);</code>
<code class="c1">//                                             ^</code>
<code class="c1">//  Type '"it"' is not assignable to type 'keyof Languages'.(2322)</code></pre>

<p>We store the results in a tuple with the language key as first element and the data as the second element. However, when we get the result, it’s an array of <code>Promise</code>s that resolve to an <code>any[]</code>. This is understandable, as <code>fetch</code> does not tell us anything about the data loaded, and with <code>data</code> being of type <code>any</code> and thus having the broadest type, it just swallows <code>el</code>, which is <code>keyof List</code>.</p>

<p>But we know more at this stage. We know, for example, that <code>[el, data]</code> is not an array but a tuple. There is a subtle but important difference, as shown in <a data-type="xref" href="ch02.html#ch02_item_tuple_types">Recipe 2.4</a>. If we annotate the result with a tuple type, we get more information from our return values:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">fetchFiles</code><code class="o">&lt;</code><code class="nx">List</code> <code class="kr">extends</code> <code class="nx">URLList</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">urls</code><code class="o">:</code> <code class="nx">List</code><code class="p">,</code> <code class="nx">keys</code><code class="o">:</code> <code class="p">(</code><code class="kr">keyof</code> <code class="nx">List</code><code class="p">)[])</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="nx">els</code> <code class="o">=</code> <code class="nx">keys</code><code class="p">.</code><code class="nx">map</code><code class="p">((</code><code class="nx">el</code><code class="p">)</code> <code class="o">=&gt;</code>
    <code class="nx">fetch</code><code class="p">(</code><code class="nx">urls</code><code class="p">[</code><code class="nx">el</code><code class="p">])</code>
      <code class="p">.</code><code class="nx">then</code><code class="p">((</code><code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">res</code><code class="p">.</code><code class="nx">json</code><code class="p">())</code>
      <code class="p">.</code><code class="nx">then</code><code class="p">((</code><code class="nx">data</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
        <code class="kr">const</code> <code class="nx">entry</code><code class="o">:</code> <code class="p">[</code><code class="kr">keyof</code> <code class="nx">List</code><code class="p">,</code> <code class="kr">any</code><code class="p">]</code> <code class="o">=</code> <code class="p">[</code><code class="nx">el</code><code class="p">,</code> <code class="nx">data</code><code class="p">];</code>
        <code class="k">return</code> <code class="nx">entry</code><code class="p">;</code>
      <code class="p">})</code>
  <code class="p">);</code>
  <code class="k">return</code> <code class="nx">els</code><code class="p">;</code>
<code class="p">}</code>

<code class="kr">const</code> <code class="nx">de_and_fr</code> <code class="o">=</code> <code class="nx">fetchFiles</code><code class="p">(</code><code class="nx">languages</code><code class="p">,</code> <code class="p">[</code><code class="s2">"de"</code><code class="p">,</code> <code class="s2">"fr"</code><code class="p">]);</code></pre>

<p><code>fetchFiles</code> now returns an array of <code>Promise</code>s of <code>[keyof List, any]</code>. So the moment we substitute <code>List</code> for <code>Languages</code>, we know that the only possible keys can be 
<span class="keep-together">language codes.</span></p>

<p>However, there’s still one caveat. As the preceding code sample shows, the only languages available in <code>de_and_fr</code> are German and French, but the compiler doesn’t warn us that we check for English later on. The compiler should be able to do that, because this condition will always return false:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="k">for</code> <code class="p">(</code><code class="kr">const</code> <code class="nx">result</code> <code class="nx">of</code> <code class="nx">de_and_fr</code><code class="p">)</code> <code class="p">{</code>
  <code class="k">if</code> <code class="p">(</code><code class="nx">result</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code> <code class="o">===</code> <code class="s2">"en"</code><code class="p">)</code> <code class="p">{</code>
    <code class="c1">// English?</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p>The problem is that we are dealing again with a type that is way too broad. Yes, <code>keyof List</code> is already a lot narrower than <code>string</code>, but we can substitute all keys for a smaller set as well.<a data-type="indexterm" data-startref="test-id-98989" id="id617"></a></p>

<p>We need to repeat the same process:</p>
<ol>
<li>
<p>Create a new generic type parameter.</p>
</li>
<li>
<p>Set the broader type as a constraint of the newly created generic type parameter.</p>
</li>
<li>
<p>Use the parameter in the function signature to be substituted for an actual type.</p>
</li>

</ol>

<p>And just like that, we can also substitute <code>keyof List</code> with a subtype: <code>"de" | "fr"</code>:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">fetchFiles</code><code class="o">&lt;</code><code class="nx">List</code> <code class="kr">extends</code> <code class="nx">URLList</code><code class="p">,</code> <code class="nx">Keys</code> <code class="kr">extends</code> <code class="kr">keyof</code> <code class="nx">List</code><code class="o">&gt;</code><code class="p">(</code>
  <code class="nx">urls</code><code class="o">:</code> <code class="nx">List</code><code class="p">,</code>
  <code class="nx">keys</code><code class="o">:</code> <code class="nx">Keys</code><code class="p">[]</code>
<code class="p">)</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="nx">els</code> <code class="o">=</code> <code class="nx">keys</code><code class="p">.</code><code class="nx">map</code><code class="p">((</code><code class="nx">el</code><code class="p">)</code> <code class="o">=&gt;</code>
    <code class="nx">fetch</code><code class="p">(</code><code class="nx">urls</code><code class="p">[</code><code class="nx">el</code><code class="p">])</code>
      <code class="p">.</code><code class="nx">then</code><code class="p">((</code><code class="nx">res</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="nx">res</code><code class="p">.</code><code class="nx">json</code><code class="p">())</code>
      <code class="p">.</code><code class="nx">then</code><code class="p">((</code><code class="nx">data</code><code class="p">)</code> <code class="o">=&gt;</code> <code class="p">{</code>
        <code class="kr">const</code> <code class="nx">entry</code><code class="o">:</code> <code class="p">[</code><code class="nx">Keys</code><code class="p">,</code> <code class="kr">any</code><code class="p">]</code> <code class="o">=</code> <code class="p">[</code><code class="nx">el</code><code class="p">,</code> <code class="nx">data</code><code class="p">];</code>
        <code class="k">return</code> <code class="nx">entry</code><code class="p">;</code>
      <code class="p">})</code>
  <code class="p">);</code>
  <code class="k">return</code> <code class="nx">els</code><code class="p">;</code>
<code class="p">}</code>

<code class="kr">const</code> <code class="nx">de_and_fr</code> <code class="o">=</code> <code class="nx">fetchFiles</code><code class="p">(</code><code class="nx">languages</code><code class="p">,</code> <code class="p">[</code><code class="s2">"de"</code><code class="p">,</code> <code class="s2">"fr"</code><code class="p">]);</code></pre>

<p>What’s nice about this is that we can set relationships between generic type parameters. The second type parameter can be constrained by something from the first generic type parameter. This allows us to narrow very specifically, until we substitute with real values. The effect? We know about possible values of our types anywhere in our code. So we won’t check for English language if we can already say that we never requested to load English:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="k">for</code> <code class="p">(</code><code class="kr">const</code> <code class="nx">entry</code> <code class="nx">of</code> <code class="nx">de_and_fr</code><code class="p">)</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="nx">result</code> <code class="o">=</code> <code class="kr">await</code> <code class="nx">entry</code><code class="p">;</code>
  <code class="k">if</code> <code class="p">(</code><code class="nx">result</code><code class="p">[</code><code class="mi">0</code><code class="p">]</code> <code class="o">===</code> <code class="s2">"en"</code><code class="p">)</code> <code class="p">{</code>
    <code class="c1">//  This condition will always return 'false' since the types</code>
    <code class="c1">//. '"de" | "fr"' and '"en"' have no overlap.(2367)</code>
  <code class="p">}</code>
<code class="p">}</code></pre>

<p>One check that we didn’t get rid of is to see which language is at position 0.</p>

<p><a data-type="indexterm" data-primary="generic instantiation" id="id618"></a>One thing that we didn’t take into account is <em>generic instantiation</em>. We let type parameters be substituted for real values through usage, just like type inference. But we also could substitute them explicitly through annotations:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">const</code> <code class="nx">de_and_ja</code> <code class="o">=</code> <code class="nx">fetchFiles</code><code class="o">&lt;</code><code class="nx">Languages</code><code class="p">,</code> <code class="s2">"ja"</code> <code class="o">|</code> <code class="s2">"de"</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">languages</code><code class="p">,</code> <code class="p">[</code><code class="s2">"de"</code><code class="p">]);</code></pre>

<p>Here the types tell us there might be Japanese subtitles as well, even though we can see from usage that we load only German ones. Let this be a reminder, and get more insights in <a data-type="xref" href="#ch04_understanding_generic_instantiation">Recipe 4.4</a>.<a data-type="indexterm" data-startref="ix_04-02-asciidoc1" id="id619"></a><a data-type="indexterm" data-startref="ix_04-02-asciidoc0" id="id620"></a></p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="4.3 Getting Rid of any and unknown"><div class="sect1" id="ch04_no_any">
<h1>4.3 Getting Rid of any and unknown</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="id215">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="any type" data-secondary="generic type parameters as alternative to" id="ix_04-03-asciidoc0"></a><a data-type="indexterm" data-primary="generics" data-secondary="getting rid of any and unknown" id="ix_04-03-asciidoc2"></a><a data-type="indexterm" data-primary="unknown type" data-secondary="generic type parameters as alternative to" id="ix_04-03-asciidoc3"></a>Generic type parameters, <code>any</code>, and <code>unknown</code> all seem to describe very wide sets of values. When should you use what?</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="id621">
<h2>Solution</h2>

<p>Use generic type parameters when you get to the actual type eventually; refer to <a data-type="xref" href="ch02.html#ch02_item_any">Recipe 2.2</a> on the decision between <code>any</code> and <code>unknown</code>.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="id74">
<h2>Discussion</h2>

<p>When we are using generics, they might seem like a substitute for <code>any</code> and <code>unknown</code>. Take an <code>identity</code> function—its only job is to return the value passed as input 
<span class="keep-together">parameter:</span></p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">identity</code><code class="p">(</code><code class="nx">value</code><code class="o">:</code> <code class="kr">any</code><code class="p">)</code><code class="o">:</code> <code class="kr">any</code> <code class="p">{</code>
  <code class="k">return</code> <code class="nx">value</code><code class="p">;</code>
<code class="p">}</code>

<code class="kd">let</code> <code class="nx">a</code> <code class="o">=</code> <code class="nx">identity</code><code class="p">(</code><code class="s2">"Hello!"</code><code class="p">);</code>
<code class="kd">let</code> <code class="nx">b</code> <code class="o">=</code> <code class="nx">identity</code><code class="p">(</code><code class="kc">false</code><code class="p">);</code>
<code class="kd">let</code> <code class="nx">c</code> <code class="o">=</code> <code class="nx">identity</code><code class="p">(</code><code class="mi">2</code><code class="p">);</code></pre>

<p>It takes values of every type, and the return type of it can also be anything. We can write the same function using <code>unknown</code> if we want to safely access properties:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">identity</code><code class="p">(</code><code class="nx">value</code><code class="o">:</code> <code class="kr">unknown</code><code class="p">)</code><code class="o">:</code> <code class="kr">unknown</code> <code class="p">{</code>
  <code class="k">return</code> <code class="nx">value</code><code class="p">;</code>
<code class="p">}</code>

<code class="kd">let</code> <code class="nx">a</code> <code class="o">=</code> <code class="nx">identity</code><code class="p">(</code><code class="s2">"Hello!"</code><code class="p">);</code>
<code class="kd">let</code> <code class="nx">b</code> <code class="o">=</code> <code class="nx">identity</code><code class="p">(</code><code class="kc">false</code><code class="p">);</code>
<code class="kd">let</code> <code class="nx">c</code> <code class="o">=</code> <code class="nx">identity</code><code class="p">(</code><code class="mi">2</code><code class="p">);</code></pre>

<p>We can even mix and match <code>any</code> and <code>unknown</code>, but the result is always the same: Type information is lost. The type of the return value is what we define it to be.</p>

<p>Now let’s write the same function with generics instead of <code>any</code> or <code>unknown</code>. Its type annotations say that the generic type is also the return type:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">identity</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">t</code><code class="o">:</code> <code class="nx">T</code><code class="p">)</code><code class="o">:</code> <code class="nx">T</code> <code class="p">{</code>
  <code class="k">return</code> <code class="nx">t</code><code class="p">;</code>
<code class="p">}</code></pre>

<p>We can use this function to pass in any value and see which type TypeScript infers:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">let</code> <code class="nx">a</code> <code class="o">=</code> <code class="nx">identity</code><code class="p">(</code><code class="s2">"Hello!"</code><code class="p">);</code> <code class="c1">// a is string</code>
<code class="kd">let</code> <code class="nx">b</code> <code class="o">=</code> <code class="nx">identity</code><code class="p">(</code><code class="mi">2000</code><code class="p">);</code>     <code class="c1">// b is number</code>
<code class="kd">let</code> <code class="nx">c</code> <code class="o">=</code> <code class="nx">identity</code><code class="p">({</code> <code class="nx">a</code><code class="o">:</code> <code class="mi">2</code> <code class="p">});</code> <code class="c1">// c is { a: number }</code></pre>

<p>Assigning to a binding with <code>const</code> instead of <code>let</code> gives slightly different results:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">const</code> <code class="nx">a</code> <code class="o">=</code> <code class="nx">identity</code><code class="p">(</code><code class="s2">"Hello!"</code><code class="p">);</code> <code class="c1">// a is "Hello!"</code>
<code class="kr">const</code> <code class="nx">b</code> <code class="o">=</code> <code class="nx">identity</code><code class="p">(</code><code class="mi">2000</code><code class="p">);</code>     <code class="c1">// b is 2000</code>
<code class="kr">const</code> <code class="nx">c</code> <code class="o">=</code> <code class="nx">identity</code><code class="p">({</code> <code class="nx">a</code><code class="o">:</code> <code class="mi">2</code> <code class="p">});</code> <code class="c1">// c is { a: number }</code></pre>

<p>For primitive types, TypeScript substitutes the generic type parameter with the actual type. We can make great use of this in more advanced scenarios.</p>

<p>With TypeScript’s generics, it’s also possible to <em>annotate</em> the generic type parameter:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">const</code> <code class="nx">a</code> <code class="o">=</code> <code class="nx">identity</code><code class="o">&lt;</code><code class="kt">string</code><code class="o">&gt;</code><code class="p">(</code><code class="s2">"Hello!"</code><code class="p">);</code> <code class="c1">// a is string</code>
<code class="kr">const</code> <code class="nx">b</code> <code class="o">=</code> <code class="nx">identity</code><code class="o">&lt;</code><code class="kt">number</code><code class="o">&gt;</code><code class="p">(</code><code class="mi">2000</code><code class="p">);</code>     <code class="c1">// b is number</code>
<code class="kr">const</code> <code class="nx">c</code> <code class="o">=</code> <code class="nx">identity</code><code class="o">&lt;</code><code class="p">{</code> <code class="nx">a</code><code class="o">:</code> <code class="mi">2</code> <code class="p">}</code><code class="o">&gt;</code><code class="p">({</code> <code class="nx">a</code><code class="o">:</code> <code class="mi">2</code> <code class="p">});</code> <code class="c1">// c is { a: 2 }</code></pre>

<p>If this behavior reminds you of annotation and inference described in <a data-type="xref" href="ch03.html#ch03_item_const_context">Recipe 3.4</a>, you are absolutely right. It’s very similar but with generic type parameters in functions.</p>

<p>When using generics without constraints, we can write functions that work with values of any type. Inside, they behave like <code>unknown</code>, which means we can do type guards to narrow the type. The biggest difference is that once we use the function, we substitute our generics with real types, not losing any information on typing at all.</p>

<p>This allows us to be a bit clearer with our types than just allowing everything. This <code>pairs</code> function takes two arguments and creates a tuple:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">pairs</code><code class="p">(</code><code class="nx">a</code><code class="o">:</code> <code class="kr">unknown</code><code class="p">,</code> <code class="nx">b</code><code class="o">:</code> <code class="kr">unknown</code><code class="p">)</code><code class="o">:</code> <code class="p">[</code><code class="kr">unknown</code><code class="p">,</code> <code class="kr">unknown</code><code class="p">]</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">[</code><code class="nx">a</code><code class="p">,</code> <code class="nx">b</code><code class="p">];</code>
<code class="p">}</code>

<code class="kr">const</code> <code class="nx">a</code> <code class="o">=</code> <code class="nx">pairs</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="s2">"1"</code><code class="p">);</code> <code class="c1">// [unknown, unknown]</code></pre>

<p>With generic type parameters, we get a nice tuple type:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">pairs</code><code class="o">&lt;</code><code class="nx">T</code><code class="p">,</code> <code class="nx">U</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">a</code><code class="o">:</code> <code class="nx">T</code><code class="p">,</code> <code class="nx">b</code><code class="o">:</code> <code class="nx">U</code><code class="p">)</code><code class="o">:</code> <code class="p">[</code><code class="nx">T</code><code class="p">,</code> <code class="nx">U</code><code class="p">]</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">[</code><code class="nx">a</code><code class="p">,</code> <code class="nx">b</code><code class="p">];</code>
<code class="p">}</code>

<code class="kr">const</code> <code class="nx">b</code> <code class="o">=</code> <code class="nx">pairs</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="s2">"1"</code><code class="p">);</code> <code class="c1">// [number, string]</code></pre>

<p>Using the same generic type parameter, we can make sure we get tuples only where each element is of the same type:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">pairs</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">a</code><code class="o">:</code> <code class="nx">T</code><code class="p">,</code> <code class="nx">b</code><code class="o">:</code> <code class="nx">T</code><code class="p">)</code><code class="o">:</code> <code class="p">[</code><code class="nx">T</code><code class="p">,</code> <code class="nx">T</code><code class="p">]</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">[</code><code class="nx">a</code><code class="p">,</code> <code class="nx">b</code><code class="p">];</code>
<code class="p">}</code>

<code class="kr">const</code> <code class="nx">c</code> <code class="o">=</code> <code class="nx">pairs</code><code class="p">(</code><code class="mi">1</code><code class="p">,</code> <code class="s2">"1"</code><code class="p">);</code>
<code class="c1">//                  ^</code>
<code class="c1">// Argument of type 'string' is not assignable to parameter of type 'number'</code></pre>

<p>So, should you use generics everywhere? Not necessarily. This chapter includes many solutions that rely on getting the right type information at the right time. When you are happy with a wider set of values and can rely on subtypes being compatible, you don’t need to use generics at all. If you have <code>any</code> and <code>unknown</code> in your code, think whether you need the actual type at some point. Adding a generic type parameter instead might help.<a data-type="indexterm" data-startref="ix_04-03-asciidoc3" id="id622"></a><a data-type="indexterm" data-startref="ix_04-03-asciidoc2" id="id623"></a><a data-type="indexterm" data-startref="ix_04-03-asciidoc1" id="id624"></a><a data-type="indexterm" data-startref="ix_04-03-asciidoc0" id="id625"></a></p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="4.4 Understanding Generic Instantiation"><div class="sect1" id="ch04_understanding_generic_instantiation">
<h1>4.4 Understanding Generic Instantiation</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="id75">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="generics" data-secondary="instantiation" id="ix_04-06-asciidoc0"></a><a data-type="indexterm" data-primary="instantiation" data-secondary="generics and" id="ix_04-06-asciidoc1"></a><a data-type="indexterm" data-primary="subtypes, generic instantiation and" id="ix_04-06-asciidoc2"></a>You understand how generics are substituted for real types, but sometimes errors like “<code>Foo</code> is assignable to the constraint of type <code>Bar</code>, but could be instantiated with a different subtype of constraint <code>Baz</code>” confuse you.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="id626">
<h2>Solution</h2>

<p>Remember that values of a generic type can be—explicitly and implicitly—substituted with a variety of subtypes. Write subtype-friendly code.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="id76">
<h2>Discussion</h2>

<p>You create a filter logic for your application. You have different filter rules that you can combine using <code>"and" | "or"</code> combinators. You can also chain regular filter rules with the outcome of <em>combinatorial filters</em>. You create your types based on this 
<span class="keep-together">behavior:</span></p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">type</code> <code class="nx">FilterRule</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">field</code><code class="o">:</code> <code class="kt">string</code><code class="p">;</code>
  <code class="nx">operator</code><code class="o">:</code> <code class="kt">string</code><code class="p">;</code>
  <code class="nx">value</code><code class="o">:</code> <code class="kr">any</code><code class="p">;</code>
<code class="p">};</code>

<code class="kr">type</code> <code class="nx">CombinatorialFilter</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">combinator</code><code class="o">:</code> <code class="s2">"and"</code> <code class="o">|</code> <code class="s2">"or"</code><code class="p">;</code>
  <code class="nx">rules</code><code class="o">:</code> <code class="nx">FilterRule</code><code class="p">[];</code>
<code class="p">};</code>

<code class="kr">type</code> <code class="nx">ChainedFilter</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">rules</code><code class="o">:</code> <code class="p">(</code><code class="nx">CombinatorialFilter</code> <code class="o">|</code> <code class="nx">FilterRule</code><code class="p">)[];</code>
<code class="p">};</code>

<code class="kr">type</code> <code class="nx">Filter</code> <code class="o">=</code> <code class="nx">CombinatorialFilter</code> <code class="o">|</code> <code class="nx">ChainedFilter</code><code class="p">;</code></pre>

<p>Now you want to write a <code>reset</code> function that, based on an already provided filter, resets all rules. You use type guards to distinguish between <code>CombinatorialFilter</code> and <code>ChainedFilter</code>:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">reset</code><code class="p">(</code><code class="nx">filter</code><code class="o">:</code> <code class="nx">Filter</code><code class="p">)</code><code class="o">:</code> <code class="nx">Filter</code> <code class="p">{</code>
  <code class="k">if</code> <code class="p">(</code><code class="s2">"combinator"</code> <code class="k">in</code> <code class="nx">filter</code><code class="p">)</code> <code class="p">{</code>
    <code class="c1">// filter is CombinatorialFilter</code>
    <code class="k">return</code> <code class="p">{</code> <code class="nx">combinator</code><code class="o">:</code> <code class="s2">"and"</code><code class="p">,</code> <code class="nx">rules</code><code class="o">:</code> <code class="p">[]</code> <code class="p">};</code>
  <code class="p">}</code>
  <code class="c1">// filter is ChainedFilter</code>
  <code class="k">return</code> <code class="p">{</code> <code class="nx">rules</code><code class="o">:</code> <code class="p">[]</code> <code class="p">};</code>
<code class="p">}</code>

<code class="kr">const</code> <code class="nx">filter</code><code class="o">:</code> <code class="nx">CombinatorialFilter</code> <code class="o">=</code> <code class="p">{</code> <code class="nx">rules</code><code class="o">:</code> <code class="p">[],</code> <code class="nx">combinator</code><code class="o">:</code> <code class="s2">"or"</code> <code class="p">};</code>
<code class="kr">const</code> <code class="nx">resetFilter</code> <code class="o">=</code> <code class="nx">reset</code><code class="p">(</code><code class="nx">filter</code><code class="p">);</code> <code class="c1">// resetFilter is Filter</code></pre>

<p>The behavior is what you are after, but the return type of <code>reset</code> is too wide. When we pass a <code>CombinatorialFilter</code>, we should be sure that the reset filter is also a <code>Co⁠mb⁠in⁠ato⁠rial​Fil⁠ter</code>. Here it’s the union type, just like our function signature indicates. But you want to make sure that if you pass a filter of a certain type, you also get the same return type. So you replace the broad union type with a generic type parameter that is constrained to <code>Filter</code>. The return type works as intended, but the implementation of your function throws errors:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">reset</code><code class="o">&lt;</code><code class="nx">F</code> <code class="kr">extends</code> <code class="nx">Filter</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">filter</code><code class="o">:</code> <code class="nx">F</code><code class="p">)</code><code class="o">:</code> <code class="nx">F</code> <code class="p">{</code>
  <code class="k">if</code> <code class="p">(</code><code class="s2">"combinator"</code> <code class="k">in</code> <code class="nx">filter</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">return</code> <code class="p">{</code> <code class="nx">combinator</code><code class="o">:</code> <code class="s2">"and"</code><code class="p">,</code> <code class="nx">rules</code><code class="o">:</code> <code class="p">[]</code> <code class="p">};</code>
<code class="c1">//  ^ '{ combinator: "and"; rules: never[]; }' is assignable to</code>
<code class="c1">//     the constraint of type 'F', but 'F' could be instantiated</code>
<code class="c1">//     with a different subtype of constraint 'Filter'.</code>
  <code class="p">}</code>
  <code class="k">return</code> <code class="p">{</code> <code class="nx">rules</code><code class="o">:</code> <code class="p">[]</code> <code class="p">};</code>
<code class="c1">//^ '{ rules: never[]; }' is assignable to the constraint of type 'F',</code>
<code class="c1">//   but 'F' could be instantiated with a different subtype of</code>
<code class="c1">//   constraint 'Filter'.</code>
<code class="p">}</code>

<code class="kr">const</code> <code class="nx">resetFilter</code> <code class="o">=</code> <code class="nx">reset</code><code class="p">(</code><code class="nx">filter</code><code class="p">);</code> <code class="c1">// resetFilter is CombinatorialFilter</code></pre>

<p>While you want to differentiate between two parts of a union, TypeScript thinks more broadly. It knows that you might pass in an object that is <em>structurally compatible</em> with <code>Filter</code>, but it has more properties and is therefore a subtype.</p>

<p>This means you can call <code>reset</code> with <code>F</code> instantiated to a subtype, and your program would happily override all excess properties. This is wrong, and TypeScript tells you that:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">const</code> <code class="nx">onDemandFilter</code> <code class="o">=</code> <code class="nx">reset</code><code class="p">({</code>
  <code class="nx">combinator</code><code class="o">:</code> <code class="s2">"and"</code><code class="p">,</code>
  <code class="nx">rules</code><code class="o">:</code> <code class="p">[],</code>
  <code class="nx">evaluated</code><code class="o">:</code> <code class="kc">true</code><code class="p">,</code>
  <code class="nx">result</code><code class="o">:</code> <code class="kc">false</code><code class="p">,</code>
<code class="p">});</code>
<code class="cm">/* filter is {</code>
<code class="cm">    combinator: "and";</code>
<code class="cm">    rules: never[];</code>
<code class="cm">    evaluated: boolean;</code>
<code class="cm">    result: boolean;</code>
<code class="cm">}; */</code></pre>

<p>Overcome this by writing subtype-friendly code. Clone the input object (still type <code>F</code>), set the properties that need to be changed accordingly, and return something that is still of type <code>F</code>:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">reset</code><code class="o">&lt;</code><code class="nx">F</code> <code class="kr">extends</code> <code class="nx">Filter</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">filter</code><code class="o">:</code> <code class="nx">F</code><code class="p">)</code><code class="o">:</code> <code class="nx">F</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="nx">result</code> <code class="o">=</code> <code class="p">{</code> <code class="p">...</code><code class="nx">filter</code> <code class="p">};</code> <code class="c1">// result is F</code>
  <code class="nx">result</code><code class="p">.</code><code class="nx">rules</code> <code class="o">=</code> <code class="p">[];</code>
  <code class="k">if</code> <code class="p">(</code><code class="s2">"combinator"</code> <code class="k">in</code> <code class="nx">result</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">result</code><code class="p">.</code><code class="nx">combinator</code> <code class="o">=</code> <code class="s2">"and"</code><code class="p">;</code>
  <code class="p">}</code>
  <code class="k">return</code> <code class="nx">result</code><code class="p">;</code>
<code class="p">}</code>

<code class="kr">const</code> <code class="nx">resetFilter</code> <code class="o">=</code> <code class="nx">reset</code><code class="p">(</code><code class="nx">filter</code><code class="p">);</code> <code class="c1">// resetFilter is CombinatorialFilter</code></pre>

<p>Generic types can be one of many in a union, but they can be much, much more. TypeScript’s structural type system allows you to work on a variety of subtypes, and your code needs to reflect that.</p>

<p>Here’s a different scenario but with a similar outcome. You want to create a tree data structure and write a recursive type that stores all tree items. This type can be 
<span class="keep-together">subtyped,</span> so you write a <code>createRootItem</code> function with a generic type parameter since you want to instantiate it with the correct subtype:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">type</code> <code class="nx">TreeItem</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">id</code><code class="o">:</code> <code class="kt">string</code><code class="p">;</code>
  <code class="nx">children</code><code class="o">:</code> <code class="nx">TreeItem</code><code class="p">[];</code>
  <code class="nx">collapsed</code><code class="o">?:</code> <code class="kr">boolean</code><code class="p">;</code>
<code class="p">};</code>

<code class="kd">function</code> <code class="nx">createRootItem</code><code class="o">&lt;</code><code class="nx">T</code> <code class="kr">extends</code> <code class="nx">TreeItem</code><code class="o">&gt;</code><code class="p">()</code><code class="o">:</code> <code class="nx">T</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">{</code>
    <code class="nx">id</code><code class="o">:</code> <code class="s2">"root"</code><code class="p">,</code>
    <code class="nx">children</code><code class="o">:</code> <code class="p">[],</code>
  <code class="p">};</code>
<code class="c1">// '{ id: string; children: never[]; }' is assignable to the constraint</code>
<code class="c1">//   of type 'T', but 'T' could be instantiated with a different subtype</code>
<code class="c1">//   of constraint 'TreeItem'.(2322)</code>
<code class="p">}</code>

<code class="kr">const</code> <code class="nx">root</code> <code class="o">=</code> <code class="nx">createRootItem</code><code class="p">();</code> <code class="c1">// root is TreeItem</code></pre>

<p>We get a similar error as before, since we can’t possibly say that the return value will be compatible with all the subtypes. To solve this problem, get rid of the generic! We know how the return type will look—it’s a <code>TreeItem</code>:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">createRootItem</code><code class="p">()</code><code class="o">:</code> <code class="nx">TreeItem</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">{</code>
    <code class="nx">id</code><code class="o">:</code> <code class="s2">"root"</code><code class="p">,</code>
    <code class="nx">children</code><code class="o">:</code> <code class="p">[],</code>
  <code class="p">};</code>
<code class="p">}</code></pre>

<p>The simplest solutions are often the better ones. But now you want to extend your software by being able to attach children of type or subtype <code>TreeItem</code> to a newly created root. We don’t add any generics yet and are somewhat dissatisfied:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">attachToRoot</code><code class="p">(</code><code class="nx">children</code><code class="o">:</code> <code class="nx">TreeItem</code><code class="p">[])</code><code class="o">:</code> <code class="nx">TreeItem</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">{</code>
    <code class="nx">id</code><code class="o">:</code> <code class="s2">"root"</code><code class="p">,</code>
    <code class="nx">children</code><code class="p">,</code>
  <code class="p">};</code>
<code class="p">}</code>

<code class="kr">const</code> <code class="nx">root</code> <code class="o">=</code> <code class="nx">attachToRoot</code><code class="p">([]);</code> <code class="c1">// TreeItem</code></pre>

<p><code>root</code> is of type <code>TreeItem</code>, but we lose any information about the subtyped children. Even if we add a generic type parameter just for the children, constrained to <code>Tr⁠ee​It⁠em</code>, we don’t retain this information on the go:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">attachToRoot</code><code class="o">&lt;</code><code class="nx">T</code> <code class="kr">extends</code> <code class="nx">TreeItem</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">children</code><code class="o">:</code> <code class="nx">T</code><code class="p">[])</code><code class="o">:</code> <code class="nx">TreeItem</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">{</code>
    <code class="nx">id</code><code class="o">:</code> <code class="s2">"root"</code><code class="p">,</code>
    <code class="nx">children</code><code class="p">,</code>
  <code class="p">};</code>
<code class="p">}</code>

<code class="kr">const</code> <code class="nx">root</code> <code class="o">=</code> <code class="nx">attachToRoot</code><code class="p">([</code>
  <code class="p">{</code>
    <code class="nx">id</code><code class="o">:</code> <code class="s2">"child"</code><code class="p">,</code>
    <code class="nx">children</code><code class="o">:</code> <code class="p">[],</code>
    <code class="nx">collapsed</code><code class="o">:</code> <code class="kc">false</code><code class="p">,</code>
    <code class="nx">marked</code><code class="o">:</code> <code class="kc">true</code><code class="p">,</code>
  <code class="p">},</code>
<code class="p">]);</code> <code class="c1">// root is TreeItem</code></pre>

<p>When we start adding a generic type as a return type, we run into the same problems as before. To solve this issue, we need to split the root item type from the children item type, by opening up <code>TreeItem</code> to be a generic, where we can set <code>Children</code> to be a subtype of <code>TreeItem</code>.</p>

<p>Since we want to avoid any circular references, we need to set <code>Children</code> to a default <code>BaseTreeItem</code>, so we can use <code>TreeItem</code> both as a constraint for <code>Children</code> and for <code>attachToRoot</code>:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">type</code> <code class="nx">BaseTreeItem</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">id</code><code class="o">:</code> <code class="kt">string</code><code class="p">;</code>
  <code class="nx">children</code><code class="o">:</code> <code class="nx">BaseTreeItem</code><code class="p">[];</code>
<code class="p">};</code>

<code class="kr">type</code> <code class="nx">TreeItem</code><code class="o">&lt;</code><code class="nx">Children</code> <code class="kr">extends</code> <code class="nx">TreeItem</code> <code class="o">=</code> <code class="nx">BaseTreeItem</code><code class="o">&gt;</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">id</code><code class="o">:</code> <code class="kt">string</code><code class="p">;</code>
  <code class="nx">children</code><code class="o">:</code> <code class="nx">Children</code><code class="p">[];</code>
  <code class="nx">collapsed</code><code class="o">?:</code> <code class="kr">boolean</code><code class="p">;</code>
<code class="p">};</code>

<code class="kd">function</code> <code class="nx">attachToRoot</code><code class="o">&lt;</code><code class="nx">T</code> <code class="kr">extends</code> <code class="nx">TreeItem</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">children</code><code class="o">:</code> <code class="nx">T</code><code class="p">[])</code><code class="o">:</code> <code class="nx">TreeItem</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">{</code>
    <code class="nx">id</code><code class="o">:</code> <code class="s2">"root"</code><code class="p">,</code>
    <code class="nx">children</code><code class="p">,</code>
  <code class="p">};</code>
<code class="p">}</code>

<code class="kr">const</code> <code class="nx">root</code> <code class="o">=</code> <code class="nx">attachToRoot</code><code class="p">([</code>
  <code class="p">{</code>
    <code class="nx">id</code><code class="o">:</code> <code class="s2">"child"</code><code class="p">,</code>
    <code class="nx">children</code><code class="o">:</code> <code class="p">[],</code>
    <code class="nx">collapsed</code><code class="o">:</code> <code class="kc">false</code><code class="p">,</code>
    <code class="nx">marked</code><code class="o">:</code> <code class="kc">true</code><code class="p">,</code>
  <code class="p">},</code>
<code class="p">]);</code>
<code class="cm">/*</code>
<code class="cm">root is TreeItem&lt;{</code>
<code class="cm">    id: string;</code>
<code class="cm">    children: never[];</code>
<code class="cm">    collapsed: false;</code>
<code class="cm">    marked: boolean;</code>
<code class="cm">}&gt;</code>
<code class="cm">*/</code></pre>

<p>Again, we write subtype friendly and treat our input parameters as their own, instead of making assumptions.<a data-type="indexterm" data-startref="ix_04-06-asciidoc2" id="id627"></a><a data-type="indexterm" data-startref="ix_04-06-asciidoc1" id="id628"></a><a data-type="indexterm" data-startref="ix_04-06-asciidoc0" id="id629"></a></p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="4.5 Generating New Object Types"><div class="sect1" id="ch04_new_object_types">
<h1>4.5 Generating New Object Types</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="id216">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="generics" data-secondary="generating new object types" id="ix_04-05-asciidoc0"></a><a data-type="indexterm" data-primary="mapped types" data-secondary="generating new object types from generic mapped types" id="ix_04-05-asciidoc1"></a><a data-type="indexterm" data-primary="object type" data-secondary="generating new" id="ix_04-05-asciidoc2"></a>You have a type in your application that is related to your model. Every time the model changes, you need to change your types as well.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="id630">
<h2>Solution</h2>

<p>Use generic mapped types to create new object types based on the original type.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="id77">
<h2>Discussion</h2>

<p>Let’s go back to the toy shop from <a data-type="xref" href="ch03.html#ch03_item_modelling_data">Recipe 3.1</a>. Thanks to union types, intersection types, and discriminated union types, we were able to model our data quite nicely:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">type</code> <code class="nx">ToyBase</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">name</code><code class="o">:</code> <code class="kt">string</code><code class="p">;</code>
  <code class="nx">description</code><code class="o">:</code> <code class="kt">string</code><code class="p">;</code>
  <code class="nx">minimumAge</code><code class="o">:</code> <code class="kt">number</code><code class="p">;</code>
<code class="p">};</code>

<code class="kr">type</code> <code class="nx">BoardGame</code> <code class="o">=</code> <code class="nx">ToyBase</code> <code class="o">&amp;</code> <code class="p">{</code>
  <code class="nx">kind</code><code class="o">:</code> <code class="s2">"boardgame"</code><code class="p">;</code>
  <code class="nx">players</code><code class="o">:</code> <code class="kt">number</code><code class="p">;</code>
<code class="p">};</code>

<code class="kr">type</code> <code class="nx">Puzzle</code> <code class="o">=</code> <code class="nx">ToyBase</code> <code class="o">&amp;</code> <code class="p">{</code>
  <code class="nx">kind</code><code class="o">:</code> <code class="s2">"puzzle"</code><code class="p">;</code>
  <code class="nx">pieces</code><code class="o">:</code> <code class="kt">number</code><code class="p">;</code>
<code class="p">};</code>

<code class="kr">type</code> <code class="nx">Doll</code> <code class="o">=</code> <code class="nx">ToyBase</code> <code class="o">&amp;</code> <code class="p">{</code>
  <code class="nx">kind</code><code class="o">:</code> <code class="s2">"doll"</code><code class="p">;</code>
  <code class="nx">material</code><code class="o">:</code> <code class="s2">"plush"</code> <code class="o">|</code> <code class="s2">"plastic"</code><code class="p">;</code>
<code class="p">};</code>

<code class="kr">type</code> <code class="nx">Toy</code> <code class="o">=</code> <code class="nx">Doll</code> <code class="o">|</code> <code class="nx">Puzzle</code> <code class="o">|</code> <code class="nx">BoardGame</code><code class="p">;</code></pre>

<p>Somewhere in our code, we need to group all toys from our model in a data structure that can be described by a type called <code>GroupedToys</code>. <code>GroupedToys</code> has a property for each category (or <code>"kind"</code>) and a <code>Toy</code> array as value. A <code>groupToys</code> function takes an unsorted list of toys and groups them by kind:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">type</code> <code class="nx">GroupedToys</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">boardgame</code><code class="o">:</code> <code class="nx">Toy</code><code class="p">[];</code>
  <code class="nx">puzzle</code><code class="o">:</code> <code class="nx">Toy</code><code class="p">[];</code>
  <code class="nx">doll</code><code class="o">:</code> <code class="nx">Toy</code><code class="p">[];</code>
<code class="p">};</code>

<code class="kd">function</code> <code class="nx">groupToys</code><code class="p">(</code><code class="nx">toys</code><code class="o">:</code> <code class="nx">Toy</code><code class="p">[])</code><code class="o">:</code> <code class="nx">GroupedToys</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="nx">groups</code><code class="o">:</code> <code class="nx">GroupedToys</code> <code class="o">=</code> <code class="p">{</code>
    <code class="nx">boardgame</code><code class="o">:</code> <code class="p">[],</code>
    <code class="nx">puzzle</code><code class="o">:</code> <code class="p">[],</code>
    <code class="nx">doll</code><code class="o">:</code> <code class="p">[],</code>
  <code class="p">};</code>
  <code class="k">for</code> <code class="p">(</code><code class="kd">let</code> <code class="nx">toy</code> <code class="nx">of</code> <code class="nx">toys</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">groups</code><code class="p">[</code><code class="nx">toy</code><code class="p">.</code><code class="nx">kind</code><code class="p">].</code><code class="nx">push</code><code class="p">(</code><code class="nx">toy</code><code class="p">);</code>
  <code class="p">}</code>
  <code class="k">return</code> <code class="nx">groups</code><code class="p">;</code>
<code class="p">}</code></pre>

<p>There are already some niceties in this code. First, we use an explicit type annotation when declaring <code>groups</code>. This ensures we are not forgetting any category. Also, since the keys of <code>GroupedToys</code> are the same as the union of <code>"kind"</code> types in <code>Toy</code>, we can easily index access <code>groups</code> by <code>toy.kind</code>.</p>

<p>Months and sprints pass, and we need to touch our model again. The toy shop is now selling original or maybe alternate vendors of interlocking toy bricks. We wire the new type <code>Bricks</code> up to our <code>Toy</code> model:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">type</code> <code class="nx">Bricks</code> <code class="o">=</code> <code class="nx">ToyBase</code> <code class="o">&amp;</code> <code class="p">{</code>
  <code class="nx">kind</code><code class="o">:</code> <code class="s2">"bricks"</code><code class="p">,</code>
  <code class="nx">pieces</code><code class="o">:</code> <code class="kt">number</code><code class="p">;</code>
  <code class="nx">brand</code><code class="o">:</code> <code class="kt">string</code><code class="p">;</code>
<code class="p">}</code>

<code class="kr">type</code> <code class="nx">Toy</code> <code class="o">=</code> <code class="nx">Doll</code> <code class="o">|</code> <code class="nx">Puzzle</code> <code class="o">|</code> <code class="nx">BoardGame</code> <code class="o">|</code> <code class="nx">Bricks</code><code class="p">;</code></pre>

<p>Since <code>groupToys</code> needs to deal with <code>Bricks</code>, too, we get a nice error because <code>GroupedToys</code> has no clue about a <code>"bricks"</code> kind:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">groupToys</code><code class="p">(</code><code class="nx">toys</code><code class="o">:</code> <code class="nx">Toy</code><code class="p">[])</code><code class="o">:</code> <code class="nx">GroupedToys</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="nx">groups</code><code class="o">:</code> <code class="nx">GroupedToys</code> <code class="o">=</code> <code class="p">{</code>
    <code class="nx">boardgame</code><code class="o">:</code> <code class="p">[],</code>
    <code class="nx">puzzle</code><code class="o">:</code> <code class="p">[],</code>
    <code class="nx">doll</code><code class="o">:</code> <code class="p">[],</code>
  <code class="p">};</code>
  <code class="k">for</code> <code class="p">(</code><code class="kd">let</code> <code class="nx">toy</code> <code class="nx">of</code> <code class="nx">toys</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">groups</code><code class="p">[</code><code class="nx">toy</code><code class="p">.</code><code class="nx">kind</code><code class="p">].</code><code class="nx">push</code><code class="p">(</code><code class="nx">toy</code><code class="p">);</code>
<code class="c1">//  ^- Element implicitly has an 'any' type because expression</code>
<code class="c1">//     of type '"boardgame" | "puzzle" | "doll" | "bricks"' can't</code>
<code class="c1">//     be used to index type 'GroupedToys'.</code>
<code class="c1">//     Property 'bricks' does not exist on type 'GroupedToys'.(7053)</code>
  <code class="p">}</code>
  <code class="k">return</code> <code class="nx">groups</code><code class="p">;</code>
<code class="p">}</code></pre>

<p>This is desired behavior in TypeScript: knowing when types don’t match anymore. This should draw our attention. Let’s give <code>GroupedToys</code> and <code>groupToys</code> an update:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">type</code> <code class="nx">GroupedToys</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">boardgame</code><code class="o">:</code> <code class="nx">Toy</code><code class="p">[];</code>
  <code class="nx">puzzle</code><code class="o">:</code> <code class="nx">Toy</code><code class="p">[];</code>
  <code class="nx">doll</code><code class="o">:</code> <code class="nx">Toy</code><code class="p">[];</code>
  <code class="nx">bricks</code><code class="o">:</code> <code class="nx">Toy</code><code class="p">[];</code>
<code class="p">};</code>

<code class="kd">function</code> <code class="nx">groupToys</code><code class="p">(</code><code class="nx">toys</code><code class="o">:</code> <code class="nx">Toy</code><code class="p">[])</code><code class="o">:</code> <code class="nx">GroupedToys</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="nx">groups</code><code class="o">:</code> <code class="nx">GroupedToys</code> <code class="o">=</code> <code class="p">{</code>
    <code class="nx">boardgame</code><code class="o">:</code> <code class="p">[],</code>
    <code class="nx">puzzle</code><code class="o">:</code> <code class="p">[],</code>
    <code class="nx">doll</code><code class="o">:</code> <code class="p">[],</code>
    <code class="nx">bricks</code><code class="o">:</code> <code class="p">[],</code>
  <code class="p">};</code>
  <code class="k">for</code> <code class="p">(</code><code class="kd">let</code> <code class="nx">toy</code> <code class="nx">of</code> <code class="nx">toys</code><code class="p">)</code> <code class="p">{</code>
    <code class="nx">groups</code><code class="p">[</code><code class="nx">toy</code><code class="p">.</code><code class="nx">kind</code><code class="p">].</code><code class="nx">push</code><code class="p">(</code><code class="nx">toy</code><code class="p">);</code>
  <code class="p">}</code>
  <code class="k">return</code> <code class="nx">groups</code><code class="p">;</code>
<code class="p">}</code></pre>

<p>There is one bothersome thing: the task of grouping toys is always the same. No matter how much our model changes, we will always select by kind and push into an array. We would need to maintain <code>groups</code> with every change, but if we change how we think about groups, we can optimize for change. First, we change the type <code>Gr⁠oup⁠ed​To⁠ys</code> to feature optional properties. Second, we initialize each group with an empty array if there hasn’t been any initialization yet:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">type</code> <code class="nx">GroupedToys</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">boardgame</code><code class="o">?:</code> <code class="nx">Toy</code><code class="p">[];</code>
  <code class="nx">puzzle</code><code class="o">?:</code> <code class="nx">Toy</code><code class="p">[];</code>
  <code class="nx">doll</code><code class="o">?:</code> <code class="nx">Toy</code><code class="p">[];</code>
  <code class="nx">bricks</code><code class="o">?:</code> <code class="nx">Toy</code><code class="p">[];</code>
<code class="p">};</code>


<code class="kd">function</code> <code class="nx">groupToys</code><code class="p">(</code><code class="nx">toys</code><code class="o">:</code> <code class="nx">Toy</code><code class="p">[])</code><code class="o">:</code> <code class="nx">GroupedToys</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="nx">groups</code><code class="o">:</code> <code class="nx">GroupedToys</code> <code class="o">=</code> <code class="p">{};</code>
  <code class="k">for</code> <code class="p">(</code><code class="kd">let</code> <code class="nx">toy</code> <code class="nx">of</code> <code class="nx">toys</code><code class="p">)</code> <code class="p">{</code>
    <code class="c1">// Initialize when not available</code>
    <code class="nx">groups</code><code class="p">[</code><code class="nx">toy</code><code class="p">.</code><code class="nx">kind</code><code class="p">]</code> <code class="o">=</code> <code class="nx">groups</code><code class="p">[</code><code class="nx">toy</code><code class="p">.</code><code class="nx">kind</code><code class="p">]</code> <code class="o">??</code> <code class="p">[];</code>
    <code class="nx">groups</code><code class="p">[</code><code class="nx">toy</code><code class="p">.</code><code class="nx">kind</code><code class="p">]</code><code class="o">?</code><code class="p">.</code><code class="nx">push</code><code class="p">(</code><code class="nx">toy</code><code class="p">);</code>
  <code class="p">}</code>
  <code class="k">return</code> <code class="nx">groups</code><code class="p">;</code>
<code class="p">}</code></pre>

<p>We don’t need to maintain <code>groupToys</code> anymore. The only thing that needs maintenance is the type <code>GroupedToys</code>. If we look closely at <code>GroupedToys</code>, we see that there is an implicit relation to <code>Toy</code>. Each property key is part of <code>Toy["kind"]</code>. Let’s make this relation <em>explicit</em>. With a <em>mapped type</em>, we create a new object type based on each type in <code>Toy["kind"]</code>.</p>

<p><code>Toy["kind"]</code> is a union of string literals: <code>"boardgame" | "puzzle" | "doll" | "bricks"</code>. Since we have a very reduced set of strings, each element of this union will be used as its own property key. Let that sink in for a moment: we can use a <em>type</em> to be a <em>property key</em> of a newly generated type. Each property has an optional type modifier and points to a <code>Toy[]</code>:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">type</code> <code class="nx">GroupedToys</code> <code class="o">=</code> <code class="p">{</code>
  <code class="p">[</code><code class="nx">k</code> <code class="k">in</code> <code class="nx">Toy</code><code class="p">[</code><code class="s2">"kind"</code><code class="p">]]</code><code class="o">?:</code> <code class="nx">Toy</code><code class="p">[];</code>
<code class="p">};</code></pre>

<p>Fantastic! Every time we change <code>Toy</code>, we immediately change <code>Toy[]</code>. Our code needs no change at all; we can still group by kind as we did before.</p>

<p>This is a pattern we have the potential to generalize. Let’s create a <code>Group</code> type that takes a collection and groups it by a specific selector. We want to create a generic type with two type parameters:</p>

<ul>
<li>
<p>The <code>Collection</code> can be anything.</p>
</li>
<li>
<p>The <code>Selector</code>, a key of <code>Collection</code>, so it can create the respective properties.</p>
</li>
</ul>

<p>Our first attempt would be to take what we had in <code>GroupedToys</code> and replace the concrete types with type parameters. This creates what we need but also causes an error:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="c1">// How to use it</code>
<code class="kr">type</code> <code class="nx">GroupedToys</code> <code class="o">=</code> <code class="nx">Group</code><code class="o">&lt;</code><code class="nx">Toy</code><code class="p">,</code> <code class="s2">"kind"</code><code class="o">&gt;</code><code class="p">;</code>

<code class="kr">type</code> <code class="nx">Group</code><code class="o">&lt;</code><code class="nx">Collection</code><code class="p">,</code> <code class="nx">Selector</code> <code class="kr">extends</code> <code class="kr">keyof</code> <code class="nx">Collection</code><code class="o">&gt;</code> <code class="o">=</code> <code class="p">{</code>
  <code class="p">[</code><code class="nx">x</code> <code class="k">in</code> <code class="nx">Collection</code><code class="p">[</code><code class="nx">Selector</code><code class="p">]]</code><code class="o">?:</code> <code class="nx">Collection</code><code class="p">[];</code>
<code class="c1">//     ^ Type 'Collection[Selector]' is not assignable</code>
<code class="c1">//       to type 'string | number | symbol'.</code>
<code class="c1">//       Type 'Collection[keyof Collection]' is not</code>
<code class="c1">//       assignable to type 'string | number | symbol'.</code>
<code class="c1">//       Type 'Collection[string] | Collection[number]</code>
<code class="c1">//        | Collection[symbol]' is not assignable to</code>
<code class="c1">//       type 'string | number | symbol'.</code>
<code class="c1">//       Type 'Collection[string]' is not assignable to</code>
<code class="c1">//       type 'string | number | symbol'.(2322)</code>
<code class="p">};</code></pre>

<p>TypeScript warns us that <code>Collection[string] | Collection[number] | Collection[symbol]</code> could result in anything, not just things that can be used as a key. That’s true, and we need to prepare for that. We have two options.</p>

<p>First, use a type constraint on <code>Collection</code> that points to <code>Record&lt;string, any&gt;</code>. <code>Record</code> is a utility type that generates a new object where the first parameter gives you all keys and the second parameter gives you the types:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="c1">// This type is built-in!</code>
<code class="kr">type</code> <code class="nx">Record</code><code class="o">&lt;</code><code class="nx">K</code> <code class="kr">extends</code> <code class="kt">string</code> <code class="o">|</code> <code class="kt">number</code> <code class="o">|</code> <code class="nx">symbol</code><code class="p">,</code> <code class="nx">T</code><code class="o">&gt;</code> <code class="o">=</code> <code class="p">{</code> <code class="p">[</code><code class="nx">P</code> <code class="k">in</code> <code class="nx">K</code><code class="p">]</code><code class="o">:</code> <code class="nx">T</code><code class="p">;</code> <code class="p">};</code></pre>

<p>This elevates <code>Collection</code> to a wildcard object, effectively disabling the type-check from <code>Groups</code>. This is OK because if something would be an unusable type for a property key, TypeScript will throw it away anyway. So the final <code>Group</code> has two constrained type parameters:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">type</code> <code class="nx">Group</code><code class="o">&lt;</code>
  <code class="nx">Collection</code> <code class="kr">extends</code> <code class="nx">Record</code><code class="o">&lt;</code><code class="kt">string</code><code class="p">,</code> <code class="kr">any</code><code class="o">&gt;</code><code class="p">,</code>
  <code class="nx">Selector</code> <code class="kr">extends</code> <code class="kr">keyof</code> <code class="nx">Collection</code>
<code class="o">&gt;</code> <code class="o">=</code> <code class="p">{</code>
  <code class="p">[</code><code class="nx">x</code> <code class="k">in</code> <code class="nx">Collection</code><code class="p">[</code><code class="nx">Selector</code><code class="p">]]</code><code class="o">:</code> <code class="nx">Collection</code><code class="p">[];</code>
<code class="p">};</code></pre>

<p>The second option is to do a check for each key to see if it is a valid string key. We can use a <em>conditional type</em> to see if <code>Collection[Selector]</code> is in fact a valid type for a key. Otherwise, we would remove this type by choosing <code>never</code>. Conditional types are their own beast, and we tackle this in <a data-type="xref" href="ch05.html#ch05_removing_object_properties">Recipe 5.4</a> extensively:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">type</code> <code class="nx">Group</code><code class="o">&lt;</code><code class="nx">Collection</code><code class="p">,</code> <code class="nx">Selector</code> <code class="kr">extends</code> <code class="kr">keyof</code> <code class="nx">Collection</code><code class="o">&gt;</code> <code class="o">=</code> <code class="p">{</code>
  <code class="p">[</code><code class="nx">k</code> <code class="k">in</code> <code class="nx">Collection</code><code class="p">[</code><code class="nx">Selector</code><code class="p">]</code> <code class="kr">extends</code> <code class="kt">string</code>
    <code class="o">?</code> <code class="nx">Collection</code><code class="p">[</code><code class="nx">Selector</code><code class="p">]</code>
    <code class="o">:</code> <code class="kr">never</code><code class="p">]</code><code class="o">?:</code> <code class="nx">Collection</code><code class="p">[];</code>
<code class="p">};</code></pre>

<p>Note that we did remove the optional type modifier. We do this because making keys optional is not the task of grouping. We have another type for that: <code>Partial&lt;T&gt;</code>, another mapped type that makes every property in an object type optional:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="c1">// This type is built-in!</code>
<code class="kr">type</code> <code class="nx">Partial</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code> <code class="o">=</code> <code class="p">{</code> <code class="p">[</code><code class="nx">P</code> <code class="k">in</code> <code class="kr">keyof</code> <code class="nx">T</code><code class="p">]</code><code class="o">?:</code> <code class="nx">T</code><code class="p">[</code><code class="nx">P</code><code class="p">]</code> <code class="p">};</code></pre>

<p>No matter which <code>Group</code> helper you create, you can now create a <code>GroupedToys</code> object by telling TypeScript that you want a <code>Partial</code> (changing everything to optional properties) of a <code>Group</code> of <code>Toys</code> by <code>"kind"</code>:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">type</code> <code class="nx">GroupedToys</code> <code class="o">=</code> <code class="nx">Partial</code><code class="o">&lt;</code><code class="nx">Group</code><code class="o">&lt;</code><code class="nx">Toy</code><code class="p">,</code> <code class="s2">"kind"</code><code class="o">&gt;&gt;</code><code class="p">;</code></pre>

<p>Now that reads nicely.<a data-type="indexterm" data-startref="ix_04-05-asciidoc2" id="id631"></a><a data-type="indexterm" data-startref="ix_04-05-asciidoc1" id="id632"></a><a data-type="indexterm" data-startref="ix_04-05-asciidoc0" id="id633"></a></p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="4.6 Modifying Objects with Assertion Signatures"><div class="sect1" id="ch04_assertion_signatures">
<h1>4.6 Modifying Objects with Assertion Signatures</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="id78">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="assertion signatures, modifying objects with" id="ix_04-07-asciidoc0"></a><a data-type="indexterm" data-primary="generics" data-secondary="modifying objects with assertion signatures" id="ix_04-07-asciidoc1"></a><a data-type="indexterm" data-primary="objects, modifying with assertion signatures" id="ix_04-07-asciidoc2"></a>After a certain function execution in your code, you know the type of a value has changed.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="id634">
<h2>Solution</h2>

<p>Use assertion signatures to change types independently of <code>if</code> and <code>switch</code> statements.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="id79">
<h2>Discussion</h2>

<p>JavaScript is a very flexible language. Its dynamic typing features allow you to change objects at runtime, adding new properties on the fly. And developers use this. There are situations where you, for example, run over a collection of elements and need to assert certain properties. You then store a <code>checked</code> property and set it to <code>true</code>, just so you know that you passed a certain mark:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">check</code><code class="p">(</code><code class="nx">person</code><code class="o">:</code> <code class="kr">any</code><code class="p">)</code> <code class="p">{</code>
  <code class="nx">person</code><code class="p">.</code><code class="nx">checked</code> <code class="o">=</code> <code class="kc">true</code><code class="p">;</code>
<code class="p">}</code>

<code class="kr">const</code> <code class="nx">person</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">name</code><code class="o">:</code> <code class="s2">"Stefan"</code><code class="p">,</code>
  <code class="nx">age</code><code class="o">:</code> <code class="mi">27</code><code class="p">,</code>
<code class="p">};</code>

<code class="nx">check</code><code class="p">(</code><code class="nx">person</code><code class="p">);</code> <code class="c1">// person now has the checked property</code>

<code class="nx">person</code><code class="p">.</code><code class="nx">checked</code><code class="p">;</code> <code class="c1">// this is true!</code></pre>

<p>You want to mirror this behavior in the type system; otherwise, you would need to constantly do extra checks if certain properties are in an object, even though you can be sure that they exist.</p>

<p>One way to assert that certain properties exist are, well, type assertions. We say that at a certain point in time, this property has a different type:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="p">(</code><code class="nx">person</code> <code class="kr">as</code> <code class="k">typeof</code> <code class="nx">person</code> <code class="o">&amp;</code> <code class="p">{</code> <code class="nx">checked</code><code class="o">:</code> <code class="kr">boolean</code> <code class="p">}).</code><code class="nx">checked</code> <code class="o">=</code> <code class="kc">true</code><code class="p">;</code></pre>

<p>Good, but you would need to do this type assertion over and over again, as they don’t change the original type of <code>person</code>. Another way to assert that certain properties are available is to create type predicates, like those shown in <a data-type="xref" href="ch03.html#ch03_item_type_predicates">Recipe 3.5</a>:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">check</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">obj</code><code class="o">:</code> <code class="nx">T</code><code class="p">)</code><code class="o">:</code> <code class="nx">obj</code> <code class="nx">is</code> <code class="nx">T</code> <code class="o">&amp;</code> <code class="p">{</code> <code class="nx">checked</code><code class="o">:</code> <code class="kc">true</code> <code class="p">}</code> <code class="p">{</code>
  <code class="p">(</code><code class="nx">obj</code> <code class="kr">as</code> <code class="nx">T</code> <code class="o">&amp;</code> <code class="p">{</code> <code class="nx">checked</code><code class="o">:</code> <code class="kr">boolean</code> <code class="p">}).</code><code class="nx">checked</code> <code class="o">=</code> <code class="kc">true</code><code class="p">;</code>
  <code class="k">return</code> <code class="kc">true</code><code class="p">;</code>
<code class="p">}</code>

<code class="kr">const</code> <code class="nx">person</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">name</code><code class="o">:</code> <code class="s2">"Stefan"</code><code class="p">,</code>
  <code class="nx">age</code><code class="o">:</code> <code class="mi">27</code><code class="p">,</code>
<code class="p">};</code>

<code class="k">if</code> <code class="p">(</code><code class="nx">check</code><code class="p">(</code><code class="nx">person</code><code class="p">))</code> <code class="p">{</code>
  <code class="nx">person</code><code class="p">.</code><code class="nx">checked</code><code class="p">;</code> <code class="c1">// checked is true!</code>
<code class="p">}</code></pre>

<p>This situation is a bit different, though, which makes the <code>check</code> function feel clumsy: you need to do an extra condition and return <code>true</code> in the predicate function. This doesn’t feel right.</p>

<p>Thankfully, TypeScript has another technique we can leverage in situations like this: assertion signatures. Assertion signatures can change the type of a value in control flow, without the need for conditionals. They have been modeled for the Node.js <code>assert</code> function, which takes a condition, and it throws an error if it isn’t true. This means that, after calling <code>assert</code>, you might have more information than before. For example, if you call <code>assert</code> and check if a value has a type of <code>string</code>, you know that after this <code>assert</code> function the value should be <code>string</code>:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">assert</code><code class="p">(</code><code class="nx">condition</code><code class="o">:</code> <code class="kr">any</code><code class="p">,</code> <code class="nx">msg</code><code class="o">?:</code> <code class="kt">string</code><code class="p">)</code><code class="o">:</code> <code class="nx">asserts</code> <code class="nx">condition</code> <code class="p">{</code>
  <code class="k">if</code> <code class="p">(</code><code class="o">!</code><code class="nx">condition</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">throw</code> <code class="k">new</code> <code class="nb">Error</code><code class="p">(</code><code class="nx">msg</code><code class="p">);</code>
  <code class="p">}</code>
<code class="p">}</code>

<code class="kd">function</code> <code class="nx">yell</code><code class="p">(</code><code class="nx">str</code><code class="o">:</code> <code class="kr">any</code><code class="p">)</code> <code class="p">{</code>
  <code class="nx">assert</code><code class="p">(</code><code class="k">typeof</code> <code class="nx">str</code> <code class="o">===</code> <code class="s2">"string"</code><code class="p">);</code>
  <code class="c1">// str is string</code>
  <code class="k">return</code> <code class="nx">str</code><code class="p">.</code><code class="nx">toUpperCase</code><code class="p">();</code>
<code class="p">}</code></pre>

<p>Please note that the function short-circuits if the condition is false. It throws an error, the <code>never</code> case. If this function passes, you can really assert the condition.</p>

<p>While assertion signatures have been modeled for the Node.js assert function, you can assert any type you like. For example, you can have a function that takes any value for an addition, but you assert that the values need to be <code>number</code> to continue:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">assertNumber</code><code class="p">(</code><code class="nx">val</code><code class="o">:</code> <code class="kr">any</code><code class="p">)</code><code class="o">:</code> <code class="nx">asserts</code> <code class="nx">val</code> <code class="nx">is</code> <code class="kt">number</code> <code class="p">{</code>
  <code class="k">if</code> <code class="p">(</code><code class="k">typeof</code> <code class="nx">val</code> <code class="o">!==</code> <code class="s2">"number"</code><code class="p">)</code> <code class="p">{</code>
    <code class="k">throw</code> <code class="nb">Error</code><code class="p">(</code><code class="s2">"value is not a number"</code><code class="p">);</code>
  <code class="p">}</code>
<code class="p">}</code>

<code class="kd">function</code> <code class="nx">add</code><code class="p">(</code><code class="nx">x</code><code class="o">:</code> <code class="kr">unknown</code><code class="p">,</code> <code class="nx">y</code><code class="o">:</code> <code class="kr">unknown</code><code class="p">)</code><code class="o">:</code> <code class="kt">number</code> <code class="p">{</code>
  <code class="nx">assertNumber</code><code class="p">(</code><code class="nx">x</code><code class="p">);</code> <code class="c1">// x is number</code>
  <code class="nx">assertNumber</code><code class="p">(</code><code class="nx">y</code><code class="p">);</code> <code class="c1">// y is number</code>
  <code class="k">return</code> <code class="nx">x</code> <code class="o">+</code> <code class="nx">y</code><code class="p">;</code>
<code class="p">}</code></pre>

<p>All the examples you find on assertion signatures are based after assertions and short-circuit with errors. But we can take the same technique to tell TypeScript that more properties are available. We write a function that is very similar to <code>check</code> in the predicate function before, but this time we don’t need to return <code>true</code>. We set the property, and since objects are passed by value in JavaScript, we can assert that after calling this function whatever we pass has a property <code>checked</code>, which is <code>true</code>:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">check</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">obj</code><code class="o">:</code> <code class="nx">T</code><code class="p">)</code><code class="o">:</code> <code class="nx">asserts</code> <code class="nx">obj</code> <code class="nx">is</code> <code class="nx">T</code> <code class="o">&amp;</code> <code class="p">{</code> <code class="nx">checked</code><code class="o">:</code> <code class="kc">true</code> <code class="p">}</code> <code class="p">{</code>
  <code class="p">(</code><code class="nx">obj</code> <code class="kr">as</code> <code class="nx">T</code> <code class="o">&amp;</code> <code class="p">{</code> <code class="nx">checked</code><code class="o">:</code> <code class="kr">boolean</code> <code class="p">}).</code><code class="nx">checked</code> <code class="o">=</code> <code class="kc">true</code><code class="p">;</code>
<code class="p">}</code>

<code class="kr">const</code> <code class="nx">person</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">name</code><code class="o">:</code> <code class="s2">"Stefan"</code><code class="p">,</code>
  <code class="nx">age</code><code class="o">:</code> <code class="mi">27</code><code class="p">,</code>
<code class="p">};</code>

<code class="nx">check</code><code class="p">(</code><code class="nx">person</code><code class="p">);</code></pre>

<p>And with that, we can modify a value’s type on the fly. It’s a little-known technique that can help you a lot.<a data-type="indexterm" data-startref="ix_04-07-asciidoc2" id="id635"></a><a data-type="indexterm" data-startref="ix_04-07-asciidoc1" id="id636"></a><a data-type="indexterm" data-startref="ix_04-07-asciidoc0" id="id637"></a></p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="4.7 Mapping Types with Type Maps"><div class="sect1" id="ch04_item_mapping_types">
<h1>4.7 Mapping Types with Type Maps</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="id80">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="factory functions" id="ix_04-08-asciidoc0"></a><a data-type="indexterm" data-primary="generics" data-secondary="mapping types with type maps" id="ix_04-08-asciidoc1"></a><a data-type="indexterm" data-primary="mapped types" data-secondary="mapping types with type maps" id="ix_04-08-asciidoc2"></a><a data-type="indexterm" data-primary="type maps" data-secondary="mapping types with" id="ix_04-08-asciidoc3"></a>You write a factory function that creates an object of a specific subtype based on a string identifier, and there are a lot of possible subtypes.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="id638">
<h2>Solution</h2>

<p>Store all subtypes in a type map, widen with index access, and use mapped types like <code>Partial&lt;T&gt;</code>.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="id81">
<h2>Discussion</h2>

<p>Factory functions are great if you want to create variants of complex objects based on some basic information. One scenario that you might know from browser JavaScript is the creation of elements. The <code>document.createElement</code> function accepts an element’s tag name, and you get an object where you can modify all necessary 
<span class="keep-together">properties.</span></p>

<p>You want to spice up this creation with a neat factory function you call <code>cr⁠ea⁠te​El⁠eme⁠nt</code>. Not only does it take the element’s tag name, but it also makes a list of properties so you don’t need to set each property individually:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="c1">// Using create Element</code>

<code class="c1">// a is HTMLAnchorElement</code>
<code class="kr">const</code> <code class="nx">a</code> <code class="o">=</code> <code class="nx">createElement</code><code class="p">(</code><code class="s2">"a"</code><code class="p">,</code> <code class="p">{</code> <code class="nx">href</code><code class="o">:</code> <code class="s2">"https://fettblog.eu"</code> <code class="p">});</code>
<code class="c1">// b is HTMLVideoElement</code>
<code class="kr">const</code> <code class="nx">b</code> <code class="o">=</code> <code class="nx">createElement</code><code class="p">(</code><code class="s2">"video"</code><code class="p">,</code> <code class="p">{</code> <code class="nx">src</code><code class="o">:</code> <code class="s2">"/movie.mp4"</code><code class="p">,</code> <code class="nx">autoplay</code><code class="o">:</code> <code class="kc">true</code> <code class="p">});</code>
<code class="c1">// c is HTMLElement</code>
<code class="kr">const</code> <code class="nx">c</code> <code class="o">=</code> <code class="nx">createElement</code><code class="p">(</code><code class="s2">"my-element"</code><code class="p">);</code></pre>

<p>You want to create good types for this, so you need to take care of two things:</p>

<ul>
<li>
<p>Make sure you create only valid HTML elements.</p>
</li>
<li>
<p>Provide a type that accepts a subset of an HTML element’s properties.</p>
</li>
</ul>

<p>Let’s take care of the valid HTML elements first. There are around 140 possible HTML elements, which is a lot. Each of those elements has a tag name, which can be represented as a string, and a respective prototype object in the DOM. Using the <em>dom</em> lib in your <em>tsconfig.json</em>, TypeScript has information on those prototype objects in the form of types. And you can figure out all 140 element names.</p>

<p><a data-type="indexterm" data-primary="type maps" data-secondary="defined" id="id639"></a>A good way to provide a mapping between element tag names and prototype objects is to use a <em>type map</em>. A type map is a technique where you take a type alias or interface and let keys point to the respective type variants. You can then get the correct type variant using index access of a string literal type:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">type</code> <code class="nx">AllElements</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">a</code><code class="o">:</code> <code class="nx">HTMLAnchorElement</code><code class="p">;</code>
  <code class="nx">div</code><code class="o">:</code> <code class="nx">HTMLDivElement</code><code class="p">;</code>
  <code class="nx">video</code><code class="o">:</code> <code class="nx">HTMLVideoElement</code><code class="p">;</code>
  <code class="c1">//... and ~140 more!</code>
<code class="p">};</code>

<code class="c1">// HTMLAnchorElement</code>
<code class="kr">type</code> <code class="nx">A</code> <code class="o">=</code> <code class="nx">AllElements</code><code class="p">[</code><code class="s2">"a"</code><code class="p">];</code></pre>

<p>It looks like accessing a JavaScript object’s properties using index access, but remember that we’re still working on a type level. This means index access can be broad:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">type</code> <code class="nx">AllElements</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">a</code><code class="o">:</code> <code class="nx">HTMLAnchorElement</code><code class="p">;</code>
  <code class="nx">div</code><code class="o">:</code> <code class="nx">HTMLDivElement</code><code class="p">;</code>
  <code class="nx">video</code><code class="o">:</code> <code class="nx">HTMLVideoElement</code><code class="p">;</code>
  <code class="c1">//... and ~140 more!</code>
<code class="p">};</code>

<code class="c1">// HTMLAnchorElement | HTMLDivELement</code>
<code class="kr">type</code> <code class="nx">AandDiv</code> <code class="o">=</code> <code class="nx">AllElements</code><code class="p">[</code><code class="s2">"a"</code> <code class="o">|</code> <code class="s2">"div"</code><code class="p">];</code></pre>

<p>Let’s use this map to type the <code>createElement</code> function. We use a generic type parameter constrained to all keys of <code>AllElements</code>, which allows us to pass only valid HTML elements:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">createElement</code><code class="o">&lt;</code><code class="nx">T</code> <code class="kr">extends</code> <code class="kr">keyof</code> <code class="nx">AllElements</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">tag</code><code class="o">:</code> <code class="nx">T</code><code class="p">)</code><code class="o">:</code> <code class="nx">AllElements</code><code class="p">[</code><code class="nx">T</code><code class="p">]</code> <code class="p">{</code>
  <code class="k">return</code> <code class="nb">document</code><code class="p">.</code><code class="nx">createElement</code><code class="p">(</code><code class="nx">tag</code> <code class="kr">as</code> <code class="kt">string</code><code class="p">)</code> <code class="kr">as</code> <code class="nx">AllElements</code><code class="p">[</code><code class="nx">T</code><code class="p">];</code>
<code class="p">}</code>

<code class="c1">// a is HTMLAnchorElement</code>
<code class="kr">const</code> <code class="nx">a</code> <code class="o">=</code> <code class="nx">createElement</code><code class="p">(</code><code class="s2">"a"</code><code class="p">);</code></pre>

<p>Use generics here to pin a string literal to a literal type, which we can use to index the right HTML element variant from the type map. Also note that using <code>do⁠cum⁠ent.​cre⁠ate⁠Ele⁠me⁠nt</code> requires two type assertions. One makes the set wider (<code>T</code> to <code>string</code>), and one makes the set narrower (<code>HTMLElement</code> to <code>AllElements[T]</code>). Both assertions indicate that we have to deal with an API outside our control, as established in <a data-type="xref" href="ch03.html#ch03_item_assertions">Recipe 3.9</a>. We will deal with the assertions later on.</p>

<p>Now we want to provide the option to pass extra properties for said HTML elements, to set an <code>href</code> to an <code>HTMLAnchorElement</code>, and so forth. All properties are already in the respective <code>HTMLElement</code> variants, but they’re required, not optional.
We can make all properties optional with the built-in type <code>Partial&lt;T&gt;</code>. It’s a mapped type that takes all properties of a certain type and adds a type modifier:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">type</code> <code class="nx">Partial</code><code class="o">&lt;</code><code class="nx">T</code><code class="o">&gt;</code> <code class="o">=</code> <code class="p">{</code> <code class="p">[</code><code class="nx">P</code> <code class="k">in</code> <code class="kr">keyof</code> <code class="nx">T</code><code class="p">]</code><code class="o">?:</code> <code class="nx">T</code><code class="p">[</code><code class="nx">P</code><code class="p">]</code> <code class="p">};</code></pre>

<p>We extend our function with an optional argument <code>props</code> that is a <code>Partial</code> of the indexed element from <code>AllElements</code>. This way, we know that if we pass an <code>"a"</code>, we can only set properties that are available in <code>HTMLAnchorElement</code>:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">createElement</code><code class="o">&lt;</code><code class="nx">T</code> <code class="kr">extends</code> <code class="kr">keyof</code> <code class="nx">AllElements</code><code class="o">&gt;</code><code class="p">(</code>
  <code class="nx">tag</code><code class="o">:</code> <code class="nx">T</code><code class="p">,</code>
  <code class="nx">props</code><code class="o">?:</code> <code class="nx">Partial</code><code class="o">&lt;</code><code class="nx">AllElements</code><code class="p">[</code><code class="nx">T</code><code class="p">]</code><code class="o">&gt;</code>
<code class="p">)</code><code class="o">:</code> <code class="nx">AllElements</code><code class="p">[</code><code class="nx">T</code><code class="p">]</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="nx">elem</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">createElement</code><code class="p">(</code><code class="nx">tag</code> <code class="kr">as</code> <code class="kt">string</code><code class="p">)</code> <code class="kr">as</code> <code class="nx">AllElements</code><code class="p">[</code><code class="nx">T</code><code class="p">];</code>
  <code class="k">return</code> <code class="nb">Object</code><code class="p">.</code><code class="nx">assign</code><code class="p">(</code><code class="nx">elem</code><code class="p">,</code> <code class="nx">props</code><code class="p">);</code>
<code class="p">}</code>

<code class="kr">const</code> <code class="nx">a</code> <code class="o">=</code> <code class="nx">createElement</code><code class="p">(</code><code class="s2">"a"</code><code class="p">,</code> <code class="p">{</code> <code class="nx">href</code><code class="o">:</code> <code class="s2">"https://fettblog.eu"</code> <code class="p">});</code>
<code class="kr">const</code> <code class="nx">x</code> <code class="o">=</code> <code class="nx">createElement</code><code class="p">(</code><code class="s2">"a"</code><code class="p">,</code> <code class="p">{</code> <code class="nx">src</code><code class="o">:</code> <code class="s2">"https://fettblog.eu"</code> <code class="p">});</code>
<code class="c1">//                           ^--</code>
<code class="c1">// Argument of type '{ src: string; }' is not assignable to parameter</code>
<code class="c1">// of type 'Partial&lt;HTMLAnchorElement&gt;'.</code>
<code class="c1">// Object literal may only specify known properties, and 'src' does not</code>
<code class="c1">// exist in type 'Partial&lt;HTMLAnchorElement&gt;'.(2345)</code></pre>

<p><a data-type="indexterm" data-primary="HTMLElementTagNameMap" id="id640"></a>Fantastic! Now it’s up to you to figure out all 140 HTML elements. Or not. Somebody already did the work and put <code>HTMLElementTagNameMap</code> into <em>lib.dom.ts</em>. So let’s use this instead:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">createElement</code><code class="o">&lt;</code><code class="nx">T</code> <code class="kr">extends</code> <code class="kr">keyof</code> <code class="nx">HTMLElementTagNameMap</code><code class="o">&gt;</code><code class="p">(</code>
  <code class="nx">tag</code><code class="o">:</code> <code class="nx">T</code><code class="p">,</code>
  <code class="nx">props</code><code class="o">?:</code> <code class="nx">Partial</code><code class="o">&lt;</code><code class="nx">HTMLElementTagNameMap</code><code class="p">[</code><code class="nx">T</code><code class="p">]</code><code class="o">&gt;</code>
<code class="p">)</code><code class="o">:</code> <code class="nx">HTMLElementTagNameMap</code><code class="p">[</code><code class="nx">T</code><code class="p">]</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="nx">elem</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">createElement</code><code class="p">(</code><code class="nx">tag</code><code class="p">);</code>
  <code class="k">return</code> <code class="nb">Object</code><code class="p">.</code><code class="nx">assign</code><code class="p">(</code><code class="nx">elem</code><code class="p">,</code> <code class="nx">props</code><code class="p">);</code>
<code class="p">}</code></pre>

<p>This is also the interface used by <code>document.createElement</code>, so there is no friction between your factory function and the built-in one. No extra assertions necessary.</p>

<p>There is only one caveat. You are restricted to the 140 elements provided by <code>HT⁠ML​Ele⁠men⁠tTa⁠gNa⁠me⁠Map</code>. What if you want to create SVG elements, or web components that can have fully customized element names? Your factory function suddenly is 
<span class="keep-together">too constrained.</span></p>

<p>To allow for more—as <code>document.createElement</code> does—we would need to add all possible strings to the mix again. <code>HTMLElementTagNameMap</code> is an interface. <a data-type="indexterm" data-primary="declaration merging" data-secondary="type maps and" id="id641"></a><a data-type="indexterm" data-primary="index signatures" id="id642"></a>So we can use <em>declaration merging</em> to extend the interface with an <em>indexed signature</em>, where we map all remaining strings to <code>HTMLUnknownElement</code>:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">interface</code> <code class="nx">HTMLElementTagNameMap</code> <code class="p">{</code>
  <code class="p">[</code><code class="nx">x</code><code class="o">:</code> <code class="kt">string</code><code class="p">]</code><code class="o">:</code> <code class="nx">HTMLUnknownElement</code><code class="p">;</code>
<code class="p">};</code>

<code class="kd">function</code> <code class="nx">createElement</code><code class="o">&lt;</code><code class="nx">T</code> <code class="kr">extends</code> <code class="kr">keyof</code> <code class="nx">HTMLElementTagNameMap</code><code class="o">&gt;</code><code class="p">(</code>
  <code class="nx">tag</code><code class="o">:</code> <code class="nx">T</code><code class="p">,</code>
  <code class="nx">props</code><code class="o">?:</code> <code class="nx">Partial</code><code class="o">&lt;</code><code class="nx">HTMLElementTagNameMap</code><code class="p">[</code><code class="nx">T</code><code class="p">]</code><code class="o">&gt;</code>
<code class="p">)</code><code class="o">:</code> <code class="nx">HTMLElementTagNameMap</code><code class="p">[</code><code class="nx">T</code><code class="p">]</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="nx">elem</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">createElement</code><code class="p">(</code><code class="nx">tag</code><code class="p">);</code>
  <code class="k">return</code> <code class="nb">Object</code><code class="p">.</code><code class="nx">assign</code><code class="p">(</code><code class="nx">elem</code><code class="p">,</code> <code class="nx">props</code><code class="p">);</code>
<code class="p">}</code>

<code class="c1">// a is HTMLAnchorElement</code>
<code class="kr">const</code> <code class="nx">a</code> <code class="o">=</code> <code class="nx">createElement</code><code class="p">(</code><code class="s2">"a"</code><code class="p">,</code> <code class="p">{</code> <code class="nx">href</code><code class="o">:</code> <code class="s2">"https://fettblog.eu"</code> <code class="p">});</code>
<code class="c1">// b is HTMLUnknownElement</code>
<code class="kr">const</code> <code class="nx">b</code> <code class="o">=</code> <code class="nx">createElement</code><code class="p">(</code><code class="s2">"my-element"</code><code class="p">);</code></pre>

<p>Now we have everything we want:</p>

<ul>
<li>
<p>A great factory function to create typed HTML elements</p>
</li>
<li>
<p>The possibility to set element properties with just one configuration object</p>
</li>
<li>
<p>The flexibility to create more elements than defined</p>
</li>
</ul>

<p>The last is great, but what if you only want to allow for web components? Web components have a convention; they need to have a <em>dash</em> in their tag name. <a data-type="indexterm" data-primary="string template literal types" data-secondary="mapped types and" id="id643"></a>We can model this using a mapped type on a <em>string template literal type</em>. You will learn all about string template literal types in <a data-type="xref" href="ch06.html#ch06">Chapter 6</a>.</p>

<p>For now, the only thing you need to know is that we create a set of strings where the pattern is <em>any string</em> followed by a <em>dash</em> followed by <em>any string</em>. This is enough to ensure we only pass correct element names.</p>

<p><em>Mapped types</em> work only with type aliases, not interface declarations, so we need to define an <code>AllElements</code> type again:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">type</code> <code class="nx">AllElements</code> <code class="o">=</code> <code class="nx">HTMLElementTagNameMap</code> <code class="o">&amp;</code>
  <code class="p">{</code>
    <code class="p">[</code><code class="nx">x</code> <code class="k">in</code> <code class="sb">`</code><code class="si">${</code><code class="kt">string</code><code class="si">}</code><code class="sb">-</code><code class="si">${</code><code class="kt">string</code><code class="si">}</code><code class="sb">`</code><code class="p">]</code><code class="o">:</code> <code class="nx">HTMLElement</code><code class="p">;</code>
  <code class="p">};</code>

<code class="kd">function</code> <code class="nx">createElement</code><code class="o">&lt;</code><code class="nx">T</code> <code class="kr">extends</code> <code class="kr">keyof</code> <code class="nx">AllElements</code><code class="o">&gt;</code><code class="p">(</code>
  <code class="nx">tag</code><code class="o">:</code> <code class="nx">T</code><code class="p">,</code>
  <code class="nx">props</code><code class="o">?:</code> <code class="nx">Partial</code><code class="o">&lt;</code><code class="nx">AllElements</code><code class="p">[</code><code class="nx">T</code><code class="p">]</code><code class="o">&gt;</code>
<code class="p">)</code><code class="o">:</code> <code class="nx">AllElements</code><code class="p">[</code><code class="nx">T</code><code class="p">]</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="nx">elem</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">createElement</code><code class="p">(</code><code class="nx">tag</code> <code class="kr">as</code> <code class="kt">string</code><code class="p">)</code> <code class="kr">as</code> <code class="nx">AllElements</code><code class="p">[</code><code class="nx">T</code><code class="p">];</code>
  <code class="k">return</code> <code class="nb">Object</code><code class="p">.</code><code class="nx">assign</code><code class="p">(</code><code class="nx">elem</code><code class="p">,</code> <code class="nx">props</code><code class="p">);</code>
<code class="p">}</code>

<code class="kr">const</code> <code class="nx">a</code> <code class="o">=</code> <code class="nx">createElement</code><code class="p">(</code><code class="s2">"a"</code><code class="p">,</code> <code class="p">{</code> <code class="nx">href</code><code class="o">:</code> <code class="s2">"https://fettblog.eu"</code> <code class="p">});</code> <code class="c1">// OK</code>
<code class="kr">const</code> <code class="nx">b</code> <code class="o">=</code> <code class="nx">createElement</code><code class="p">(</code><code class="s2">"my-element"</code><code class="p">);</code> <code class="c1">// OK</code>


<code class="kr">const</code> <code class="nx">c</code> <code class="o">=</code> <code class="nx">createElement</code><code class="p">(</code><code class="s2">"thisWillError"</code><code class="p">);</code>
<code class="c1">//                      ^</code>
<code class="c1">// Argument of type '"thisWillError"' is not</code>
<code class="c1">// assignable to parameter of type '`${string}-${string}`</code>
<code class="c1">// | keyof HTMLElementTagNameMap'.(2345)</code></pre>

<p>Fantastic. With the <code>AllElements</code> type we also get type assertions back, which we don’t like that much. In that case, instead of asserting, we can also use a function overload, defining two declarations: one for our users, and one for us to implement the function. You can learn more about this function overload technique in Recipes <a data-type="xref" data-xrefstyle="select:labelnumber" href="ch02.html#ch02_item_function_overloads">2.6</a> and <a data-type="xref" data-xrefstyle="select:labelnumber" href="ch12.html#ch12_overloads_vs_conditionals">12.7</a>:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">createElement</code><code class="o">&lt;</code><code class="nx">T</code> <code class="kr">extends</code> <code class="kr">keyof</code> <code class="nx">AllElements</code><code class="o">&gt;</code><code class="p">(</code>
  <code class="nx">tag</code><code class="o">:</code> <code class="nx">T</code><code class="p">,</code>
  <code class="nx">props</code><code class="o">?:</code> <code class="nx">Partial</code><code class="o">&lt;</code><code class="nx">AllElements</code><code class="p">[</code><code class="nx">T</code><code class="p">]</code><code class="o">&gt;</code>
<code class="p">)</code><code class="o">:</code> <code class="nx">AllElements</code><code class="p">[</code><code class="nx">T</code><code class="p">];</code>
<code class="kd">function</code> <code class="nx">createElement</code><code class="p">(</code><code class="nx">tag</code><code class="o">:</code> <code class="kt">string</code><code class="p">,</code> <code class="nx">props</code><code class="o">?:</code> <code class="nx">Partial</code><code class="o">&lt;</code><code class="nx">HTMLElement</code><code class="o">&gt;</code><code class="p">)</code><code class="o">:</code> <code class="nx">HTMLElement</code> <code class="p">{</code>
  <code class="kr">const</code> <code class="nx">elem</code> <code class="o">=</code> <code class="nb">document</code><code class="p">.</code><code class="nx">createElement</code><code class="p">(</code><code class="nx">tag</code><code class="p">);</code>
  <code class="k">return</code> <code class="nb">Object</code><code class="p">.</code><code class="nx">assign</code><code class="p">(</code><code class="nx">elem</code><code class="p">,</code> <code class="nx">props</code><code class="p">);</code>
<code class="p">}</code></pre>

<p>We are all set. We defined a <em>type map</em> with <em>mapped types</em> and <em>index signatures</em>, using <em>generic type parameters</em> to be very explicit about our intentions. A great combination of multiple tools in our TypeScript tool belt.<a data-type="indexterm" data-startref="ix_04-08-asciidoc3" id="id644"></a><a data-type="indexterm" data-startref="ix_04-08-asciidoc2" id="id645"></a><a data-type="indexterm" data-startref="ix_04-08-asciidoc1" id="id646"></a><a data-type="indexterm" data-startref="ix_04-08-asciidoc0" id="id647"></a></p>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="4.8 Using ThisType to Define this in Objects"><div class="sect1" id="ch04_this_type">
<h1>4.8 Using ThisType to Define this in Objects</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="id82">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="generics" data-secondary="using ThisType&lt;T&gt; to define this in objects" id="ix_04-04-asciidoc0"></a><a data-type="indexterm" data-primary="this object pointer" data-secondary="using ThisType&lt;T&gt; to define this in objects" id="ix_04-04-asciidoc1"></a><a data-type="indexterm" data-primary="ThisType&lt;T&gt;" id="ix_04-04-asciidoc2"></a>Your app requires complex configuration objects with methods, where <code>this</code> has a different context depending on usage.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="id648">
<h2>Solution</h2>

<p>Use the built-in generic <code>ThisType&lt;T&gt;</code> to define the correct <code>this</code>.</p>
</div></section>








<section data-type="sect2" class="less_space pagebreak-before" data-pdf-bookmark="Discussion"><div class="sect2" id="id83">
<h2>Discussion</h2>

<p>Frameworks like <a href="https://vuejs.org">VueJS</a> rely a lot on factory functions, where you pass a comprehensive configuration object to define initial data, computed properties, and methods for each instance. You want to create a similar behavior for components of your app. The idea is to provide a configuration object with three properties:</p>
<dl>
<dt>A <code>data</code> function</dt>
<dd>
<p>The return value is the initial data for the instance. You should not have access to any other properties from the configuration object in this function.</p>
</dd>
<dt>A <code>computed</code> property</dt>
<dd>
<p>This is for computed properties, which are based on the initial data. Computed properties are declared using functions. They can access initial data just like 
<span class="keep-together">normal properties.</span></p>
</dd>
<dt>A <code>methods</code> property</dt>
<dd>
<p>Methods can be called and can access computed properties as well as the initial data. When methods access computed properties, they access it like they would access normal properties: no need to call the function.</p>
</dd>
</dl>

<p>Looking at the configuration object in use, there are three different ways to interpret <code>this</code>. In <code>data</code>, <code>this</code> doesn’t have any properties at all. In <code>computed</code>, each function can access the return value of <code>data</code> via <code>this</code> just like it would be part of their object. In <code>methods</code>, each method can access computed properties and <code>data</code> via <code>this</code> in the same way:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">const</code> <code class="nx">instance</code> <code class="o">=</code> <code class="nx">create</code><code class="p">({</code>
  <code class="nx">data</code><code class="p">()</code> <code class="p">{</code>
    <code class="k">return</code> <code class="p">{</code>
      <code class="nx">firstName</code><code class="o">:</code> <code class="s2">"Stefan"</code><code class="p">,</code>
      <code class="nx">lastName</code><code class="o">:</code> <code class="s2">"Baumgartner"</code><code class="p">,</code>
    <code class="p">};</code>
  <code class="p">},</code>
  <code class="nx">computed</code><code class="o">:</code> <code class="p">{</code>
    <code class="nx">fullName</code><code class="p">()</code> <code class="p">{</code>
      <code class="c1">// has access to the return object of data</code>
      <code class="k">return</code> <code class="k">this</code><code class="p">.</code><code class="nx">firstName</code> <code class="o">+</code> <code class="s2">" "</code> <code class="o">+</code> <code class="k">this</code><code class="p">.</code><code class="nx">lastName</code><code class="p">;</code>
    <code class="p">},</code>
  <code class="p">},</code>
  <code class="nx">methods</code><code class="o">:</code> <code class="p">{</code>
    <code class="nx">hi</code><code class="p">()</code> <code class="p">{</code>
      <code class="c1">// use computed properties just like normal properties</code>
      <code class="nx">alert</code><code class="p">(</code><code class="k">this</code><code class="p">.</code><code class="nx">fullName</code><code class="p">.</code><code class="nx">toLowerCase</code><code class="p">());</code>
    <code class="p">},</code>
  <code class="p">},</code>
<code class="p">});</code></pre>

<p>This behavior is special but not uncommon. And with a behavior like that, we definitely want to rely on good types.</p>
<div data-type="note" epub:type="note"><h6>Note</h6>
<p>In this lesson we will focus only on the types, not on the actual implementation, as that would exceed this chapter’s scope.</p>
</div>

<p>Let’s create types for each property. We define a type <code>Options</code>, which we are going to refine step by step. First is the <code>data</code> function. <code>data</code> can be user defined, so we want to specify <code>data</code> using a generic type parameter. The data we are looking for is specified by the return type of the <code>data</code> function:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">type</code> <code class="nx">Options</code><code class="o">&lt;</code><code class="nx">Data</code><code class="o">&gt;</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">data</code><code class="p">(</code><code class="k">this</code><code class="o">:</code> <code class="p">{})</code><code class="o">?:</code> <code class="nx">Data</code><code class="p">;</code>
<code class="p">};</code></pre>

<p>So once we specify an actual return value in the <code>data</code> function, the <code>Data</code> placeholder gets substituted with the real object’s type. Note that we also define <code>this</code> to point to the empty object, which means that we don’t get access to any other property from the configuration object.</p>

<p>Next, we define <code>computed</code>. <code>computed</code> is an object of functions. We add another generic type parameter called <code>Computed</code> and let the value of <code>Computed</code> be typed through usage. Here, <code>this</code> changes to all the properties of <code>Data</code>. Since we can’t set <code>this</code> like we do in the <code>data</code> function, we can use the built-in helper type <code>ThisType</code> and set it to the generic type parameter <code>Data</code>:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">type</code> <code class="nx">Options</code><code class="o">&lt;</code><code class="nx">Data</code><code class="p">,</code> <code class="nx">Computed</code><code class="o">&gt;</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">data</code><code class="p">(</code><code class="k">this</code><code class="o">:</code> <code class="p">{})</code><code class="o">?:</code> <code class="nx">Data</code><code class="p">;</code>
  <code class="nx">computed</code><code class="o">?:</code> <code class="nx">Computed</code> <code class="o">&amp;</code> <code class="nx">ThisType</code><code class="o">&lt;</code><code class="nx">Data</code><code class="o">&gt;</code><code class="p">;</code>
<code class="p">};</code></pre>

<p>This allows us to access, for example, <code>this.firstName</code>, like in the previous example. Last but not least, we want to specify <code>methods</code>. <code>methods</code> is again special, as you are getting access not only to <code>Data</code> via <code>this</code> but also to all methods and to all computed properties as properties.</p>

<p><code>Computed</code> holds all computed properties as functions. We would need their value, though—more specifically, their return value. If we access <code>fullName</code> via property access, we expect it to be a <code>string</code>.</p>

<p class="pagebreak-before">For that, we create a helper type called <code>MapFnToProp</code>. It takes a type that is an object of functions and maps it to the return values’ types. The built-in <code>ReturnType</code> helper type is perfect for this scenario:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="c1">// An object of functions ...</code>
<code class="kr">type</code> <code class="nx">FnObj</code> <code class="o">=</code> <code class="nx">Record</code><code class="o">&lt;</code><code class="kt">string</code><code class="p">,</code> <code class="p">()</code> <code class="o">=&gt;</code> <code class="kr">any</code><code class="o">&gt;</code><code class="p">;</code>

<code class="c1">// ... to an object of return types</code>
<code class="kr">type</code> <code class="nx">MapFnToProp</code><code class="o">&lt;</code><code class="nx">FunctionObj</code> <code class="kr">extends</code> <code class="nx">FnObj</code><code class="o">&gt;</code> <code class="o">=</code> <code class="p">{</code>
  <code class="p">[</code><code class="nx">K</code> <code class="k">in</code> <code class="kr">keyof</code> <code class="nx">FunctionObj</code><code class="p">]</code><code class="o">:</code> <code class="nx">ReturnType</code><code class="o">&lt;</code><code class="nx">FunctionObj</code><code class="p">[</code><code class="nx">K</code><code class="p">]</code><code class="o">&gt;</code><code class="p">;</code>
<code class="p">};</code></pre>

<p>We can use <code>MapFnToProp</code> to set <code>ThisType</code> for a newly added generic type parameter called <code>Methods</code>. We also add <code>Data</code> and <code>Methods</code> to the mix. To pass the <code>Computed</code> generic type parameter to <code>MapFnToProp</code>, it needs to be constrained to <code>FnObj</code>, the same constraint of the first parameter <code>FunctionObj</code> in <code>MapFnToProp</code>:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">type</code> <code class="nx">Options</code><code class="o">&lt;</code><code class="nx">Data</code><code class="p">,</code> <code class="nx">Computed</code> <code class="kr">extends</code> <code class="nx">FnObj</code><code class="p">,</code> <code class="nx">Methods</code><code class="o">&gt;</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">data</code><code class="p">(</code><code class="k">this</code><code class="o">:</code> <code class="p">{})</code><code class="o">?:</code> <code class="nx">Data</code><code class="p">;</code>
  <code class="nx">computed</code><code class="o">?:</code> <code class="nx">Computed</code> <code class="o">&amp;</code> <code class="nx">ThisType</code><code class="o">&lt;</code><code class="nx">Data</code><code class="o">&gt;</code><code class="p">;</code>
  <code class="nx">methods</code><code class="o">?:</code> <code class="nx">Methods</code> <code class="o">&amp;</code> <code class="nx">ThisType</code><code class="o">&lt;</code><code class="nx">Data</code> <code class="o">&amp;</code> <code class="nx">MapFnToProp</code><code class="o">&lt;</code><code class="nx">Computed</code><code class="o">&gt;</code> <code class="o">&amp;</code> <code class="nx">Methods</code><code class="o">&gt;</code><code class="p">;</code>
<code class="p">};</code></pre>

<p>And that’s the type! We take all generic type properties and add them to the <code>create</code> factory function:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">declare</code> <code class="kd">function</code> <code class="nx">create</code><code class="o">&lt;</code><code class="nx">Data</code><code class="p">,</code> <code class="nx">Computed</code> <code class="kr">extends</code> <code class="nx">FnObj</code><code class="p">,</code> <code class="nx">Methods</code><code class="o">&gt;</code><code class="p">(</code>
  <code class="nx">options</code><code class="o">:</code> <code class="nx">Options</code><code class="o">&lt;</code><code class="nx">Data</code><code class="p">,</code> <code class="nx">Computed</code><code class="p">,</code> <code class="nx">Methods</code><code class="o">&gt;</code>
<code class="p">)</code><code class="o">:</code> <code class="kr">any</code><code class="p">;</code></pre>

<p>Through usage, all generic type parameters will be substituted. And the way <code>Options</code> is typed, we get all the autocomplete necessary to ensure we don’t run into troubles, as seen in <a data-type="xref" href="#img-autocomplete-thistype">Figure 4-1</a>.</p>

<p>This example shows wonderfully how TypeScript can be used to type elaborate APIs where a lot of object manipulation is happening underneath<a data-type="indexterm" data-startref="ix_04-04-asciidoc2" id="id649"></a><a data-type="indexterm" data-startref="ix_04-04-asciidoc1" id="id650"></a><a data-type="indexterm" data-startref="ix_04-04-asciidoc0" id="id651"></a>.<sup><a data-type="noteref" id="id652-marker" href="ch04.html#id652">1</a></sup></p>

<figure><div id="img-autocomplete-thistype" class="figure">
<img src="/api/v2/epubs/9781098136642/files/assets/tscb_0401.png" alt="tscb 0401" width="600" height="698">
<h6><span class="label">Figure 4-1. </span>The methods configuration in the factory function having all the access to the correct properties</h6>
</div></figure>
</div></section>
</div></section>






<section data-type="sect1" data-pdf-bookmark="4.9 Adding Const Context to Generic Type Parameters"><div class="sect1" id="ch04_const_type_parameters">
<h1>4.9 Adding Const Context to Generic Type Parameters</h1>








<section data-type="sect2" data-pdf-bookmark="Problem"><div class="sect2" id="id84">
<h2>Problem</h2>

<p><a data-type="indexterm" data-primary="const modifier" id="ix_04-09-asciidoc0"></a><a data-type="indexterm" data-primary="generics" data-secondary="adding const context to generic type parameters" id="ix_04-09-asciidoc1"></a>When you pass complex, literal values to a function, TypeScript widens the type to something more general. While this is desired behavior in a lot of cases, in some you want to work on the literal types rather than the widened type.</p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Solution"><div class="sect2" id="id653">
<h2>Solution</h2>

<p>Add a <code>const</code> modifier in front of your generic type parameter to keep the passed 
<span class="keep-together">values in <em>const context</em>.</span></p>
</div></section>








<section data-type="sect2" data-pdf-bookmark="Discussion"><div class="sect2" id="id85">
<h2>Discussion</h2>

<p><a data-type="indexterm" data-primary="single-page application (SPA) frameworks" id="id654"></a><a data-type="indexterm" data-primary="SPA (single-page application) frameworks" id="id655"></a>Single-page application (SPA) frameworks tend to reimplement a lot of browser functionality in JavaScript. For example, features like the <a href="https://oreil.ly/KMBgj">History API</a> made it possible to override the regular navigation behavior, which SPA frameworks use to switch between pages without a real page reload, by swapping the content of the page and changing the URL in the browser.</p>

<p>Imagine working on a minimalistic SPA framework that uses a so-called router to navigate between pages. <a data-type="indexterm" data-primary="components (SPA framework)" id="id656"></a>Pages are defined as <em>components</em>, and a <code>ComponentConstructor</code> interface knows how to instantiate and render new elements on your website:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">interface</code> <code class="nx">ComponentConstructor</code> <code class="p">{</code>
  <code class="k">new</code><code class="p">()</code><code class="o">:</code> <code class="nx">Component</code><code class="p">;</code>
<code class="p">}</code>

<code class="kr">interface</code> <code class="nx">Component</code> <code class="p">{</code>
  <code class="nx">render</code><code class="p">()</code><code class="o">:</code> <code class="nx">HTMLElement</code><code class="p">;</code>
<code class="p">}</code></pre>

<p><a data-type="indexterm" data-primary="router (SPA framework)" id="id657"></a>The <em>router</em> should take a list of components and associated paths, stored as <code>string</code>. When creating a router through the <code>router</code> function, it should return an object that lets you <code>navigate</code> the desired path:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">type</code> <code class="nx">Route</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">path</code><code class="o">:</code> <code class="kt">string</code><code class="p">;</code>
  <code class="nx">component</code><code class="o">:</code> <code class="nx">ComponentConstructor</code><code class="p">;</code>
<code class="p">};</code>

<code class="kd">function</code> <code class="nx">router</code><code class="p">(</code><code class="nx">routes</code><code class="o">:</code> <code class="nx">Route</code><code class="p">[])</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">{</code>
    <code class="nx">navigate</code><code class="p">(</code><code class="nx">path</code><code class="o">:</code> <code class="kt">string</code><code class="p">)</code> <code class="p">{</code>
      <code class="c1">// ...</code>
    <code class="p">},</code>
  <code class="p">};</code>
<code class="p">}</code></pre>

<p>How the actual navigation is implemented is of no concern to us right now; instead, we want to focus on the typings of the function interface.</p>

<p>The router works as intended; it takes an array of <code>Route</code> objects and returns an object with a <code>navigate</code> function, which allows us to trigger the navigation from one URL to the other and renders the new component:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">const</code> <code class="nx">rtr</code> <code class="o">=</code> <code class="nx">router</code><code class="p">([</code>
  <code class="p">{</code>
    <code class="nx">path</code><code class="o">:</code> <code class="s2">"/"</code><code class="p">,</code>
    <code class="nx">component</code><code class="o">:</code> <code class="nx">Main</code><code class="p">,</code>
  <code class="p">},</code>
  <code class="p">{</code>
    <code class="nx">path</code><code class="o">:</code> <code class="s2">"/about"</code><code class="p">,</code>
    <code class="nx">component</code><code class="o">:</code> <code class="nx">About</code><code class="p">,</code>
  <code class="p">},</code>
<code class="p">])</code>

<code class="nx">rtr</code><code class="p">.</code><code class="nx">navigate</code><code class="p">(</code><code class="s2">"/faq"</code><code class="p">);</code></pre>

<p>What you immediately see is that the types are way too broad. If we allow navigating to every <code>string</code> available, nothing keeps us from using bogus routes that lead nowhere. We would need to implement some sort of error handling for information that is already ready and available. So why not use it?</p>

<p>Our first idea would be to replace the concrete type with a generic type parameter. The way TypeScript deals with generic substitution is that if we have a literal type, TypeScript will subtype accordingly. Introducing <code>T</code> for <code>Route</code> and using <code>T["path"]</code> instead of <code>string</code> comes close to what we want to achieve:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">router</code><code class="o">&lt;</code><code class="nx">T</code> <code class="kr">extends</code> <code class="nx">Route</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">routes</code><code class="o">:</code> <code class="nx">T</code><code class="p">[])</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">{</code>
    <code class="nx">navigate</code><code class="p">(</code><code class="nx">path</code><code class="o">:</code> <code class="nx">T</code><code class="p">[</code><code class="s2">"path"</code><code class="p">])</code> <code class="p">{</code>
      <code class="c1">// ...</code>
    <code class="p">},</code>
  <code class="p">};</code>
<code class="p">}</code></pre>

<p>In theory, this should work. If we remind ourselves what TypeScript does with literal, primitives types in that case, we would expect the value to be narrowed to the literal type:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">getPath</code><code class="o">&lt;</code><code class="nx">T</code> <code class="kr">extends</code> <code class="kt">string</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">route</code><code class="o">:</code> <code class="nx">T</code><code class="p">)</code><code class="o">:</code> <code class="nx">T</code> <code class="p">{</code>
  <code class="k">return</code> <code class="nx">route</code><code class="p">;</code>
<code class="p">}</code>

<code class="kr">const</code> <code class="nx">path</code> <code class="o">=</code> <code class="nx">getPath</code><code class="p">(</code><code class="s2">"/"</code><code class="p">);</code> <code class="c1">// "/"</code></pre>

<p>You can read more on that in <a data-type="xref" href="#ch04_no_any">Recipe 4.3</a>. One important detail is that <code>path</code> in the previous example is in a <em>const context</em>, because the returned value is immutable.</p>

<p>The only problem is that we are working with objects and arrays, and TypeScript tends to widen types in objects and arrays to something more general to allow for the mutability of values. If we look at a similar example, but with a nested object, we see that TypeScript takes the broader type instead:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">type</code> <code class="nx">Routes</code> <code class="o">=</code> <code class="p">{</code>
  <code class="nx">paths</code><code class="o">:</code> <code class="kt">string</code><code class="p">[];</code>
<code class="p">};</code>

<code class="kd">function</code> <code class="nx">getPaths</code><code class="o">&lt;</code><code class="nx">T</code> <code class="kr">extends</code> <code class="nx">Routes</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">routes</code><code class="o">:</code> <code class="nx">T</code><code class="p">)</code><code class="o">:</code> <code class="nx">T</code><code class="p">[</code><code class="s2">"paths"</code><code class="p">]</code> <code class="p">{</code>
  <code class="k">return</code> <code class="nx">routes</code><code class="p">.</code><code class="nx">paths</code><code class="p">;</code>
<code class="p">}</code>

<code class="kr">const</code> <code class="nx">paths</code> <code class="o">=</code> <code class="nx">getPaths</code><code class="p">({</code> <code class="nx">paths</code><code class="o">:</code> <code class="p">[</code><code class="s2">"/"</code><code class="p">,</code> <code class="s2">"/about"</code><code class="p">]</code> <code class="p">});</code> <code class="c1">// string[]</code></pre>

<p>For objects, the <em>const context</em> for <code>paths</code> is only for the binding of the variable, not for its contents. This eventually leads to losing some of the information we need to correctly type <code>navigate</code>.</p>

<p>A way to work around this limitation is to manually apply <em>const context</em>, which needs us to redefine the input parameter to be <code>readonly</code>:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">router</code><code class="o">&lt;</code><code class="nx">T</code> <code class="kr">extends</code> <code class="nx">Route</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">routes</code><code class="o">:</code> <code class="kr">readonly</code> <code class="nx">T</code><code class="p">[])</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">{</code>
    <code class="nx">navigate</code><code class="p">(</code><code class="nx">path</code><code class="o">:</code> <code class="nx">T</code><code class="p">[</code><code class="s2">"path"</code><code class="p">])</code> <code class="p">{</code>
      <code class="nx">history</code><code class="p">.</code><code class="nx">pushState</code><code class="p">({},</code> <code class="s2">""</code><code class="p">,</code> <code class="nx">path</code><code class="p">);</code>
    <code class="p">},</code>
  <code class="p">};</code>
<code class="p">}</code>

<code class="kr">const</code> <code class="nx">rtr</code> <code class="o">=</code> <code class="nx">router</code><code class="p">([</code>
  <code class="p">{</code>
    <code class="nx">path</code><code class="o">:</code> <code class="s2">"/"</code><code class="p">,</code>
    <code class="nx">component</code><code class="o">:</code> <code class="nx">Main</code><code class="p">,</code>
  <code class="p">},</code>
  <code class="p">{</code>
    <code class="nx">path</code><code class="o">:</code> <code class="s2">"/about"</code><code class="p">,</code>
    <code class="nx">component</code><code class="o">:</code> <code class="nx">About</code><code class="p">,</code>
  <code class="p">},</code>
<code class="p">]</code> <code class="kr">as</code> <code class="kr">const</code><code class="p">);</code>

<code class="nx">rtr</code><code class="p">.</code><code class="nx">navigate</code><code class="p">(</code><code class="s2">"/about"</code><code class="p">);</code></pre>

<p>This works but also requires that we not forget a very important detail when coding. And actively remembering workarounds is always a recipe for disaster.</p>

<p>Thankfully, TypeScript allows us to request <em>const context</em> from generic type parameters. Instead of applying it to the value, we substitute the generic type parameter for a concrete value <em>but</em> in <em>const context</em> by adding the <code>const</code> modifier to the generic type parameter:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kd">function</code> <code class="nx">router</code><code class="o">&lt;</code><code class="kr">const</code> <code class="nx">T</code> <code class="kr">extends</code> <code class="nx">Route</code><code class="o">&gt;</code><code class="p">(</code><code class="nx">routes</code><code class="o">:</code> <code class="nx">T</code><code class="p">[])</code> <code class="p">{</code>
  <code class="k">return</code> <code class="p">{</code>
    <code class="nx">navigate</code><code class="p">(</code><code class="nx">path</code><code class="o">:</code> <code class="nx">T</code><code class="p">[</code><code class="s2">"path"</code><code class="p">])</code> <code class="p">{</code>
      <code class="c1">// tbd</code>
    <code class="p">},</code>
  <code class="p">};</code>
<code class="p">}</code></pre>

<p>We can then use our router just as we are accustomed to and even get autocomplete for possible paths:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">const</code> <code class="nx">rtr</code> <code class="o">=</code> <code class="nx">router</code><code class="p">([</code>
  <code class="p">{</code>
    <code class="nx">path</code><code class="o">:</code> <code class="s2">"/"</code><code class="p">,</code>
    <code class="nx">component</code><code class="o">:</code> <code class="nx">Main</code><code class="p">,</code>
  <code class="p">},</code>
  <code class="p">{</code>
    <code class="nx">path</code><code class="o">:</code> <code class="s2">"/about"</code><code class="p">,</code>
    <code class="nx">component</code><code class="o">:</code> <code class="nx">About</code><code class="p">,</code>
  <code class="p">},</code>
<code class="p">])</code>

<code class="nx">rtr</code><code class="p">.</code><code class="nx">navigate</code><code class="p">(</code><code class="s2">"/about"</code><code class="p">);</code></pre>

<p>Even better, we get proper errors when we pass in something bogus:</p>

<pre data-type="programlisting" data-code-language="typescript"><code class="kr">const</code> <code class="nx">rtr</code> <code class="o">=</code> <code class="nx">router</code><code class="p">([</code>
  <code class="p">{</code>
    <code class="nx">path</code><code class="o">:</code> <code class="s2">"/"</code><code class="p">,</code>
    <code class="nx">component</code><code class="o">:</code> <code class="nx">Main</code><code class="p">,</code>
  <code class="p">},</code>
  <code class="p">{</code>
    <code class="nx">path</code><code class="o">:</code> <code class="s2">"/about"</code><code class="p">,</code>
    <code class="nx">component</code><code class="o">:</code> <code class="nx">About</code><code class="p">,</code>
  <code class="p">},</code>
<code class="p">])</code>

<code class="nx">rtr</code><code class="p">.</code><code class="nx">navigate</code><code class="p">(</code><code class="s2">"/faq"</code><code class="p">);</code>
<code class="c1">//             ^</code>
<code class="c1">// Argument of type '"/faq"' is not assignable to</code>
<code class="c1">// parameter of type '"/" | "/about"'.(2345)</code></pre>

<p>The beautiful thing: it’s all hidden in the function’s API. What we expect becomes clearer, the interface tells us the constraints, and we don’t have to do anything extra when using <code>router</code> to ensure type safety.<a data-type="indexterm" data-startref="ix_04-09-asciidoc1" id="id658"></a><a data-type="indexterm" data-startref="ix_04-09-asciidoc0" id="id659"></a></p>
</div></section>
</div></section>
<div data-type="footnotes"><p data-type="footnote" id="id652"><sup><a href="ch04.html#id652-marker">1</a></sup> Special thanks to the creators of <a href="https://oreil.ly/pHc9j">Type Challenges</a> for this beautiful example.</p></div></div></section></div>
    </div>
    
    <section class="t-bottom-cta bottom-cta bottom-cta-book free-chapter">
  <p>Get <em>TypeScript Cookbook</em> now with the O’Reilly <span class="nowrap">learning platform.</span></p>
  <p>O’Reilly members experience books, live events, courses curated by job role, and more from O’Reilly and <span class="nowrap">nearly 200 top publishers.</span></p>

  <div class="controls">
      <a href="https://learning.oreilly.com/p/register/" class="button-primary" data-ga-label="Bottom CTA">Start your free trial</a>
  </div>
</section>

</div>


</section>



  </div>
</main>


  <footer id="footer" class="footer">
  <div class="content">
    <div class="footer-main" aria-label="company info">
      <div class="footer-mainLeft">
        <div class="footer-mainLeftOne">
          <div class="footer-approach">
            <h2 class="footer-header"><a href="https://www.oreilly.com/about/">About O’Reilly</a></h2>
            <ul class="footer-links">
              <li><a href="https://www.oreilly.com/work-with-us.html">Teach/write/train</a></li>
              <li><a href="https://www.oreilly.com/careers/">Careers</a></li>
              <li><a href="https://www.oreilly.com/press/">Press releases</a></li>
              <li><a href="https://www.oreilly.com/press/media-coverage.html">Media coverage</a></li>
              <li><a href="https://www.oreilly.com/partner/signup.csp">Community partners</a></li>
              <li><a href="https://www.oreilly.com/affiliates/">Affiliate program</a></li>
              <li><a href="https://www.oreilly.com/online-learning/rfp.html">Submit an RFP</a></li>
              <li><a href="https://www.oreilly.com/diversity/">Diversity</a></li>
              <li><a href="https://www.oreilly.com/content-marketing-solutions.html" id="footerSponsorshipLink">O’Reilly for marketers</a></li>
            </ul>
          </div>
        </div>
        <div class="footer-mainLeftTwo">
          <div class="footer-contact">
            <h2 class="footer-header"><a href="https://www.oreilly.com/online-learning/support/">Support</a></h2>

            <ul class="footer-links">
              <li><a href="https://www.oreilly.com/about/contact.html">Contact us</a></li>
              <li><a href="https://www.oreilly.com/emails/newsletters/">Newsletters</a></li>
              <li><a href="https://www.oreilly.com/privacy.html">Privacy policy</a></li>
            </ul>
          
            <a href="https://twitter.com/oreillymedia" target="_blank"><svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" viewBox="0 0 400 400" style="enable-background:new 0 0 400 400;" xml:space="preserve"><style type="text/css">.st0{fill:#ee0000;}.st1{fill:#FFFFFF;}</style><g id="Red"><circle class="st0" cx="200" cy="200" r="200"/></g><g id="Logo__x2014__FIXED"><path class="st1" d="M163.4,305.5c88.7,0,137.2-73.5,137.2-137.2c0-2.1,0-4.2-0.1-6.2c9.4-6.8,17.6-15.3,24.1-25 c-8.6,3.8-17.9,6.4-27.7,7.6c10-6,17.6-15.4,21.2-26.7c-9.3,5.5-19.6,9.5-30.6,11.7c-8.8-9.4-21.3-15.2-35.2-15.2 c-26.6,0-48.2,21.6-48.2,48.2c0,3.8,0.4,7.5,1.3,11c-40.1-2-75.6-21.2-99.4-50.4c-4.1,7.1-6.5,15.4-6.5,24.2 c0,16.7,8.5,31.5,21.5,40.1c-7.9-0.2-15.3-2.4-21.8-6c0,0.2,0,0.4,0,0.6c0,23.4,16.6,42.8,38.7,47.3c-4,1.1-8.3,1.7-12.7,1.7 c-3.1,0-6.1-0.3-9.1-0.9c6.1,19.2,23.9,33.1,45,33.5c-16.5,12.9-37.3,20.6-59.9,20.6c-3.9,0-7.7-0.2-11.5-0.7 C110.8,297.5,136.2,305.5,163.4,305.5"/></g></svg></a>
            <a href="https://www.linkedin.com/company/oreilly-media" target="_blank"><svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32.25 32.25"><defs><style>.cls-1{fill:#E00;fill-rule:evenodd;}</style></defs><title>linkedin-logo</title><path class="cls-1" d="M17.43,13.53v0l0,0ZM16.12,0A16.13,16.13,0,1,0,32.25,16.12,16.12,16.12,0,0,0,16.12,0ZM11.77,22.92H8.12v-11h3.65ZM9.94,10.44h0a1.89,1.89,0,0,1-2-1.89A1.91,1.91,0,0,1,10,6.65a1.9,1.9,0,1,1,0,3.79Zm15,12.48H21.28V17.05c0-1.48-.53-2.49-1.85-2.49a2,2,0,0,0-1.88,1.34,2.63,2.63,0,0,0-.12.89v6.13H13.79s.05-10,0-11h3.64V13.5a3.63,3.63,0,0,1,3.29-1.82c2.4,0,4.21,1.57,4.21,4.95Z"/></svg></a>
            <a href="https://www.youtube.com/user/OreillyMedia" target="_blank"><svg data-name="Layer 1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 32.25 32.25"><defs><style>.cls-1{fill:#E00;fill-rule:evenodd;}</style></defs><title>youtube-logo</title><path class="cls-1" d="M18.35,18.68a.89.89,0,0,0-.86.63V16.94h-1v7.59h1v-.59a.92.92,0,0,0,.89.74c.52,0,.86-.36,1-1.07a8.56,8.56,0,0,0,.14-1.9,10.47,10.47,0,0,0-.12-1.93C19.21,19.05,18.87,18.68,18.35,18.68Zm.09,4.14c-.05.52-.2.77-.45.77s-.43-.21-.49-.63a7.22,7.22,0,0,1,0-1c0-.72,0-1.14,0-1.26.07-.58.23-.88.51-.88s.4.27.46.79c0,.09,0,.47,0,1.13S18.46,22.71,18.44,22.82ZM8.61,18.19H9.86v6.34H11V18.19H12.2V16.94H8.61Zm7.71-6.12c.27,0,.43-.22.49-.66,0-.09,0-.45,0-1.07V9.78c0-.58,0-.93,0-1-.07-.43-.23-.65-.48-.65s-.41.19-.48.57a8.79,8.79,0,0,0,0,1v.53c0,.71,0,1.09,0,1.16C15.88,11.82,16.05,12.07,16.32,12.07Zm-1.74,10.4a2.92,2.92,0,0,1-.06.71c-.07.25-.2.37-.4.37s-.32-.11-.38-.34a2.63,2.63,0,0,1-.05-.66V18.83h-1v4.48c0,.91.33,1.37,1,1.37A1,1,0,0,0,14.6,24v.57h1v-5.7h-1Zm7.1-3.79a1.35,1.35,0,0,0-1.22.59,2.48,2.48,0,0,0-.3,1.07c0,.23,0,.61,0,1.16s0,1.13,0,1.37a2.93,2.93,0,0,0,.35,1.27,1.25,1.25,0,0,0,1.14.54,1.36,1.36,0,0,0,1.13-.45,2.29,2.29,0,0,0,.37-1.43s0-.07,0-.11v-.12h-1c0,.75-.17,1.12-.51,1.12s-.38-.18-.45-.56a4.68,4.68,0,0,1-.06-.9c0-.18,0-.31,0-.37h2v-.43a4.86,4.86,0,0,0-.3-2.11A1.28,1.28,0,0,0,21.68,18.68ZM22.15,21h-1c0-.05,0-.11,0-.16v-.08a1.64,1.64,0,0,1,.11-.8.39.39,0,0,1,.38-.23.42.42,0,0,1,.43.33,2.32,2.32,0,0,1,.07.7Zm-6-21A16.13,16.13,0,1,0,32.25,16.12,16.12,16.12,0,0,0,16.12,0Zm2.51,7.2h1V11a2.52,2.52,0,0,0,.06.66c.06.23.18.34.38.34s.34-.12.41-.37a3.76,3.76,0,0,0,.05-.71V7.2h1v5.74h-1v-.57a1,1,0,0,1-.93.72c-.66,0-1-.46-1-1.38ZM15,8a1.29,1.29,0,0,1,1.33-.92A1.3,1.3,0,0,1,17.65,8a6.77,6.77,0,0,1,.23,2.1,6.77,6.77,0,0,1-.23,2.1,1.3,1.3,0,0,1-1.32.92A1.29,1.29,0,0,1,15,12.17a6.77,6.77,0,0,1-.23-2.1A6.86,6.86,0,0,1,15,8ZM11.45,5.3l.89,2.87.88-2.87H14.4L12.88,9.7v3.24h-1.1V9.7L10.24,5.3ZM24.93,23.91a3,3,0,0,1-3,3h-12a3,3,0,0,1-3-3V18.05a3,3,0,0,1,3-3h12a3,3,0,0,1,3,3Z"/></svg></a>
          </div>

          <div class="footer-international">
            <h2 class="footer-header">International</h2>

            <ul class="footer-links">
              <li><a href="https://www.oreilly.com/anz/">Australia &amp; New Zealand</a></li>
              <li><a href="https://oreilly.hk/">Hong Kong &amp; Taiwan</a></li>
              <li><a href="https://oreillylearning.in/">India</a></li>
              <li><a href="https://oreilly.id/">Indonesia</a></li>
              <li><a href="https://www.oreilly.co.jp/index.shtml">Japan</a></li>
            </ul>
          </div>
        </div>
      </div>

      <div class="footer-download" id="download-info">
        <h2 class="footer-header">Download the O’Reilly App</h2>
        <p>Take O’Reilly with you and learn anywhere, anytime on your phone <span class="nowrap">and tablet.</span></p>

        <div class="footer-downloadLinks">
          <a href="https://itunes.apple.com/us/app/safari-to-go/id881697395"><img src="https://cdn.oreillystatic.com/oreilly/images/app-store-logo.png" alt="Apple app store" /></a>
          <a href="https://play.google.com/store/apps/details?id=com.safariflow.queue"><img src="https://cdn.oreillystatic.com/oreilly/images/google-play-logo.png"  alt="Google play store" /></a>
        </div>
      </div>

      <div class="footer-download" id="tv-info">
        <h2 class="footer-header">Watch on your big screen</h2>
        <p>View all O’Reilly videos, Superstream events, and Meet the Expert sessions on your <span class="nowrap">home TV.</span></p>

        <div class="footer-downloadLinks">
          <a href="https://channelstore.roku.com/details/c8a2d0096693eb9455f6ac165003ee06/oreilly"><img src="https://cdn.oreillystatic.com/oreilly/images/roku-tv-logo.png" alt="Roku Payers and TVs" /></a>
          <a href="https://www.amazon.com/OReilly-Media-Inc/dp/B087YYHL5C/ref=sr_1_2?dchild=1&keywords=oreilly&qid=1604964116&s=mobile-apps&sr=1-2"><img src="https://cdn.oreillystatic.com/oreilly/images/amazon-appstore-logo.png"  alt="Amazon appstore" /></a>
        </div>
      </div>

      <div class="footer-donotsell" id="donotsell-info">
        <h2 class="footer-header"><a href="https://www.oreilly.com/privacy.html?donotsell=show">Do not sell my personal information</a></h2>
      </div>
    </div>

    <div class="footer-subfooter">

      <a href="https://www.oreilly.com" title="home page" aria-current="page">
        <img 
        class="footer-subfooterLogo" 
        id="footer-subfooterLogo"
        src="https://cdn.oreillystatic.com/images/sitewide-headers/oreilly_logo_mark_red.svg" 
        onerror="this.src='https://cdn.oreillystatic.com/images/sitewide-headers/oreilly_logo_mark_red_@2x.png'; this.onerror=null;" 
        alt="O'Reilly home">
      </a>

      <p>&copy; 2023, O’Reilly Media, Inc. All trademarks and registered trademarks appearing on oreilly.com are the property of their respective owners.</p>
      
      

      <p><a href="https://www.oreilly.com/terms/">Terms of service</a> • <a href="https://www.oreilly.com/privacy.html">Privacy policy</a> • <a href="https://www.oreilly.com/about/editorial_independence.html">Editorial independence</a></p>
    </div>

  </div>
</footer>



  <div class="exitIntentOverlay" id="exitIntentOverlay">
    <div class="exitIntentOverlay-contents">
      <div class="exitIntentOverlay-columns">
        <div class="exitIntentOverlay-text">
          <h2>Don’t leave <span class="nowrap">empty-handed</span></h2>

          <p>Get Mark Richards’s <em>Software Architecture Patterns</em> ebook to better understand how to design components—and how they should interact.</p>

          <h3>It’s yours, free.</h3>

          <a class="exitIntentOverlay-cta" href="https://get.oreilly.com/ind_software-architecture-patterns.html">Get it now</a>
        </div>

        <figure class="exitIntentOverlay-figure"><img src="https://cdn.oreillystatic.com/oreilly/images/report-software-architecture-patterns-553x420.jpg" alt="Cover of Software Architecture Patterns"></figure>
      </div>

      <button class="exitIntentOverlay-close">Close</button>
    </div>
  </div>
  

  <div class="exitIntentOverlay2" id="exitIntentOverlay2">
    <div class="exitIntentOverlay-contents">
      <div class="exitIntentOverlay-columns">
        <div class="exitIntentOverlay-text">
          <h2>Check it out now <span class="nowrap">on O’Reilly</span></h2>

          <p>Dive in for free with a 10-day trial of the O’Reilly learning platform—then explore all the other resources our members count on to build skills and solve problems <span class="nowrap">every day.</span></p>

          <a id="exitIntentOverlay2StartYourFreeTrial" class="exitIntentOverlay-cta" href="https://www.oreilly.com/start-trial/">Start your free trial</a>

          <a class="exitIntentOverlay-cta" href="https://learning.oreilly.com/signup/">Become a member now</a>
        </div>

        <figure class="exitIntentOverlay-figure"><img src="https://cdn.oreillystatic.com/oreilly/images/laptop-flat-topics-ml-1124x638.png" alt=""></figure>
      </div>

      <button class="exitIntentOverlay-close">Close</button>
    </div>
  </div>






<script>
  var g = {
    
    position_cache: {},
    title: "TypeScript Cookbook",
    author_list: "Stefan Baumgartner",
    format: "book",
    source: "application/epub+zip",
    is_system_book: true,
    is_public: true,
    loaded_from_server: true,
    allow_scripts: false,
    has_mathml: false
    
  };
</script>
<script>
  window.dataLayer = window.dataLayer || [];
  window.dataLayer.push({
    'product.title': "TypeScript Cookbook",
    'product.type': "book",
    'product.identifier': "9781098136642",
    'content.identifier': "9781098136642/ch04.html",
    'content.publisher': "O'Reilly Media, Inc.",
    'content.free': "no",
    //
    'content.subdirectory': "none",
    'content.subTopic': "none",
    'content.parentTopic': "none",
    'content.formatType': "book-chapter",
    'content.author': "Stefan Baumgartner",
    'content.releaseDate': "2023-08-15",
    'content.title': "4. Generics",
  });
</script>

<script>
  // Datadog RUM integration to measure performance and Core Web Vitals
  // https://docs.datadoghq.com/real_user_monitoring/browser/#overview
  // https://web.dev/vitals/
  (function(h,o,u,n,d) {
    h=h[d]=h[d]||{q:[],onReady:function(c){h.q.push(c)}}
    d=o.createElement(u);d.async=1;d.src=n
    n=o.getElementsByTagName(u)[0];n.parentNode.insertBefore(d,n)
  })(window,document,'script','https://www.datadoghq-browser-agent.com/datadog-rum.js','DD_RUM')
  DD_RUM.onReady(function() {
    DD_RUM.init({
      clientToken: 'pub1221d36d3b6dfda5f3c3b7ed22e3b6af',
      applicationId: '291bce39-f950-4fc6-a610-10abfead0661',
      site: 'datadoghq.com',
      service:'anybird',
      env:'production',
      // Specify a version number to identify the deployed version of your application in Datadog 
      // version: '1.0.0',
      sampleRate: 10,
      trackInteractions: true,
    })
  })
</script>






<script src="/library/view/static/CACHE/js/output.897a88a9c271.js"></script>


<noscript> 
  <iframe src="//www.googletagmanager.com/ns.html?id=GTM-5P4V6Z"
          height="0" width="0"
          style="display:none;visibility:hidden">
  </iframe>
</noscript>


<script async defer src="/library/view/pageview.js"></script>

<script src="//ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>

<script src="https://cdn.oreillystatic.com/assets/js/anybird/promotion.js"></script>


<script>
  //Exit intent overlay scripts

  //Setter and getter for exit intent cookie
  const ExitIntentCookieService = {
    setCookie(name, value, days) {
      let expires = '';
  
      if (days) {
        const date = new Date();
        date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
        expires = '; expires=' + date.toUTCString();
      }
  
      document.cookie = name + '=' + (value || '')  + expires + ';';
    },
  
    getCookie(name) {
      const cookies = document.cookie.split(';');
  
      for (const cookie of cookies) {
        if (cookie.indexOf(name + '=') > -1) {
          return cookie.split('=')[1];
        }
      }
  
      return null;
    }
  };
  
  //When a user clicks outside overlay or close icon or hits escape key
  //close exit intent overlay 
  const exit = e => {
    const shouldExit =
      [...e.target.classList].includes('exitIntentOverlay') || // user clicks on overlay
      [...e.target.classList].includes('exitIntentOverlay2') || // user clicks on overlay2
      e.target.className === 'exitIntentOverlay-close' || // user clicks on the close icon
      e.keyCode === 27; // user hits escape
  
    if (shouldExit) {
      document.querySelector('.exitIntentOverlay').classList.remove('visible');
      document.querySelector('.exitIntentOverlay2').classList.remove('visible');
    }
  };
  
  //When a user's cursor leaves the document
  //show exit intent overlay 
  const mouseEvent = e => {
    const shouldShowExitIntent = 
      !e.toElement && 
      !e.relatedTarget &&
      e.clientY < 10;
  
    if (shouldShowExitIntent) {
      document.removeEventListener('mouseout', mouseEvent);
      
      if (exitIntentCookieValue === null) {
        //Set value of exitIntentCookieValue
        exitIntentCookieValue = '1';

        //make exitIntentOverlay visible
        document.querySelector('.exitIntentOverlay').classList.add('visible');

        //Send tracking for exit intent overlay impression
        window.dataLayer.push({
          'event': 'eventTracker',
          'eventCat': 'marketing',
          'eventAct': 'exit intent imp',
          'eventLbl': 'modal 1'
        });
      } else if (exitIntentCookieValue === '1') {
        //Set value of exitIntentCookieValue
        exitIntentCookieValue = '2';

        //make exitIntentOverlay2 visible
        document.querySelector('.exitIntentOverlay2').classList.add('visible');
        
        //Send tracking for exit intent overlay impression
        window.dataLayer.push({
          'event': 'eventTracker',
          'eventCat': 'marketing',
          'eventAct': 'exit intent imp',
          'eventLbl': 'modal 2'
        });

        //Add click tracking for "start your free trial" button
        const StartYourFreeTrial = document.querySelector("#exitIntentOverlay2StartYourFreeTrial");
        StartYourFreeTrial.addEventListener('click', function(e) {
          window.dataLayer.push({
            'event': 'eventTracker',
            'eventCat': 'marketing',
            'eventAct': 'exit intent',
            'eventLbl': 'start your free trial'
          });
        });
      }

      //Set exit intent cookie
      ExitIntentCookieService.setCookie('libraryExitIntentShown', exitIntentCookieValue, 30);
    }
  };
  
  //If exit intentcookie doesn't exist,
  //then initialize exit intent overlay scripts
  var exitIntentCookieValue = ExitIntentCookieService.getCookie('libraryExitIntentShown');
  if (exitIntentCookieValue === null || exitIntentCookieValue === '1') {
    setTimeout(() => {
      document.addEventListener('mouseout', mouseEvent);
      document.addEventListener('keydown', exit);
      document.querySelector('.exitIntentOverlay').addEventListener('click', exit);
      document.querySelector('.exitIntentOverlay2').addEventListener('click', exit);
    }, 0);
  }
</script>


<script>
  jQuery(document).ready(function($) {
    //Toggle isActive and mobileHidden classes for mobileNavButton
    $('nav #mobileNavButton').on('click', function() {
      var expanded = $(this).attr('aria-expanded') === 'true' || false;
      $(this).attr('aria-expanded', !expanded);
      $(this).toggleClass("isActive");
      $(this).next().toggleClass("mobileHidden");
    });

    //Toggle isFocused class for keyboard navigation of submenus
    $('nav #menuList .menuList-subItem a').each(function(navItem) {
      $(this).on('focus', function() {
        $(this).parent().parent().toggleClass('isFocused');
      });
      $(this).on('blur', function() {
        $(this).parent().parent().toggleClass('isFocused');
      });
    });

    //Toggle mobileHidden class accordian elements
    $('.mobileAccordian').each(function() {
      var $btn = $(this).find('button');
      var $target =  $(this).next();
      $btn.on('click', function() {
        var expanded = $btn.attr('aria-expanded') === 'true' || false;

        $btn.attr('aria-expanded', !expanded);
        $target.toggleClass("mobileHidden");
      });
    });


    //Hide title page's long description behind disclosure button
    var titleDescriptionExtra = $('.title-description p:first-of-type').nextAll(':nth-child(3)').nextAll();
    titleDescriptionExtra.wrapAll('<div id="titleDescriptionExtra" />');
    if (titleDescriptionExtra.length > 0) {
      $('#titleDescriptionExtra').toggle();
      $('#showMoreDescription').removeClass('hidden');
      $('#showMoreDescription button').on('click', function() {
        $(this).toggleClass('more');
        $('#titleDescriptionExtra').slideToggle();
      });
    }

    //Hide title page's long TOC behind disclosure button
    var titleTOCShort = $('.sbo-reader-title .detail-toc').find('li').slice(0,4);
    var titleTOCExtra = $('.sbo-reader-title .detail-toc').find('li').not(titleTOCShort);
    if (titleTOCExtra.length > 0) {
      titleTOCExtra.toggle();
      $('#showMoreTOC').removeClass('hidden');
      $('#showMoreTOC button').on('click', function() {
        $(this).toggleClass('more');
        titleTOCExtra.toggle();
      });
    }

    //Hide product information on page load
    $('#product-information').toggle();
    $('#title-tabs button').on('click', function() {
      var $thisTab = $(this);
      if (!$thisTab.hasClass('title-tab-active')) {
        var lastTabTarget = $('#title-tabs .title-tab-active').removeClass('title-tab-active').attr('data-target');
        $('#' + lastTabTarget).toggle();

        $thisTab.addClass('title-tab-active');
        var $tabTarget = $(this).attr('data-target');
        $('#' + $tabTarget).toggle();
      }
    });

    // Append highlight fragment hash to sign in link for highlighting
    if (window.location.hash.indexOf('#:-:text') > -1) {
      // encode the hash symbol to prevent it from being used as a location hash by groot-fe
      var highlightFragment = window.location.hash.replace('#:-:text', '%23:-:text');
      $('#chapter-sign-in').attr('href', $('#chapter-sign-in').attr('href') + highlightFragment);
    }

    //Trigger GA events for related products
    $('#recommendations .recommendations-item').each(function(i) {
      $(this).on('click', function(e) {
        var cardTitle = $(this).find('.recommendations-title').text().toLowerCase();
        var productType = $(this).find('.recommendations-format').text().toLowerCase();
        var contentID = $(this).attr('data-id');
        var eventLbl = String(i);

        dataLayer.push({
          'product.title': undefined,
          'content.formatType': undefined,
          'product.identifier': undefined,
          'content.title': undefined,
          'content.author': undefined,
          'content.publisher': undefined,
          'content.releaseDate': undefined,
          'content.free': undefined,
          'content.subdirectory': undefined,
          'content.parentTopic': undefined,
          'content.subTopic': undefined,
          'event': 'eventTracker',
          'eventCat': 'recommended titles',
          'eventAct': 'card click',
          'eventLbl': eventLbl,
          'eventVal': 0, 
          'nonInteraction': 0,
          'cardTitle': cardTitle,
          'product.type': productType,
          'content.identifier': contentID,
          'eventCallback': function() {
            dataLayer.push({'cardTitle': undefined});
          },
          'eventTimeout' : 2000
        });
      });
    });

    //Trigger GA event for "Try Now" nav button
    $('.menuList-tryNow > a').on('click', function() {
      dataLayer.push({
        'event': 'eventTracker',
        'eventCat':'marketing',
        'eventAct':'nav',
        'eventLbl':'try now',
        'eventVal':0, 
        'nonInteraction': 0,
      });
    });

    //Trigger GA event for "Sign In" nav button
    $('.menuList-signIn > a').on('click', function() {
      dataLayer.push({
        'event': 'eventTracker',
        'eventCat':'marketing',
        'eventAct':'nav',
        'eventLbl':'sign in',
        'eventVal':0, 
        'nonInteraction': 0,
      });
    });

  });

</script>



<!-- MARC Intercept Support -->

<script src="https://service.seamlessaccess.org/thiss.js"></script>

<script src="/library/view/static/CACHE/js/output.a597394f6b61.js"></script>


<script type="text/javascript"  src="/b1344SpI/l5kI2KS/7CvIqRQ/m0/kir16tVwGhOG/GzM7GGwHGgM/CjB/yPklYPVw"></script></body>
</html>
