<!DOCTYPE html><html lang="en"><head><script src="https://phone-rejoice.zhenghao.io/script.js" data-site="ESNDEPHC" defer></script><meta name="next-font-preconnect" /><meta charSet="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="@he_zhenghao" /><meta name="twitter:creator" content="@he_zhenghao" /><meta property="og:title" content="Zhenghao's site" /><meta property="og:description" content="The official site of Zhenghao He, a software engineer and a TypeScript/JavaScript enthusiast." /><meta property="og:site_name" content="zhenghao.io" /><meta name="theme-color" content="#000" /><title>An introduction to type programming in TypeScript</title><meta name="robots" content="index,follow" /><meta name="googlebot" content="index,follow" /><meta name="description" content="Learn to write types using the type language and leverage your existing javascript knowledge to master TypeScript quicker" /><meta property="og:title" content="An introduction to type programming in TypeScript" /><meta property="og:description" content="Learn to write types using the type language and leverage your existing javascript knowledge to master TypeScript quicker" /><meta property="og:url" content="https://www.zhenghao.io/posts/type-programming" /><link rel="canonical" href="https://www.zhenghao.io/posts/type-programming" /><meta name="twitter:title" content="An introduction to type programming in TypeScript" /><meta name="twitter:description" content="Learn to write types using the type language and leverage your existing javascript knowledge to master TypeScript quicker" /><link rel="stylesheet" href="/styles/prism.css" /><meta name="next-head-count" content="20" /><link rel="preload" href="/_next/static/css/a4cd6176500b7ad65a28.css" as="style" /><link rel="stylesheet" href="/_next/static/css/a4cd6176500b7ad65a28.css" data-n-g /><noscript data-n-css></noscript><script defer noModule src="/_next/static/chunks/polyfills-a40ef1678bae11e696dba45124eadd70.js"></script><script defer src="/_next/static/chunks/204.ad050be5e2c469c3cdc1.js"></script><script src="/_next/static/chunks/webpack-f078e51f08578af73c9c.js" defer></script><script src="/_next/static/chunks/framework-539a8e6071c37131a70b.js" defer></script><script src="/_next/static/chunks/main-4b4530ae248c985c75ac.js" defer></script><script src="/_next/static/chunks/pages/_app-a865e648087202bec91a.js" defer></script><script src="/_next/static/chunks/675-b5c544a448dd608b200f.js" defer></script><script src="/_next/static/chunks/636-5f4fb9e9a8ce5509afd4.js" defer></script><script src="/_next/static/chunks/pages/posts/%5Bslug%5D-dab6c73f3e12a9d3f1af.js" defer></script><script src="/_next/static/CqfzUjxO3hrsg__Vyai7K/_buildManifest.js" defer></script><script src="/_next/static/CqfzUjxO3hrsg__Vyai7K/_ssgManifest.js" defer></script></head><body class="dark"><script>!function(){var a=document.body.classList;a.remove("dark");var e=localStorage.getItem("theme");e?a.add(e.replace(/"/g,"")):window.matchMedia("(prefers-color-scheme: dark)").matches?a.add("dark"):a.add("light")}()</script><div id="__next"><div class="w-full h-full"><header class="relative w-full h-16"><div class="fixed h-20 z-40 w-full flex justify-between backdrop-blur-[20px] backdrop-saturate-150 bg-white/50 dark:bg-[#0D0D1050]"><nav class="w-full sm:max-w-[75ch] m-auto sm:grid md:flex px-5 justify-between items-center "><a title="Home" aria-label="Home" href="/"><span>Tue 16:13, Seattle</span></a><div class="flex items-center gap-5"><a class="capitalize " href="/posts">posts</a><div class="flex items-center w-5 h-5 bg-transparent"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" color="white" fill="none" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" stroke="currentColor" style="cursor: pointer; transform:  rotate(40deg);"><mask id="circle-mask-0"><rect x="0" y="0" width="100%" height="100%" fill="white"></rect><circle style="cx: 50%; cy: 23%;" r="9" fill="black"></circle></mask><circle cx="12" cy="12" fill="white" style="r: 9px;" mask="url(#circle-mask-0)"></circle><g stroke="currentColor" style="opacity: 0;"><line x1="12" y1="1" x2="12" y2="3"></line><line x1="12" y1="21" x2="12" y2="23"></line><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line><line x1="1" y1="12" x2="3" y2="12"></line><line x1="21" y1="12" x2="23" y2="12"></line><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line></g></svg></div><span style="cursor: pointer;"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-rss"><path d="M4 11a9 9 0 0 1 9 9"></path><path d="M4 4a16 16 0 0 1 16 16"></path><circle cx="5" cy="19" r="1"></circle></svg></span><div class="ml-16"><button type="button" aria-label="Search" class="DocSearch DocSearch-Button"><span class="DocSearch-Button-Container"><svg width="20" height="20" viewBox="0 0 20 20" class="DocSearch-Search-Icon"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></nav></div></header><main class="w-full"><article class="max-w-[85ch] mx-auto pt-12 pb-28  px-5"><div><h1 class="mb-1 text-3xl font-black capitalize md:text-4xl">An introduction to type programming in TypeScript</h1><small style="margin: 12px 12px 0 0; display: inline-block; cursor: pointer;" class="link-tag">#typescript</small><div class="flex flex-col	pt-4 pb-8 text-sm font-thin uppercase text-warmGray-500 dark:text-warmGray-400"><time dateTime="2022-01-31">Published on 31 January, 2022</time><time dateTime="2022-07-24">Last updated on 24 July, 2022</time></div><p class="italic">Learn to write types using the type language and leverage your existing javascript knowledge to master TypeScript quicker</p></div><blockquote>
<p>See discussions on <a href="https://news.ycombinator.com/item?id=30173375" target="_blank" rel="noopener noreferrer" class="link-btn">Hacker News</a></p>
</blockquote>
<h2 id="types-are-a-complex-language-of-their-own">Types are a complex language of their own<a class="anchor" href="/posts/type-programming#types-are-a-complex-language-of-their-own">#</a></h2>
<p>I used to think of TypeScript as just JavaScript with type annotations sprinkled on top of it. With that mindset, I often found writing correct types tricky and daunting, to a point they got in the way of building the actual applications I wanted to build, and frequently, it led me to reach for <code>any</code>. And with <code>any</code>, I lose all type safety.</p>
<p>Indeed, types can get really complicated if you let them. After writing TypeScript for a while, it occurred to me that the TypeScript language actually consists of two sub-languages - one is JavaScript, and the other is the type language:</p>
<ul>
<li>for the JavaScript language, the world is made of JavaScript values</li>
<li>for the type language, the world is made of types</li>
</ul>
<p>When we write TypeScript code, we are constantly dancing between these two worlds: we create types in our type world and &quot;summon&quot; them in our JavaScript world using type annotations (or have them implicitly inferred by the compiler); we can go in the other direction too: use TypeScript's <a href="https://www.typescriptlang.org/docs/handbook/2/typeof-types.html#the-typeof-type-operator" target="_blank" rel="noopener noreferrer" class="link-btn">typeof operator</a> on JavaScript variables/properties to retrieve the corresponding types (not the <code>typeof</code> operator JavaScript provides to check runtime values' types).</p>
<p><div class="my-10"><img src="/art/blog/type-programming/twoworlds.png" alt="alt" layout="fill" /></div></p>
<p>The JavaScript language is very expressive, so is the type language - in fact, the type language is so expressive that it has been proven to be Turing complete.</p>
<p>Here I don't make any value judgment of whether being Turing complete is good or bad, nor do I know if it is even by design or by accident (in fact, often times, Turing-completeness was achieved <a href="http://beza1e1.tuxen.de/articles/accidentally_turing_complete.html" target="_blank" rel="noopener noreferrer" class="link-btn">by accident</a>). My point is the type language itself, as innocuous as it seems, is certainly powerful, highly capable and can perform arbitrary computation at compile time.</p>
<p>When I started to think of the type language in TypeScript as a full-fledged programming language, I realized it even has a few characteristics of a functional programming language:</p>
<ol>
<li>use recursion instead of iteration
<ol>
<li>in <a href="https://devblogs.microsoft.com/typescript/announcing-typescript-4-5/#tailrec-conditional" target="_blank" rel="noopener noreferrer" class="link-btn">TypeScript 4.5</a> we have tail call optimized recursion (to some extent)</li>
</ol>
</li>
<li>types (data) are immutable</li>
</ol>
<p>In this post, we will learn the type language in TypeScript by comparing it with JavaScript so that you can leverage your existing JavaScript knowledge to master TypeScript quicker.</p>
<blockquote>
<p>This post assumes that readers have some familiarity with JavaScript and TypeScript. And if you want to learn TypeScript from scratch properly, you should start with <a href="https://www.typescriptlang.org/docs/handbook/intro.html" target="_blank" rel="noopener noreferrer" class="link-btn">The TypeScript Handbook</a>. I am not here to compete with the docs.</p>
</blockquote>
<h2 id="variable-declaration">Variable declaration<a class="anchor" href="/posts/type-programming#variable-declaration">#</a></h2>
<p>In JavaScript, the world is made of JavaScript values, and we declare variables to refer to values using keywords <code>var</code>, <code>const</code> and <code>let</code>. For example:</p>
<div class="remark-highlight"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> obj <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token string">'foo'</span><span class="token punctuation">}</span>
</code></pre></div>
<p>In the type language, the world is made of types, and we declare type variables using keywords <code>type</code> and <code>interface</code>. For example:</p>
<div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Obj</span> <span class="token operator">=</span> <span class="token punctuation">{</span>name<span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">}</span>
</code></pre></div>
<blockquote>
<p>A more accurate name for “type variables” is type synonyms or type alias. I use the word &quot;type variables&quot; to draw an analogy to how a JavaScript variable references a value.</p>
<p>It is not a perfect analogy though, a type alias doesn’t create or introduce a new type—they are only a new name for existing types. But I hope drawing this analogy makes explaining concepts of the type language much easier.</p>
</blockquote>
<p>Types and values are very related. A type, at its core, represents the set of possible values and the valid operations that can be done on the values. Sometimes the set is finite, e.g., <code>type Name = 'foo' | 'bar'</code>, a lot of times the set is infinite, e.g., <code>type Age = number</code>. In TypeScript we integrate types and values and make them work together to ensure that the runtime values match the compile-time types.</p>
<h3 id="local-variable-declaration">Local variable declaration<a class="anchor" href="/posts/type-programming#local-variable-declaration">#</a></h3>
<p>We talked about how you can create type variables in the type language. However, the type variables have a global scope by default. To create a local type variable, we can use the <code>infer</code> keyword in our type language.</p>
<div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name"><span class="token constant">A</span></span> <span class="token operator">=</span> <span class="token string">'foo'</span><span class="token punctuation">;</span> <span class="token comment">// global scope</span>
<span class="token keyword">type</span> <span class="token class-name"><span class="token constant">B</span></span> <span class="token operator">=</span> <span class="token constant">A</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token keyword">infer</span></span> <span class="token constant">C</span> <span class="token operator">?</span> <span class="token punctuation">(</span>
    <span class="token constant">C</span> <span class="token keyword">extends</span> <span class="token string">'foo'</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span><span class="token comment">// *only* inside this expression, C represents A</span>
<span class="token punctuation">)</span> <span class="token operator">:</span> <span class="token builtin">never</span>
</code></pre></div>
<p>Although this particular way of creating scoped variables might seem strange to JavaScript developers, it actually finds its roots in some pure functional programming languages. For example, in Haskell, we can use the <code>let</code> keyword with <code>in</code> to perform scoped assignments as in <code>let {assignments} in {expression}</code>:</p>
<div class="remark-highlight"><pre class="language-Haskell"><code class="language-Haskell">let two = 2; three = 3 in two * three 
//                         ↑       ↑
// two and three are only in scope for the expression `two * three` </code></pre></div>
<details><summary><b><code>infer</code> is useful for caching some intermediate types</b></summary>
<p>Here is an example:</p><div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">ConvertFooToBar<span class="token operator">&lt;</span><span class="token constant">G</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token constant">G</span> <span class="token keyword">extends</span> <span class="token string">'foo'</span> <span class="token operator">?</span> <span class="token string">'bar'</span> <span class="token operator">:</span> <span class="token builtin">never</span>
<span class="token keyword">type</span> <span class="token class-name">ConvertBarToBaz<span class="token operator">&lt;</span><span class="token constant">G</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token constant">G</span> <span class="token keyword">extends</span> <span class="token string">'bar'</span> <span class="token operator">?</span> <span class="token string">'baz'</span> <span class="token operator">:</span> <span class="token builtin">never</span>

<span class="token keyword">type</span> <span class="token class-name">ConvertFooToBaz<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> ConvertFooToBar<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token keyword">extends</span> <span class="token class-name"><span class="token keyword">infer</span></span> Bar <span class="token operator">?</span> 
        Bar <span class="token keyword">extends</span> <span class="token string">'bar'</span> <span class="token operator">?</span> ConvertBarToBaz<span class="token operator">&lt;</span>Bar<span class="token operator">&gt;</span> <span class="token operator">:</span> <span class="token builtin">never</span> 
    <span class="token operator">:</span> <span class="token builtin">never</span>

<span class="token keyword">type</span> <span class="token class-name">Baz</span> <span class="token operator">=</span> ConvertFooToBaz<span class="token operator">&lt;</span><span class="token string">'foo'</span><span class="token operator">&gt;</span>
</code></pre></div><p>Without <code>infer</code> to create a local type variable <code>Bar</code>, we have to calculate <code>Bar</code> twice:</p><div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">ConvertFooToBar<span class="token operator">&lt;</span><span class="token constant">G</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token constant">G</span> <span class="token keyword">extends</span> <span class="token string">'foo'</span> <span class="token operator">?</span> <span class="token string">'bar'</span> <span class="token operator">:</span> <span class="token builtin">never</span>
<span class="token keyword">type</span> <span class="token class-name">ConvertBarToBaz<span class="token operator">&lt;</span><span class="token constant">G</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> <span class="token constant">G</span> <span class="token keyword">extends</span> <span class="token string">'bar'</span> <span class="token operator">?</span> <span class="token string">'baz'</span> <span class="token operator">:</span> <span class="token builtin">never</span>

<span class="token keyword">type</span> <span class="token class-name">ConvertFooToBaz<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span></span> <span class="token operator">=</span> ConvertFooToBar<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token keyword">extends</span> <span class="token string">'bar'</span> <span class="token operator">?</span> 
    ConvertBarToBaz<span class="token operator">&lt;</span>ConvertFooToBar<span class="token operator">&lt;</span><span class="token constant">T</span><span class="token operator">&gt;</span> <span class="token operator">&gt;</span> <span class="token operator">:</span> <span class="token builtin">never</span> <span class="token comment">// call `ConvertFooToBar` twice</span>

<span class="token keyword">type</span> <span class="token class-name">Baz</span> <span class="token operator">=</span> ConvertFooToBaz<span class="token operator">&lt;</span><span class="token string">'foo'</span><span class="token operator">&gt;</span>
</code></pre></div></details>
<h2 id="equality-comparisons-and-conditional-branching">Equality comparisons and conditional branching<a class="anchor" href="/posts/type-programming#equality-comparisons-and-conditional-branching">#</a></h2>
<p>In JavaScript. we can use <code>===</code>/<code>==</code> with if statement or the conditional (ternary) operator <code>?</code> to perform equality check and conditional branching.</p>
<p>In the type language, on the other hand, we use the <code>extends</code> keyword for &quot;equality check&quot;, and the conditional (ternary) operator <code>?</code> for conditional branching too as in:</p>
<div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript">TypeC <span class="token operator">=</span> TypeA <span class="token keyword">extends</span> <span class="token class-name">TypeB</span> <span class="token operator">?</span> TrueExpression <span class="token operator">:</span> FalseExpression
</code></pre></div>
<p>If <code>TypeA</code> is assignable or substitutable to <code>TypeB</code>, then we enter the first branch and get the type from <code>TrueExpression</code> and assign that to <code>TypeC</code> ; otherwise we get the type from <code>FalseExpression</code> as a result to <code>TypeC</code>.</p>
<blockquote>
<p>The concept of assignability/substitutability is one of the core concepts in TypeScript that deserves a separate post - I wrote <a class="link-btn" href="/posts/type-hierarchy-tree">one covering that in detail</a>.</p>
</blockquote>
<p>A concrete example in JavaScript:</p>
<div class="remark-highlight"><pre class="language-javascript"><code class="language-javascript"><span class="token keyword">const</span> username <span class="token operator">=</span> <span class="token string">'foo'</span>
<span class="token keyword">let</span> matched

<span class="token keyword control-flow">if</span><span class="token punctuation">(</span>username <span class="token operator">===</span> <span class="token string">'foo'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    matched <span class="token operator">=</span> <span class="token boolean">true</span>
<span class="token punctuation">}</span> <span class="token keyword control-flow">else</span> <span class="token punctuation">{</span>
    matched <span class="token operator">=</span> <span class="token boolean">false</span>
<span class="token punctuation">}</span>
</code></pre></div>
<p>Translate it into the type language:</p>
<div class="remark-highlight"><pre class="language-typescript"><code class="language-typescript"><span class="token keyword">type</span> <span class="token class-name">Username</span> <span class="token operator">=</span> <span class="token string">'foo'</span>
<span class="token keyword">type</span> <span class="token class-name">Matched</span> <span class="token operator">=</span> Username <span class="token keyword">extends</span> <span class="token string">'foo'</span> <span class="token operator">?</span> <span class="token boolean">true</span> <span class="token operator">:</span> <span class="token boolean">false</span> <span class="token comment">// true</span>
</code></pre></div>
</body></html>